!function(e,t){"function"==typeof define&&define.amd?define([],function(){return t()}):"object"==typeof exports?module.exports=t():t()}(this,function(){return angular.module("pascalprecht.translate",["ng"]).run(["$translate",function(e){var t=e.storageKey(),r=e.storage(),n=function(){var n=e.preferredLanguage();angular.isString(n)?e.use(n):r.put(t,e.use())};r?r.get(t)?e.use(r.get(t))["catch"](n):n():angular.isString(e.preferredLanguage())&&e.use(e.preferredLanguage())}]),angular.module("pascalprecht.translate").provider("$translate",["$STORAGE_KEY","$windowProvider",function(e,t){var r,n,a,o,i,l,s,u,c,f,g,h,d,p,v,m={},$=[],y=e,b=[],S=!1,w="translate-cloak",T=!1,k=".",L=0,P=!0,C="2.7.0",E=function(){var e,r,n=t.$get().navigator,a=["language","browserLanguage","systemLanguage","userLanguage"];if(angular.isArray(n.languages))for(e=0;e<n.languages.length;e++)if(r=n.languages[e],r&&r.length)return r;for(e=0;e<a.length;e++)if(r=n[a[e]],r&&r.length)return r;return null};E.displayName="angular-translate/service: getFirstBrowserLanguage";var A=function(){return(E()||"").split("-").join("_")};A.displayName="angular-translate/service: getLocale";var j=function(e,t){for(var r=0,n=e.length;n>r;r++)if(e[r]===t)return r;return-1},I=function(){return this.replace(/^\s+|\s+$/g,"")},O=function(e){for(var t=[],r=angular.lowercase(e),a=0,o=$.length;o>a;a++)t.push(angular.lowercase($[a]));if(j(t,r)>-1)return e;if(n){var i;for(var l in n){var s=!1,u=Object.prototype.hasOwnProperty.call(n,l)&&angular.lowercase(l)===angular.lowercase(e);if("*"===l.slice(-1)&&(s=l.slice(0,-1)===e.slice(0,l.length-1)),(u||s)&&(i=n[l],j(t,angular.lowercase(i))>-1))return i}}var c=e.split("_");return c.length>1&&j(t,angular.lowercase(c[0]))>-1?c[0]:e},x=function(e,t){if(!e&&!t)return m;if(e&&!t){if(angular.isString(e))return m[e]}else angular.isObject(m[e])||(m[e]={}),angular.extend(m[e],B(t));return this};this.translations=x,this.cloakClassName=function(e){return e?(w=e,this):w};var B=function(e,t,r,n){var a,o,i,l;t||(t=[]),r||(r={});for(a in e)Object.prototype.hasOwnProperty.call(e,a)&&(l=e[a],angular.isObject(l)?B(l,t.concat(a),r,a):(o=t.length?""+t.join(k)+k+a:a,t.length&&a===n&&(i=""+t.join(k),r[i]="@:"+o),r[o]=l));return r};this.addInterpolation=function(e){return b.push(e),this},this.useMessageFormatInterpolation=function(){return this.useInterpolation("$translateMessageFormatInterpolation")},this.useInterpolation=function(e){return f=e,this},this.useSanitizeValueStrategy=function(e){return S=e,this},this.preferredLanguage=function(e){return F(e),this};var F=function(e){return e&&(r=e),r};this.translationNotFoundIndicator=function(e){return this.translationNotFoundIndicatorLeft(e),this.translationNotFoundIndicatorRight(e),this},this.translationNotFoundIndicatorLeft=function(e){return e?(d=e,this):d},this.translationNotFoundIndicatorRight=function(e){return e?(p=e,this):p},this.fallbackLanguage=function(e){return _(e),this};var _=function(e){return e?(angular.isString(e)?(o=!0,a=[e]):angular.isArray(e)&&(o=!1,a=e),angular.isString(r)&&j(a,r)<0&&a.push(r),this):o?a[0]:a};this.use=function(e){if(e){if(!m[e]&&!g)throw new Error("$translateProvider couldn't find translationTable for langKey: '"+e+"'");return i=e,this}return i};var V=function(e){return e?void(y=e):u?u+y:y};this.storageKey=V,this.useUrlLoader=function(e,t){return this.useLoader("$translateUrlLoader",angular.extend({url:e},t))},this.useStaticFilesLoader=function(e){return this.useLoader("$translateStaticFilesLoader",e)},this.useLoader=function(e,t){return g=e,h=t||{},this},this.useLocalStorage=function(){return this.useStorage("$translateLocalStorage")},this.useCookieStorage=function(){return this.useStorage("$translateCookieStorage")},this.useStorage=function(e){return s=e,this},this.storagePrefix=function(e){return e?(u=e,this):e},this.useMissingTranslationHandlerLog=function(){return this.useMissingTranslationHandler("$translateMissingTranslationHandlerLog")},this.useMissingTranslationHandler=function(e){return c=e,this},this.usePostCompiling=function(e){return T=!!e,this},this.determinePreferredLanguage=function(e){var t=e&&angular.isFunction(e)?e():A();return r=$.length?O(t):t,this},this.registerAvailableLanguageKeys=function(e,t){return e?($=e,t&&(n=t),this):$},this.useLoaderCache=function(e){return e===!1?v=void 0:e===!0?v=!0:"undefined"==typeof e?v="$translationCache":e&&(v=e),this},this.directivePriority=function(e){return void 0===e?L:(L=e,this)},this.statefulFilter=function(e){return void 0===e?P:(P=e,this)},this.$get=["$log","$injector","$rootScope","$q",function(e,t,n,u){var $,k,E,A=t.get(f||"$translateDefaultInterpolation"),N=!1,U={},R={},K=function(e,t,n,o){if(angular.isArray(e)){var l=function(e){for(var r={},a=[],i=function(e){var a=u.defer(),i=function(t){r[e]=t,a.resolve([e,t])};return K(e,t,n,o).then(i,i),a.promise},l=0,s=e.length;s>l;l++)a.push(i(e[l]));return u.all(a).then(function(){return r})};return l(e)}var c=u.defer();e&&(e=I.apply(e));var f=function(){var e=r?R[r]:R[i];if(k=0,s&&!e){var t=$.get(y);if(e=R[t],a&&a.length){var n=j(a,t);k=0===n?1:0,j(a,r)<0&&a.push(r)}}return e}();return f?f["finally"](function(){Z(e,t,n,o).then(c.resolve,c.reject)}):Z(e,t,n,o).then(c.resolve,c.reject),c.promise},z=function(e){return d&&(e=[d,e].join(" ")),p&&(e=[e,p].join(" ")),e},q=function(e){i=e,n.$emit("$translateChangeSuccess",{language:e}),s&&$.put(K.storageKey(),i),A.setLocale(i),angular.forEach(U,function(e,t){U[t].setLocale(i)}),n.$emit("$translateChangeEnd",{language:e})},D=function(e){if(!e)throw"No language key specified for loading.";var r=u.defer();n.$emit("$translateLoadingStart",{language:e}),N=!0;var a=v;"string"==typeof a&&(a=t.get(a));var o=angular.extend({},h,{key:e,$http:angular.extend({},{cache:a},h.$http)});return t.get(g)(o).then(function(t){var a={};n.$emit("$translateLoadingSuccess",{language:e}),angular.isArray(t)?angular.forEach(t,function(e){angular.extend(a,B(e))}):angular.extend(a,B(t)),N=!1,r.resolve({key:e,table:a}),n.$emit("$translateLoadingEnd",{language:e})},function(e){n.$emit("$translateLoadingError",{language:e}),r.reject(e),n.$emit("$translateLoadingEnd",{language:e})}),r.promise};if(s&&($=t.get(s),!$.get||!$.put))throw new Error("Couldn't use storage '"+s+"', missing get() or put() method!");angular.isFunction(A.useSanitizeValueStrategy)&&A.useSanitizeValueStrategy(S),b.length&&angular.forEach(b,function(e){var n=t.get(e);n.setLocale(r||i),angular.isFunction(n.useSanitizeValueStrategy)&&n.useSanitizeValueStrategy(S),U[n.getInterpolationIdentifier()]=n});var M=function(e){var t=u.defer();return Object.prototype.hasOwnProperty.call(m,e)?t.resolve(m[e]):R[e]?R[e].then(function(e){x(e.key,e.table),t.resolve(e.table)},t.reject):t.reject(),t.promise},H=function(e,t,r,n){var a=u.defer();return M(e).then(function(o){if(Object.prototype.hasOwnProperty.call(o,t)){n.setLocale(e);var l=o[t];"@:"===l.substr(0,2)?H(e,l.substr(2),r,n).then(a.resolve,a.reject):a.resolve(n.interpolate(o[t],r)),n.setLocale(i)}else a.reject()},a.reject),a.promise},G=function(e,t,r,n){var a,o=m[e];if(o&&Object.prototype.hasOwnProperty.call(o,t)){if(n.setLocale(e),a=n.interpolate(o[t],r),"@:"===a.substr(0,2))return G(e,a.substr(2),r,n);n.setLocale(i)}return a},J=function(e,r){if(c){var n=t.get(c)(e,i,r);return void 0!==n?n:e}return e},Y=function(e,t,r,n,o){var i=u.defer();if(e<a.length){var l=a[e];H(l,t,r,n).then(i.resolve,function(){Y(e+1,t,r,n,o).then(i.resolve)})}else i.resolve(o?o:J(t,r));return i.promise},W=function(e,t,r,n){var o;if(e<a.length){var i=a[e];o=G(i,t,r,n),o||(o=W(e+1,t,r,n))}return o},X=function(e,t,r,n){return Y(E>0?E:k,e,t,r,n)},Q=function(e,t,r){return W(E>0?E:k,e,t,r)},Z=function(e,t,r,n){var o=u.defer(),l=i?m[i]:m,s=r?U[r]:A;if(l&&Object.prototype.hasOwnProperty.call(l,e)){var f=l[e];"@:"===f.substr(0,2)?K(f.substr(2),t,r,n).then(o.resolve,o.reject):o.resolve(s.interpolate(f,t))}else{var g;c&&!N&&(g=J(e,t)),i&&a&&a.length?X(e,t,s,n).then(function(e){o.resolve(e)},function(e){o.reject(z(e))}):c&&!N&&g?o.resolve(n?n:g):n?o.resolve(n):o.reject(z(e))}return o.promise},ee=function(e,t,r){var n,o=i?m[i]:m,l=A;if(U&&Object.prototype.hasOwnProperty.call(U,r)&&(l=U[r]),o&&Object.prototype.hasOwnProperty.call(o,e)){var s=o[e];n="@:"===s.substr(0,2)?ee(s.substr(2),t,r):l.interpolate(s,t)}else{var u;c&&!N&&(u=J(e,t)),i&&a&&a.length?(k=0,n=Q(e,t,l)):n=c&&!N&&u?u:z(e)}return n},te=function(e){l===e&&(l=void 0),R[e]=void 0};if(K.preferredLanguage=function(e){return e&&F(e),r},K.cloakClassName=function(){return w},K.fallbackLanguage=function(e){if(void 0!==e&&null!==e){if(_(e),g&&a&&a.length)for(var t=0,r=a.length;r>t;t++)R[a[t]]||(R[a[t]]=D(a[t]));K.use(K.use())}return o?a[0]:a},K.useFallbackLanguage=function(e){if(void 0!==e&&null!==e)if(e){var t=j(a,e);t>-1&&(E=t)}else E=0},K.proposedLanguage=function(){return l},K.storage=function(){return $},K.use=function(e){if(!e)return i;var t=u.defer();n.$emit("$translateChangeStart",{language:e});var r=O(e);return r&&(e=r),m[e]||!g||R[e]?l===e&&R[e]?R[e].then(function(e){return t.resolve(e.key),e},function(e){return t.reject(e),u.reject(e)}):(t.resolve(e),q(e)):(l=e,R[e]=D(e).then(function(e){return x(e.key,e.table),t.resolve(e.key),q(e.key),e},function(e){return n.$emit("$translateChangeError",{language:e}),t.reject(e),n.$emit("$translateChangeEnd",{language:e}),u.reject(e)}),R[e]["finally"](function(){te(e)})),t.promise},K.storageKey=function(){return V()},K.isPostCompilingEnabled=function(){return T},K.refresh=function(e){function t(){o.resolve(),n.$emit("$translateRefreshEnd",{language:e})}function r(){o.reject(),n.$emit("$translateRefreshEnd",{language:e})}if(!g)throw new Error("Couldn't refresh translation table, no loader registered!");var o=u.defer();if(n.$emit("$translateRefreshStart",{language:e}),e)m[e]?D(e).then(function(r){x(r.key,r.table),e===i&&q(i),t()},r):r();else{var l=[],s={};if(a&&a.length)for(var c=0,f=a.length;f>c;c++)l.push(D(a[c])),s[a[c]]=!0;i&&!s[i]&&l.push(D(i)),u.all(l).then(function(e){angular.forEach(e,function(e){m[e.key]&&delete m[e.key],x(e.key,e.table)}),i&&q(i),t()})}return o.promise},K.instant=function(e,t,n){if(null===e||angular.isUndefined(e))return e;if(angular.isArray(e)){for(var o={},l=0,s=e.length;s>l;l++)o[e[l]]=K.instant(e[l],t,n);return o}if(angular.isString(e)&&e.length<1)return e;e&&(e=I.apply(e));var u,f=[];r&&f.push(r),i&&f.push(i),a&&a.length&&(f=f.concat(a));for(var g=0,h=f.length;h>g;g++){var v=f[g];if(m[v]&&("undefined"!=typeof m[v][e]?u=ee(e,t,n):(d||p)&&(u=z(e))),"undefined"!=typeof u)break}return u||""===u||(u=A.interpolate(e,t),c&&!N&&(u=J(e,t))),u},K.versionInfo=function(){return C},K.loaderCache=function(){return v},K.directivePriority=function(){return L},K.statefulFilter=function(){return P},g&&(angular.equals(m,{})&&K.use(K.use()),a&&a.length))for(var re=function(e){return x(e.key,e.table),n.$emit("$translateChangeEnd",{language:e.key}),e},ne=0,ae=a.length;ae>ne;ne++){var oe=a[ne];m[oe]||(R[oe]=D(oe).then(re))}return K}]}]),angular.module("pascalprecht.translate").factory("$translateDefaultInterpolation",["$interpolate",function(e){var t,r={},n="default",a=null,o={escaped:function(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=angular.isNumber(e[r])?e[r]:angular.element("<div></div>").text(e[r]).html());return t}},i=function(e){var t;return t=angular.isFunction(o[a])?o[a](e):e};return r.setLocale=function(e){t=e},r.getInterpolationIdentifier=function(){return n},r.useSanitizeValueStrategy=function(e){return a=e,this},r.interpolate=function(t,r){return a&&(r=i(r)),e(t)(r||{})},r}]),angular.module("pascalprecht.translate").constant("$STORAGE_KEY","NG_TRANSLATE_LANG_KEY"),angular.module("pascalprecht.translate").directive("translate",["$translate","$q","$interpolate","$compile","$parse","$rootScope",function(e,t,r,n,a,o){var i=function(){return this.replace(/^\s+|\s+$/g,"")};return{restrict:"AE",scope:!0,priority:e.directivePriority(),compile:function(t,l){var s=l.translateValues?l.translateValues:void 0,u=l.translateInterpolation?l.translateInterpolation:void 0,c=t[0].outerHTML.match(/translate-value-+/i),f="^(.*)("+r.startSymbol()+".*"+r.endSymbol()+")(.*)",g="^(.*)"+r.startSymbol()+"(.*)"+r.endSymbol()+"(.*)";return function(t,h,d){t.interpolateParams={},t.preText="",t.postText="";var p={};d.translateValues&&angular.extend(t.interpolateParams,a(d.translateValues)(t.$parent));var v=function(e){if(angular.isFunction(v._unwatchOld)&&(v._unwatchOld(),v._unwatchOld=void 0),angular.equals(e,"")||!angular.isDefined(e)){if(c)for(var n in l)if(Object.prototype.hasOwnProperty.call(d,n)&&"translateValue"===n.substr(0,14)&&"translateValues"!==n){var a=angular.lowercase(n.substr(14,1))+n.substr(15);t.interpolateParams[a]=l[n]}var o=i.apply(h.text()).match(f);if(angular.isArray(o)){t.preText=o[1],t.postText=o[3],p.translate=r(o[2])(t.$parent);var s=h.text().match(g);angular.isArray(s)&&s[2]&&s[2].length&&(v._unwatchOld=t.$watch(s[2],function(e){p.translate=e,w()}))}else p.translate=h.text().replace(/^\s+|\s+$/g,"")}else p.translate=e;w()},m=function(e){d.$observe(e,function(t){p[e]=t,w()})},$=!0;d.$observe("translate",function(e){"undefined"==typeof e?v(""):""===e&&$||(p.translate=e,w()),$=!1});for(var y in d)d.hasOwnProperty(y)&&"translateAttr"===y.substr(0,13)&&m(y);if(d.$observe("translateDefault",function(e){t.defaultText=e}),s&&d.$observe("translateValues",function(e){e&&t.$parent.$watch(function(){angular.extend(t.interpolateParams,a(e)(t.$parent))})}),c){var b=function(e){d.$observe(e,function(r){var n=angular.lowercase(e.substr(14,1))+e.substr(15);t.interpolateParams[n]=r})};for(var S in d)Object.prototype.hasOwnProperty.call(d,S)&&"translateValue"===S.substr(0,14)&&"translateValues"!==S&&b(S)}var w=function(){for(var e in p)p.hasOwnProperty(e)&&void 0!==p[e]&&T(e,p[e],t,t.interpolateParams,t.defaultText)},T=function(t,r,n,a,o){r?e(r,a,u,o).then(function(e){k(e,n,!0,t)},function(e){k(e,n,!1,t)}):k(r,n,!1,t)},k=function(t,r,a,o){if("translate"===o){a||"undefined"==typeof r.defaultText||(t=r.defaultText),h.html(r.preText+t+r.postText);var i=e.isPostCompilingEnabled(),s="undefined"!=typeof l.translateCompile,u=s&&"false"!==l.translateCompile;(i&&!s||u)&&n(h.contents())(r)}else{a||"undefined"==typeof r.defaultText||(t=r.defaultText);var c=d.$attr[o];"data-"===c.substr(0,5)&&(c=c.substr(5)),c=c.substr(15),h.attr(c,t)}};t.$watch("interpolateParams",w,!0);var L=o.$on("$translateChangeSuccess",w);h.text().length&&v(d.translate?d.translate:""),w(),t.$on("$destroy",L)}}}}]),angular.module("pascalprecht.translate").directive("translateCloak",["$rootScope","$translate",function(e,t){return{compile:function(r){var n=function(){r.addClass(t.cloakClassName())},a=function(){r.removeClass(t.cloakClassName())},o=e.$on("$translateChangeEnd",function(){a(),o(),o=null});return n(),function(e,r,o){o.translateCloak&&o.translateCloak.length&&o.$observe("translateCloak",function(e){t(e).then(a,n)})}}}}]),angular.module("pascalprecht.translate").filter("translate",["$parse","$translate",function(e,t){var r=function(r,n,a){return angular.isObject(n)||(n=e(n)(this)),t.instant(r,n,a)};return t.statefulFilter()&&(r.$stateful=!0),r}]),"pascalprecht.translate"}),function(e,t){"function"==typeof define&&define.amd?define([],function(){return t()}):"object"==typeof exports?module.exports=t():t()}(this,function(){return angular.module("pascalprecht.translate").provider("$translatePartialLoader",function(){function e(e,t){this.name=e,this.isActive=!0,this.tables={},this.priority=t||0}function t(e){return Object.prototype.hasOwnProperty.call(i,e)}function r(e){return angular.isString(e)&&""!==e}function n(e){if(!r(e))throw new TypeError("Invalid type of a first argument, a non-empty string expected.");return t(e)&&i[e].isActive}function a(e,t){for(var r in t)t[r]&&t[r].constructor&&t[r].constructor===Object?(e[r]=e[r]||{},a(e[r],t[r])):e[r]=t[r];return e}function o(){var e=[];for(var t in i)i[t].isActive&&e.push(i[t]);return e.sort(function(e,t){return e.priority-t.priority}),e}e.prototype.parseUrl=function(e,t){return angular.isFunction(e)?e(this.name,t):e.replace(/\{part\}/g,this.name).replace(/\{lang\}/g,t)},e.prototype.getTable=function(e,t,r,n,a,o){var i=t.defer();if(this.tables[e])i.resolve(this.tables[e]);else{var l=this;r(angular.extend({method:"GET",url:this.parseUrl(a,e)},n)).success(function(t){l.tables[e]=t,i.resolve(t)}).error(function(){o?o(l.name,e).then(function(t){l.tables[e]=t,i.resolve(t)},function(){i.reject(l.name)}):i.reject(l.name)})}return i.promise};var i={};this.addPart=function(n,a){if(!r(n))throw new TypeError("Couldn't add part, part name has to be a string!");return t(n)||(i[n]=new e(n,a)),i[n].isActive=!0,this},this.setPart=function(n,a,o){if(!r(n))throw new TypeError("Couldn't set part.`lang` parameter has to be a string!");if(!r(a))throw new TypeError("Couldn't set part.`part` parameter has to be a string!");if("object"!=typeof o||null===o)throw new TypeError("Couldn't set part. `table` parameter has to be an object!");return t(a)||(i[a]=new e(a),i[a].isActive=!1),i[a].tables[n]=o,this},this.deletePart=function(e){if(!r(e))throw new TypeError("Couldn't delete part, first arg has to be string.");return t(e)&&(i[e].isActive=!1),this},this.isPartAvailable=n,this.$get=["$rootScope","$injector","$q","$http",function(l,s,u,c){var f=function(e){if(!r(e.key))throw new TypeError("Unable to load data, a key is not a non-empty string.");if(!r(e.urlTemplate)&&!angular.isFunction(e.urlTemplate))throw new TypeError("Unable to load data, a urlTemplate is not a non-empty string or not a function.");var t=e.loadFailureHandler;if(void 0!==t){if(!angular.isString(t))throw new Error("Unable to load data, a loadFailureHandler is not a string.");t=s.get(t)}var n=[],i=u.defer(),l=o();return angular.forEach(l,function(r,a){n.push(r.getTable(e.key,u,c,e.$http,e.urlTemplate,t)),r.urlTemplate=e.urlTemplate}),u.all(n).then(function(){var t={};angular.forEach(l,function(r){a(t,r.tables[e.key])}),i.resolve(t)},function(){i.reject(e.key)}),i.promise};return f.addPart=function(n,a){if(!r(n))throw new TypeError("Couldn't add part, first arg has to be a string");return t(n)?i[n].isActive||(i[n].isActive=!0,l.$emit("$translatePartialLoaderStructureChanged",n)):(i[n]=new e(n,a),l.$emit("$translatePartialLoaderStructureChanged",n)),f},f.deletePart=function(e,n){if(!r(e))throw new TypeError("Couldn't delete part, first arg has to be string");if(void 0===n)n=!1;else if("boolean"!=typeof n)throw new TypeError("Invalid type of a second argument, a boolean expected.");if(t(e)){var a=i[e].isActive;if(n){var o=s.get("$translate"),u=o.loaderCache();"string"==typeof u&&(u=s.get(u)),"object"==typeof u&&angular.forEach(i[e].tables,function(t,r){u.remove(i[e].parseUrl(i[e].urlTemplate,r))}),delete i[e]}else i[e].isActive=!1;a&&l.$emit("$translatePartialLoaderStructureChanged",e)}return f},f.isPartLoaded=function(e,t){return angular.isDefined(i[e])&&angular.isDefined(i[e].tables[t])},f.getRegisteredParts=function(){var e=[];return angular.forEach(i,function(t){t.isActive&&e.push(t.name)}),e},f.isPartAvailable=n,f}]}),"pascalprecht.translate"}),function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]),angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]),angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(e){var t=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function(t,r,n,a,o,i){function l(){n.cancel(u),i.complete(),f=0,c=0}function s(t){var n,a=r.get("$http"),o=e.defaults;!t.cache&&!o.cache||t.cache===!1||"GET"!==t.method&&"JSONP"!==t.method||(n=angular.isObject(t.cache)?t.cache:angular.isObject(o.cache)?o.cache:a);var i=void 0!==n?void 0!==n.get(t.url):!1;return void 0!==t.cached&&i!==t.cached?t.cached:(t.cached=i,i)}var u,c=0,f=0,g=i.latencyThreshold;return{request:function(e){return e.ignoreLoadingBar||s(e)||(a.$broadcast("cfpLoadingBar:loading",{url:e.url}),0===c&&(u=n(function(){i.start()},g)),c++,i.set(f/c)),e},response:function(e){return e&&e.config?(e.config.ignoreLoadingBar||s(e.config)||(f++,a.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e}),f>=c?l():i.set(f/c)),e):(o.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50"),e)},responseError:function(e){return e&&e.config?(e.config.ignoreLoadingBar||s(e.config)||(f++,a.$broadcast("cfpLoadingBar:loaded",{url:e.config.url,result:e}),f>=c?l():i.set(f/c)),t.reject(e)):(o.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50"),t.reject(e))}}}];e.interceptors.push(t)}]),angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.02,this.parentSelector="body",this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>',this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>',this.$get=["$injector","$document","$timeout","$rootScope",function(e,t,r,n){function a(){c||(c=e.get("$animate"));var a=t.find(h).eq(0);r.cancel(g),m||(n.$broadcast("cfpLoadingBar:started"),m=!0,b&&c.enter(d,a,angular.element(a[0].lastChild)),y&&c.enter(v,a,angular.element(a[0].lastChild)),o(S))}function o(e){if(m){var t=100*e+"%";p.css("width",t),$=e,r.cancel(f),f=r(function(){i()},250)}}function i(){if(!(l()>=1)){var e=0,t=l();e=t>=0&&.25>t?(3*Math.random()+3)/100:t>=.25&&.65>t?3*Math.random()/100:t>=.65&&.9>t?2*Math.random()/100:t>=.9&&.99>t?.005:0;var r=l()+e;o(r)}}function l(){return $}function s(){$=0,m=!1}function u(){c||(c=e.get("$animate")),n.$broadcast("cfpLoadingBar:completed"),o(1),r.cancel(g),g=r(function(){var e=c.leave(d,s);e&&e.then&&e.then(s),c.leave(v)},500)}var c,f,g,h=this.parentSelector,d=angular.element(this.loadingBarTemplate),p=d.find("div").eq(0),v=angular.element(this.spinnerTemplate),m=!1,$=0,y=this.includeSpinner,b=this.includeBar,S=this.startSize;return{start:a,set:o,status:l,inc:i,complete:u,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}(),function(){"use strict";angular.module("auth",[]).service("TokenService",["$rootScope",function(e){function t(e){var t=e.replace("-","+").replace("_","/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return window.atob(t)}function r(e){var r={};if(null!=e)try{var n=e.split(".")[1];r=JSON.parse(t(n))}catch(a){}return r}function n(){return null!=localStorage.token&&null!=e.tokenClaims&&(new Date).getTime()<=1e3*e.tokenClaims.exp?!0:!1}this.setToken=function(t){t&&(localStorage.token=t,e.tokenClaims=r(t),e.token=t,n())||(delete localStorage.token,delete e.tokenClaims,delete e.token)},this.getToken=function(){return n()?localStorage.token:(this.setToken(null),null)},this.hasPermission=function(e){return!1},this.needsRefresh=function(t){return null!=localStorage.token&&null!=e.tokenClaims&&(new Date).getTime()>=1e3*e.tokenClaims.iat+t?!0:!1}}]).service("AuthService",["$http","urls",function(e,t){this.signup=function(r,n,a){e.post(t.BASE_API+"/signup",r).success(n).error(a)},this.signin=function(r,n,a){e.post(t.BASE_API+"/signin",r).success(n).error(a)},this.refresh=function(r,n){e.get(t.BASE_API+"/token-refresh",{ignoreLoadingBar:!0}).success(r).error(n)},this.logout=function(e){e()}}])}(),function(){"use strict";angular.module("search",[]).service("SearchService",["$http","urls",function(e,t){this.search=function(r,n,a){e.post(t.BASE_API+"/search",r).success(n).error(a)},this.advancedSearch=function(r,n,a){e.post(t.BASE_API+"/search/advanced",r).success(n).error(a)}}])}(),function(){"use strict";angular.module("vehicles",[]).factory("Vehicle",["$resource","urls",function(e,t){return e(t.BASE_API+"/vehicle/:vehicleId/:action",{vehicleId:"@vehicleId",action:"@action"},{preview:{method:"GET",params:{action:"preview"}}})}]).service("VehiclesService",["$http","Vehicle",function(e,t){this.get=function(e,r,n){var a=t.get({vehicleId:e},function(){r(a)},n)},this.preview=function(e,r,n){var a=t.preview({vehicleId:e},function(){r(a)},n)}}])}(),function(){"use strict";angular.module("auth").controller("AuthController",["$rootScope","$scope","$location","$translatePartialLoader","$interval","TokenService","AuthService",function(e,t,r,n,a,o,i){function l(t){r.path(e.returnTo?e.returnTo:"/")}function s(){o.setToken(null),r.path("/")}function u(){if(o.needsRefresh(6e4)){var e=o.getToken();e&&i.refresh(function(e){},function(){o.setToken(null)})}}e.tokenRefreshPromise||(e.tokenRefreshPromise=a(u,3e4)),n.addPart("auth"),t.signin=function(r){if(r){var n={email:t.email,password:t.password};i.signin(n,l,function(){e.error="Invalid credentials."})}},t.signup=function(r){if(r){delete t.signupFormInvalid;var n={name:t.name,email:t.email,password:t.password,password_confirmation:t.password_confirmation};i.signup(n,l,function(t){e.error=t.error||"Failed to sign up."})}else t.signupFormInvalid=!0},t.logout=function(){i.logout(s)}}])}(),function(){"use strict";var e=[];angular.module("search").controller("SearchController",["$rootScope","$scope","$location","$translatePartialLoader","SearchService","TokenService",function(t,r,n,a,o,i){function l(e){s(e&&e.vehicles?e.vehicles:[])}function s(t){e=t,r.vehicles=t,r.isPanelExpanded=e.length>0?!1:!0}function u(){t.error="Search failed",s([])}a.addPart("search"),r.search=function(){r.isAdvancedSearch=!1;var e={type:r.type,feature1:r.feature1};o.search(e,l,u)},r.advancedSearch=function(){if(null==i.getToken())return t.error="Access denied",void(r.isAdvancedSearch=!1);r.isAdvancedSearch=!0;var e={type:r.type,feature1:r.feature1,feature2:r.feature2,feature3:r.feature3};o.advancedSearch(e,l,u)},r.viewDetails=function(e){n.path("/vehicle/"+e)},r.select=function(e){r.isAdvancedSearch="advanced"===e&&null!=i.getToken()?!0:!1,r.isPanelExpanded=!0},s(e),r.isAdvancedSearch=!1}])}(),function(){"use strict";angular.module("vehicles").controller("VehiclesController",["$rootScope","$scope","TokenService","VehiclesService","$routeParams",function(e,t,r,n,a){function o(e){t.vehicle=e.vehicle}function i(t){e.error=t.data.error}a&&a.id&&(null==r.getToken()?n.preview(a.id,o,i):n.get(a.id,o,i))}])}(),function(){"use strict";angular.module("truxApp",["ngRoute","ngResource","angular-loading-bar","pascalprecht.translate","auth","search","vehicles"]).constant("urls",{BASE:"",BASE_API:"/api/v1"}).config(["$routeProvider","$httpProvider","$locationProvider","$translateProvider","$translatePartialLoaderProvider",function(e,t,r,n,a){e.when("/",{templateUrl:"modules/search/search.html",controller:"SearchController"}).when("/signin",{templateUrl:"modules/auth/signin.html",controller:"AuthController"}).when("/signup",{templateUrl:"modules/auth/signup.html",controller:"AuthController"}).when("/vehicle/:id",{templateUrl:"modules/vehicles/details.html",controller:"VehiclesController"}).when("/account",{restricted:!0,templateUrl:"modules/account/account.html",controller:"AuthController"}).otherwise({redirectTo:"/"}),t.interceptors.push(["$q","$location","$rootScope","TokenService",function(e,t,r,n){function a(e){var t=e.headers("X-JWT-Token");t&&n.setToken(t)}return{request:function(e){e.headers=e.headers||{};var t=n.getToken();return null!=t&&(e.headers.Authorization="Bearer "+t),e},response:function(e){return 200===e.status&&a(e),e},responseError:function(o){return 401===o.status||403===o.status?(n.setToken(null),r.returnTo=t.path(),t.path("/signin")):a(o),e.reject(o)}}}]),r.html5Mode(!0),n.useLoader("$translatePartialLoader",{urlTemplate:"/modules/{part}/locale/{lang}.json"}).registerAvailableLanguageKeys(["en","de","ru","lt"],{en_US:"en",en_UK:"en",de_DE:"de",de_CH:"de",ru_RU:"ru",lt_LT:"lt"}).fallbackLanguage("en").determinePreferredLanguage().useSanitizeValueStrategy("escaped"),a.addPart("auth"),a.addPart("search")}]).controller("TranslateController",["$translate","$scope",function(e,t){localStorage.langKey?(e.use(localStorage.langKey),t.currentLanguage=localStorage.langKey):t.currentLanguage=e.use(),t.languages=[{id:"de",label:"Deutsch"},{id:"ru",label:"Русский"},{id:"lt",label:"Lietuvių"},{id:"en",label:"English"}],t.changeLanguage=function(){e.use(t.currentLanguage),localStorage.langKey=t.currentLanguage}}]).run(["$rootScope","$location","$translate","TokenService",function(e,t,r,n){e.$on("$routeChangeStart",function(r,a){delete e.error,null==n.getToken()&&(a&&a.restricted===!0?(e.returnTo=t.path(),t.path("/signin")):e.returnTo&&delete e.returnTo)}),e.$on("$translatePartialLoaderStructureChanged",function(){r.refresh()}),n.setToken(localStorage.token)}])}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFuZ3VsYXItdHJhbnNsYXRlLmpzIiwiYW5ndWxhci10cmFuc2xhdGUtbG9hZGVyLXBhcnRpYWwuanMiLCJsb2FkaW5nLWJhci5qcyIsImF1dGgvc2VydmljZXMuanMiLCJzZWFyY2gvc2VydmljZXMuanMiLCJ2ZWhpY2xlcy9zZXJ2aWNlcy5qcyIsImF1dGgvY29udHJvbGxlcnMuanMiLCJzZWFyY2gvY29udHJvbGxlcnMuanMiLCJ2ZWhpY2xlcy9jb250cm9sbGVycy5qcyIsIm1haW4uanMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJkZWZpbmUiLCJhbWQiLCJleHBvcnRzIiwibW9kdWxlIiwidGhpcyIsImFuZ3VsYXIiLCJydW4iLCIkdHJhbnNsYXRlIiwia2V5Iiwic3RvcmFnZUtleSIsInN0b3JhZ2UiLCJmYWxsYmFja0Zyb21JbmNvcnJlY3RTdG9yYWdlVmFsdWUiLCJwcmVmZXJyZWQiLCJwcmVmZXJyZWRMYW5ndWFnZSIsImlzU3RyaW5nIiwidXNlIiwicHV0IiwiZ2V0IiwicHJvdmlkZXIiLCIkU1RPUkFHRV9LRVkiLCIkd2luZG93UHJvdmlkZXIiLCIkcHJlZmVycmVkTGFuZ3VhZ2UiLCIkbGFuZ3VhZ2VLZXlBbGlhc2VzIiwiJGZhbGxiYWNrTGFuZ3VhZ2UiLCIkZmFsbGJhY2tXYXNTdHJpbmciLCIkdXNlcyIsIiRuZXh0TGFuZyIsIiRzdG9yYWdlRmFjdG9yeSIsIiRzdG9yYWdlUHJlZml4IiwiJG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJGYWN0b3J5IiwiJGludGVycG9sYXRpb25GYWN0b3J5IiwiJGxvYWRlckZhY3RvcnkiLCIkbG9hZGVyT3B0aW9ucyIsIiRub3RGb3VuZEluZGljYXRvckxlZnQiLCIkbm90Rm91bmRJbmRpY2F0b3JSaWdodCIsImxvYWRlckNhY2hlIiwiJHRyYW5zbGF0aW9uVGFibGUiLCIkYXZhaWxhYmxlTGFuZ3VhZ2VLZXlzIiwiJHN0b3JhZ2VLZXkiLCIkaW50ZXJwb2xhdG9yRmFjdG9yaWVzIiwiJGludGVycG9sYXRpb25TYW5pdGl6YXRpb25TdHJhdGVneSIsIiRjbG9ha0NsYXNzTmFtZSIsIiRwb3N0Q29tcGlsaW5nRW5hYmxlZCIsIk5FU1RFRF9PQkpFQ1RfREVMSU1JVEVSIiwiZGlyZWN0aXZlUHJpb3JpdHkiLCJzdGF0ZWZ1bEZpbHRlciIsInZlcnNpb24iLCJnZXRGaXJzdEJyb3dzZXJMYW5ndWFnZSIsImkiLCJsYW5ndWFnZSIsIm5hdiIsIiRnZXQiLCJuYXZpZ2F0b3IiLCJicm93c2VyTGFuZ3VhZ2VQcm9wZXJ0eUtleXMiLCJpc0FycmF5IiwibGFuZ3VhZ2VzIiwibGVuZ3RoIiwiZGlzcGxheU5hbWUiLCJnZXRMb2NhbGUiLCJzcGxpdCIsImpvaW4iLCJpbmRleE9mIiwiYXJyYXkiLCJzZWFyY2hFbGVtZW50IiwibGVuIiwidHJpbSIsInJlcGxhY2UiLCJuZWdvdGlhdGVMb2NhbGUiLCJhdmFpbCIsImxvY2FsZSIsImxvd2VyY2FzZSIsIm4iLCJwdXNoIiwiYWxpYXMiLCJsYW5nS2V5QWxpYXMiLCJoYXNXaWxkY2FyZEtleSIsImhhc0V4YWN0S2V5IiwiT2JqZWN0IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwic2xpY2UiLCJwYXJ0cyIsInRyYW5zbGF0aW9ucyIsImxhbmdLZXkiLCJ0cmFuc2xhdGlvblRhYmxlIiwiaXNPYmplY3QiLCJleHRlbmQiLCJmbGF0T2JqZWN0IiwiY2xvYWtDbGFzc05hbWUiLCJuYW1lIiwiZGF0YSIsInBhdGgiLCJyZXN1bHQiLCJwcmV2S2V5Iiwia2V5V2l0aFBhdGgiLCJrZXlXaXRoU2hvcnRQYXRoIiwidmFsIiwiY29uY2F0IiwiYWRkSW50ZXJwb2xhdGlvbiIsInVzZU1lc3NhZ2VGb3JtYXRJbnRlcnBvbGF0aW9uIiwidXNlSW50ZXJwb2xhdGlvbiIsInVzZVNhbml0aXplVmFsdWVTdHJhdGVneSIsInZhbHVlIiwic2V0dXBQcmVmZXJyZWRMYW5ndWFnZSIsInRyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3IiLCJpbmRpY2F0b3IiLCJ0cmFuc2xhdGlvbk5vdEZvdW5kSW5kaWNhdG9yTGVmdCIsInRyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3JSaWdodCIsImZhbGxiYWNrTGFuZ3VhZ2UiLCJmYWxsYmFja1N0YWNrIiwiRXJyb3IiLCJ1c2VVcmxMb2FkZXIiLCJ1cmwiLCJvcHRpb25zIiwidXNlTG9hZGVyIiwidXNlU3RhdGljRmlsZXNMb2FkZXIiLCJsb2FkZXJGYWN0b3J5IiwidXNlTG9jYWxTdG9yYWdlIiwidXNlU3RvcmFnZSIsInVzZUNvb2tpZVN0b3JhZ2UiLCJzdG9yYWdlRmFjdG9yeSIsInN0b3JhZ2VQcmVmaXgiLCJwcmVmaXgiLCJ1c2VNaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyTG9nIiwidXNlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlciIsInVzZVBvc3RDb21waWxpbmciLCJkZXRlcm1pbmVQcmVmZXJyZWRMYW5ndWFnZSIsImZuIiwiaXNGdW5jdGlvbiIsInJlZ2lzdGVyQXZhaWxhYmxlTGFuZ3VhZ2VLZXlzIiwibGFuZ3VhZ2VLZXlzIiwiYWxpYXNlcyIsInVzZUxvYWRlckNhY2hlIiwiY2FjaGUiLCJ1bmRlZmluZWQiLCJwcmlvcml0eSIsInN0YXRlIiwiJGxvZyIsIiRpbmplY3RvciIsIiRyb290U2NvcGUiLCIkcSIsIlN0b3JhZ2UiLCJmYWxsYmFja0luZGV4Iiwic3RhcnRGYWxsYmFja0l0ZXJhdGlvbiIsImRlZmF1bHRJbnRlcnBvbGF0b3IiLCJwZW5kaW5nTG9hZGVyIiwiaW50ZXJwb2xhdG9ySGFzaE1hcCIsImxhbmdQcm9taXNlcyIsInRyYW5zbGF0aW9uSWQiLCJpbnRlcnBvbGF0ZVBhcmFtcyIsImludGVycG9sYXRpb25JZCIsImRlZmF1bHRUcmFuc2xhdGlvblRleHQiLCJ0cmFuc2xhdGVBbGwiLCJ0cmFuc2xhdGlvbklkcyIsInJlc3VsdHMiLCJwcm9taXNlcyIsInRyYW5zbGF0ZSIsImRlZmVycmVkIiwiZGVmZXIiLCJyZWdhcmRsZXNzIiwicmVzb2x2ZSIsInRoZW4iLCJwcm9taXNlIiwiYyIsImFsbCIsImFwcGx5IiwicHJvbWlzZVRvV2FpdEZvciIsImluZGV4IiwiZGV0ZXJtaW5lVHJhbnNsYXRpb24iLCJyZWplY3QiLCJhcHBseU5vdEZvdW5kSW5kaWNhdG9ycyIsInVzZUxhbmd1YWdlIiwiJGVtaXQiLCJzZXRMb2NhbGUiLCJmb3JFYWNoIiwiaW50ZXJwb2xhdG9yIiwiaWQiLCJsb2FkQXN5bmMiLCJsb2FkZXJPcHRpb25zIiwiJGh0dHAiLCJ0YWJsZSIsImludGVycG9sYXRvckZhY3RvcnkiLCJnZXRJbnRlcnBvbGF0aW9uSWRlbnRpZmllciIsImdldFRyYW5zbGF0aW9uVGFibGUiLCJnZXRGYWxsYmFja1RyYW5zbGF0aW9uIiwiSW50ZXJwb2xhdG9yIiwidHJhbnNsYXRpb24iLCJzdWJzdHIiLCJpbnRlcnBvbGF0ZSIsImdldEZhbGxiYWNrVHJhbnNsYXRpb25JbnN0YW50IiwidHJhbnNsYXRlQnlIYW5kbGVyIiwicmVzdWx0U3RyaW5nIiwicmVzb2x2ZUZvckZhbGxiYWNrTGFuZ3VhZ2UiLCJmYWxsYmFja0xhbmd1YWdlSW5kZXgiLCJyZXNvbHZlRm9yRmFsbGJhY2tMYW5ndWFnZUluc3RhbnQiLCJmYWxsYmFja1RyYW5zbGF0aW9uIiwiZmFsbGJhY2tUcmFuc2xhdGlvbkluc3RhbnQiLCJtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyVHJhbnNsYXRpb24iLCJfdHJhbnNsYXRpb25JZCIsImRldGVybWluZVRyYW5zbGF0aW9uSW5zdGFudCIsImNsZWFyTmV4dExhbmdBbmRQcm9taXNlIiwidXNlRmFsbGJhY2tMYW5ndWFnZSIsImxhbmdLZXlQb3NpdGlvbiIsInByb3Bvc2VkTGFuZ3VhZ2UiLCJhbGlhc2VkS2V5IiwiaXNQb3N0Q29tcGlsaW5nRW5hYmxlZCIsInJlZnJlc2giLCJ0YWJsZXMiLCJsb2FkaW5nS2V5cyIsInRhYmxlRGF0YSIsImluc3RhbnQiLCJpc1VuZGVmaW5lZCIsInBvc3NpYmxlTGFuZ0tleXMiLCJqIiwiZCIsInBvc3NpYmxlTGFuZ0tleSIsInZlcnNpb25JbmZvIiwiZXF1YWxzIiwicHJvY2Vzc0FzeW5jUmVzdWx0IiwiZmFsbGJhY2tMYW5ndWFnZUlkIiwiJGludGVycG9sYXRlIiwiJGxvY2FsZSIsIiR0cmFuc2xhdGVJbnRlcnBvbGF0b3IiLCIkaWRlbnRpZmllciIsIiRzYW5pdGl6ZVZhbHVlU3RyYXRlZ3kiLCJzYW5pdGl6ZVZhbHVlU3RyYXRlZ2llcyIsImVzY2FwZWQiLCJwYXJhbXMiLCJpc051bWJlciIsImVsZW1lbnQiLCJ0ZXh0IiwiaHRtbCIsInNhbml0aXplUGFyYW1zIiwic3RyaW5nIiwiY29uc3RhbnQiLCJkaXJlY3RpdmUiLCIkY29tcGlsZSIsIiRwYXJzZSIsInJlc3RyaWN0Iiwic2NvcGUiLCJjb21waWxlIiwidEVsZW1lbnQiLCJ0QXR0ciIsInRyYW5zbGF0ZVZhbHVlc0V4aXN0IiwidHJhbnNsYXRlVmFsdWVzIiwidHJhbnNsYXRlSW50ZXJwb2xhdGlvbiIsInRyYW5zbGF0ZVZhbHVlRXhpc3QiLCJvdXRlckhUTUwiLCJtYXRjaCIsImludGVycG9sYXRlUmVnRXhwIiwic3RhcnRTeW1ib2wiLCJlbmRTeW1ib2wiLCJ3YXRjaGVyUmVnRXhwIiwiaUVsZW1lbnQiLCJpQXR0ciIsInByZVRleHQiLCJwb3N0VGV4dCIsIiRwYXJlbnQiLCJvYnNlcnZlRWxlbWVudFRyYW5zbGF0aW9uIiwiX3Vud2F0Y2hPbGQiLCJpc0RlZmluZWQiLCJhdHRyIiwiYXR0cmlidXRlTmFtZSIsImludGVycG9sYXRlTWF0Y2hlcyIsIndhdGNoZXJNYXRjaGVzIiwiJHdhdGNoIiwibmV3VmFsdWUiLCJ1cGRhdGVUcmFuc2xhdGlvbnMiLCJvYnNlcnZlQXR0cmlidXRlVHJhbnNsYXRpb24iLCJ0cmFuc2xhdGVBdHRyIiwiJG9ic2VydmUiLCJmaXJzdEF0dHJpYnV0ZUNoYW5nZWRFdmVudCIsImRlZmF1bHRUZXh0Iiwib2JzZXJ2ZVZhbHVlQXR0cmlidXRlIiwiYXR0ck5hbWUiLCJ1cGRhdGVUcmFuc2xhdGlvbiIsImFwcGx5VHJhbnNsYXRpb24iLCJzdWNjZXNzZnVsIiwiZ2xvYmFsbHlFbmFibGVkIiwibG9jYWxseURlZmluZWQiLCJ0cmFuc2xhdGVDb21waWxlIiwibG9jYWxseUVuYWJsZWQiLCJjb250ZW50cyIsIiRhdHRyIiwidW5iaW5kIiwiJG9uIiwiYXBwbHlDbG9hayIsImFkZENsYXNzIiwicmVtb3ZlQ2xvYWsiLCJyZW1vdmVDbGFzcyIsInJlbW92ZUxpc3RlbmVyIiwidHJhbnNsYXRlQ2xvYWsiLCJmaWx0ZXIiLCJ0cmFuc2xhdGVGaWx0ZXIiLCJpbnRlcnBvbGF0aW9uIiwiJHN0YXRlZnVsIiwiUGFydCIsImlzQWN0aXZlIiwiaGFzUGFydCIsImlzU3RyaW5nVmFsaWQiLCJzdHIiLCJpc1BhcnRBdmFpbGFibGUiLCJUeXBlRXJyb3IiLCJkZWVwRXh0ZW5kIiwiZHN0Iiwic3JjIiwicHJvcGVydHkiLCJjb25zdHJ1Y3RvciIsImdldFByaW9yaXRpemVkUGFydHMiLCJwcmlvcml0aXplZFBhcnRzIiwicGFydCIsInNvcnQiLCJhIiwiYiIsInBhcnNlVXJsIiwidXJsVGVtcGxhdGUiLCJ0YXJnZXRMYW5nIiwiZ2V0VGFibGUiLCJsYW5nIiwiJGh0dHBPcHRpb25zIiwiZXJyb3JIYW5kbGVyIiwic2VsZiIsIm1ldGhvZCIsInN1Y2Nlc3MiLCJlcnJvciIsImFkZFBhcnQiLCJzZXRQYXJ0IiwiZGVsZXRlUGFydCIsInNlcnZpY2UiLCJsb2FkRmFpbHVyZUhhbmRsZXIiLCJsb2FkZXJzIiwicmVtb3ZlRGF0YSIsIndhc0FjdGl2ZSIsInJlbW92ZSIsImlzUGFydExvYWRlZCIsImdldFJlZ2lzdGVyZWRQYXJ0cyIsInJlZ2lzdGVyZWRQYXJ0cyIsInAiLCJjb25maWciLCIkaHR0cFByb3ZpZGVyIiwiaW50ZXJjZXB0b3IiLCIkY2FjaGVGYWN0b3J5IiwiJHRpbWVvdXQiLCJjZnBMb2FkaW5nQmFyIiwic2V0Q29tcGxldGUiLCJjYW5jZWwiLCJzdGFydFRpbWVvdXQiLCJjb21wbGV0ZSIsInJlcXNDb21wbGV0ZWQiLCJyZXFzVG90YWwiLCJpc0NhY2hlZCIsImRlZmF1bHRDYWNoZSIsImRlZmF1bHRzIiwiY2FjaGVkIiwibGF0ZW5jeVRocmVzaG9sZCIsInJlcXVlc3QiLCJpZ25vcmVMb2FkaW5nQmFyIiwiJGJyb2FkY2FzdCIsInN0YXJ0Iiwic2V0IiwicmVzcG9uc2UiLCJyZXNwb25zZUVycm9yIiwicmVqZWN0aW9uIiwiaW50ZXJjZXB0b3JzIiwiaW5jbHVkZVNwaW5uZXIiLCJpbmNsdWRlQmFyIiwic3RhcnRTaXplIiwicGFyZW50U2VsZWN0b3IiLCJzcGlubmVyVGVtcGxhdGUiLCJsb2FkaW5nQmFyVGVtcGxhdGUiLCIkZG9jdW1lbnQiLCJfc3RhcnQiLCIkYW5pbWF0ZSIsImZpbmQiLCIkcGFyZW50U2VsZWN0b3IiLCJlcSIsImNvbXBsZXRlVGltZW91dCIsInN0YXJ0ZWQiLCJlbnRlciIsImxvYWRpbmdCYXJDb250YWluZXIiLCJsYXN0Q2hpbGQiLCJzcGlubmVyIiwiX3NldCIsInBjdCIsImxvYWRpbmdCYXIiLCJjc3MiLCJzdGF0dXMiLCJpbmNUaW1lb3V0IiwiX2luYyIsIl9zdGF0dXMiLCJybmQiLCJzdGF0IiwiTWF0aCIsInJhbmRvbSIsIl9jb21wbGV0ZUFuaW1hdGlvbiIsIl9jb21wbGV0ZSIsImxlYXZlIiwiaW5jIiwidXJsQmFzZTY0RGVjb2RlIiwib3V0cHV0Iiwid2luZG93IiwiYXRvYiIsImdldFRva2VuQ2xhaW1zIiwidG9rZW4iLCJjbGFpbXMiLCJlbmNvZGVkIiwiSlNPTiIsInBhcnNlIiwiZSIsImlzVG9rZW5WYWxpZCIsImxvY2FsU3RvcmFnZSIsInRva2VuQ2xhaW1zIiwiRGF0ZSIsImdldFRpbWUiLCJzZXRUb2tlbiIsImdldFRva2VuIiwiaGFzUGVybWlzc2lvbiIsInJlc291cmNlIiwibmVlZHNSZWZyZXNoIiwiYWdlIiwiaWF0IiwidXJscyIsInNpZ251cCIsInBvc3QiLCJCQVNFX0FQSSIsInNpZ25pbiIsImxvZ291dCIsInNlYXJjaCIsImFkdmFuY2VkU2VhcmNoIiwiJHJlc291cmNlIiwidmVoaWNsZUlkIiwiYWN0aW9uIiwicHJldmlldyIsIlZlaGljbGUiLCJ2ZWNoaWNsZUlkIiwidmVoaWNsZSIsImNvbnRyb2xsZXIiLCIkc2NvcGUiLCIkbG9jYXRpb24iLCIkdHJhbnNsYXRlUGFydGlhbExvYWRlciIsIiRpbnRlcnZhbCIsInRva2VuU2VydmljZSIsImF1dGhTZXJ2aWNlIiwic3VjY2Vzc0F1dGgiLCJyZXMiLCJyZXR1cm5UbyIsInN1Y2Nlc3NMb2dvdXQiLCJyZWZyZXNoVG9rZW4iLCJ0b2tlblJlZnJlc2hQcm9taXNlIiwiaXNWYWxpZCIsImZvcm1EYXRhIiwiZW1haWwiLCJwYXNzd29yZCIsInNpZ251cEZvcm1JbnZhbGlkIiwicGFzc3dvcmRfY29uZmlybWF0aW9uIiwidmVoaWNsZXMiLCJzZWFyY2hTZXJ2aWNlIiwic2VhcmNoU3VjY2VzcyIsInNldFZlaGljbGVzIiwiJHZlaGljbGVzIiwiaXNQYW5lbEV4cGFuZGVkIiwic2VhcmNoRmFpbGVkIiwiaXNBZHZhbmNlZFNlYXJjaCIsInR5cGUiLCJmZWF0dXJlMSIsImZlYXR1cmUyIiwiZmVhdHVyZTMiLCJ2aWV3RGV0YWlscyIsInNlbGVjdCIsIiR0YWIiLCJ2ZWhpY2xlc1NlcnZpY2UiLCIkcm91dGVQYXJhbXMiLCJCQVNFIiwiJHJvdXRlUHJvdmlkZXIiLCIkbG9jYXRpb25Qcm92aWRlciIsIiR0cmFuc2xhdGVQcm92aWRlciIsIiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyUHJvdmlkZXIiLCJ3aGVuIiwidGVtcGxhdGVVcmwiLCJyZXN0cmljdGVkIiwib3RoZXJ3aXNlIiwicmVkaXJlY3RUbyIsImV4dHJhY3RUb2tlbiIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiaHRtbDVNb2RlIiwiZW5fVVMiLCJlbl9VSyIsImRlX0RFIiwiZGVfQ0giLCJydV9SVSIsImx0X0xUIiwiY3VycmVudExhbmd1YWdlIiwibGFiZWwiLCJjaGFuZ2VMYW5ndWFnZSIsImV2ZW50IiwibmV4dCJdLCJtYXBwaW5ncyI6IkNBS0EsU0FBQUEsRUFBQUMsR0FDQSxrQkFBQUMs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QUEsS0FBQSxPQUNBcVcsTUFBQSxLQUNBQyxNQUFBLEtBQ0FDLE1BQUEsS0FDQUMsTUFBQSxLQUNBQyxNQUFBLEtBQ0FDLE1BQUEsT0FFQS9YLGlCQUFBLE1BQ0FrQiw2QkFDQXpCLHlCQUFBLFdBR0F1WCxFQUFBdkosUUFBQSxRQUNBdUosRUFBQXZKLFFBQUEsYUFFQStHLFdBQUEsdUJBQUEsYUFBQSxTQUFBLFNBQUE5YSxFQUFBK2EsR0FDQTNCLGFBQUF2VSxTQUNBN0UsRUFBQVEsSUFBQTRZLGFBQUF2VSxTQUNBa1csRUFBQXVELGdCQUFBbEYsYUFBQXZVLFNBR0FrVyxFQUFBdUQsZ0JBQUF0ZSxFQUFBUSxNQUdBdWEsRUFBQS9YLFlBQ0EwSCxHQUFBLEtBQUE2VCxNQUFBLFlBQ0E3VCxHQUFBLEtBQUE2VCxNQUFBLFlBQ0E3VCxHQUFBLEtBQUE2VCxNQUFBLGFBQ0E3VCxHQUFBLEtBQUE2VCxNQUFBLFlBRUF4RCxFQUFBeUQsZUFBQSxXQUNBeGUsRUFBQVEsSUFBQXVhLEVBQUF1RCxpQkFDQWxGLGFBQUF2VSxRQUFBa1csRUFBQXVELG9CQUdBdmUsS0FBQSxhQUFBLFlBQUEsYUFBQSxlQUNBLFNBQUFzSSxFQUFBMlMsRUFBQWhiLEVBQUFtYixHQUNBOVMsRUFBQWtKLElBQUEsb0JBQUEsU0FBQWtOLEVBQUFDLFNBQ0FyVyxHQUFBeUwsTUFDQSxNQUFBcUgsRUFBQTFCLGFBQ0FpRixHQUFBQSxFQUFBakIsY0FBQSxHQUNBcFYsRUFBQWtULFNBQUFQLEVBQUEzVixPQUNBMlYsRUFBQTNWLEtBQUEsWUFFQWdELEVBQUFrVCxnQkFDQWxULEdBQUFrVCxZQUtBbFQsRUFBQWtKLElBQUEsMENBQUEsV0FDQXZSLEVBQUF3TSxZQUdBMk8sRUFBQTNCLFNBQUFKLGFBQUFQIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogYW5ndWxhci10cmFuc2xhdGUgLSB2Mi43LjAgLSAyMDE1LTA0LTE1XG4gKiBodHRwOi8vZ2l0aHViLmNvbS9hbmd1bGFyLXRyYW5zbGF0ZS9hbmd1bGFyLXRyYW5zbGF0ZVxuICogQ29weXJpZ2h0IChjKSAyMDE1IDsgTGljZW5zZWQgTUlUXG4gKi9cbihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlIHVubGVzcyBhbWRNb2R1bGVJZCBpcyBzZXRcbiAgICBkZWZpbmUoW10sIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAoZmFjdG9yeSgpKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcbiAgICAvLyBvbmx5IENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHRoYXQgc3VwcG9ydCBtb2R1bGUuZXhwb3J0cyxcbiAgICAvLyBsaWtlIE5vZGUuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gIH0gZWxzZSB7XG4gICAgZmFjdG9yeSgpO1xuICB9XG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcblxuLyoqXG4gKiBAbmdkb2Mgb3ZlcnZpZXdcbiAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFRoZSBtYWluIG1vZHVsZSB3aGljaCBob2xkcyBldmVyeXRoaW5nIHRvZ2V0aGVyLlxuICovXG5hbmd1bGFyLm1vZHVsZSgncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScsIFsnbmcnXSlcblxuLnJ1bihbJyR0cmFuc2xhdGUnLCBmdW5jdGlvbiAoJHRyYW5zbGF0ZSkge1xuXG4gIHZhciBrZXkgPSAkdHJhbnNsYXRlLnN0b3JhZ2VLZXkoKSxcbiAgICAgIHN0b3JhZ2UgPSAkdHJhbnNsYXRlLnN0b3JhZ2UoKTtcblxuICB2YXIgZmFsbGJhY2tGcm9tSW5jb3JyZWN0U3RvcmFnZVZhbHVlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHByZWZlcnJlZCA9ICR0cmFuc2xhdGUucHJlZmVycmVkTGFuZ3VhZ2UoKTtcbiAgICBpZiAoYW5ndWxhci5pc1N0cmluZyhwcmVmZXJyZWQpKSB7XG4gICAgICAkdHJhbnNsYXRlLnVzZShwcmVmZXJyZWQpO1xuICAgICAgLy8gJHRyYW5zbGF0ZS51c2UoKSB3aWxsIGFsc28gcmVtZW1iZXIgdGhlIGxhbmd1YWdlLlxuICAgICAgLy8gU28sIHdlIGRvbid0IG5lZWQgdG8gY2FsbCBzdG9yYWdlLnB1dCgpIGhlcmUuXG4gICAgfSBlbHNlIHtcbiAgICAgIHN0b3JhZ2UucHV0KGtleSwgJHRyYW5zbGF0ZS51c2UoKSk7XG4gICAgfVxuICB9O1xuXG4gIGlmIChzdG9yYWdlKSB7XG4gICAgaWYgKCFzdG9yYWdlLmdldChrZXkpKSB7XG4gICAgICBmYWxsYmFja0Zyb21JbmNvcnJlY3RTdG9yYWdlVmFsdWUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJHRyYW5zbGF0ZS51c2Uoc3RvcmFnZS5nZXQoa2V5KSlbJ2NhdGNoJ10oZmFsbGJhY2tGcm9tSW5jb3JyZWN0U3RvcmFnZVZhbHVlKTtcbiAgICB9XG4gIH0gZWxzZSBpZiAoYW5ndWxhci5pc1N0cmluZygkdHJhbnNsYXRlLnByZWZlcnJlZExhbmd1YWdlKCkpKSB7XG4gICAgJHRyYW5zbGF0ZS51c2UoJHRyYW5zbGF0ZS5wcmVmZXJyZWRMYW5ndWFnZSgpKTtcbiAgfVxufV0pO1xuXG4vKipcbiAqIEBuZ2RvYyBvYmplY3RcbiAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyXG4gKiBAZGVzY3JpcHRpb25cbiAqXG4gKiAkdHJhbnNsYXRlUHJvdmlkZXIgYWxsb3dzIGRldmVsb3BlcnMgdG8gcmVnaXN0ZXIgdHJhbnNsYXRpb24tdGFibGVzLCBhc3luY2hyb25vdXMgbG9hZGVyc1xuICogYW5kIHNpbWlsYXIgdG8gY29uZmlndXJlIHRyYW5zbGF0aW9uIGJlaGF2aW9yIGRpcmVjdGx5IGluc2lkZSBvZiBhIG1vZHVsZS5cbiAqXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdwYXNjYWxwcmVjaHQudHJhbnNsYXRlJykucHJvdmlkZXIoJyR0cmFuc2xhdGUnLCBbJyRTVE9SQUdFX0tFWScsICckd2luZG93UHJvdmlkZXInLCBmdW5jdGlvbiAoJFNUT1JBR0VfS0VZLCAkd2luZG93UHJvdmlkZXIpIHtcblxuICB2YXIgJHRyYW5zbGF0aW9uVGFibGUgPSB7fSxcbiAgICAgICRwcmVmZXJyZWRMYW5ndWFnZSxcbiAgICAgICRhdmFpbGFibGVMYW5ndWFnZUtleXMgPSBbXSxcbiAgICAgICRsYW5ndWFnZUtleUFsaWFzZXMsXG4gICAgICAkZmFsbGJhY2tMYW5ndWFnZSxcbiAgICAgICRmYWxsYmFja1dhc1N0cmluZyxcbiAgICAgICR1c2VzLFxuICAgICAgJG5leHRMYW5nLFxuICAgICAgJHN0b3JhZ2VGYWN0b3J5LFxuICAgICAgJHN0b3JhZ2VLZXkgPSAkU1RPUkFHRV9LRVksXG4gICAgICAkc3RvcmFnZVByZWZpeCxcbiAgICAgICRtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyRmFjdG9yeSxcbiAgICAgICRpbnRlcnBvbGF0aW9uRmFjdG9yeSxcbiAgICAgICRpbnRlcnBvbGF0b3JGYWN0b3JpZXMgPSBbXSxcbiAgICAgICRpbnRlcnBvbGF0aW9uU2FuaXRpemF0aW9uU3RyYXRlZ3kgPSBmYWxzZSxcbiAgICAgICRsb2FkZXJGYWN0b3J5LFxuICAgICAgJGNsb2FrQ2xhc3NOYW1lID0gJ3RyYW5zbGF0ZS1jbG9haycsXG4gICAgICAkbG9hZGVyT3B0aW9ucyxcbiAgICAgICRub3RGb3VuZEluZGljYXRvckxlZnQsXG4gICAgICAkbm90Rm91bmRJbmRpY2F0b3JSaWdodCxcbiAgICAgICRwb3N0Q29tcGlsaW5nRW5hYmxlZCA9IGZhbHNlLFxuICAgICAgTkVTVEVEX09CSkVDVF9ERUxJTUlURVIgPSAnLicsXG4gICAgICBsb2FkZXJDYWNoZSxcbiAgICAgIGRpcmVjdGl2ZVByaW9yaXR5ID0gMCxcbiAgICAgIHN0YXRlZnVsRmlsdGVyID0gdHJ1ZTtcblxuICB2YXIgdmVyc2lvbiA9ICcyLjcuMCc7XG5cbiAgLy8gdHJpZXMgdG8gZGV0ZXJtaW5lIHRoZSBicm93c2VycyBsYW5ndWFnZVxuICB2YXIgZ2V0Rmlyc3RCcm93c2VyTGFuZ3VhZ2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5hdiA9ICR3aW5kb3dQcm92aWRlci4kZ2V0KCkubmF2aWdhdG9yLFxuICAgICAgICBicm93c2VyTGFuZ3VhZ2VQcm9wZXJ0eUtleXMgPSBbJ2xhbmd1YWdlJywgJ2Jyb3dzZXJMYW5ndWFnZScsICdzeXN0ZW1MYW5ndWFnZScsICd1c2VyTGFuZ3VhZ2UnXSxcbiAgICAgICAgaSxcbiAgICAgICAgbGFuZ3VhZ2U7XG5cbiAgICAvLyBzdXBwb3J0IGZvciBIVE1MIDUuMSBcIm5hdmlnYXRvci5sYW5ndWFnZXNcIlxuICAgIGlmIChhbmd1bGFyLmlzQXJyYXkobmF2Lmxhbmd1YWdlcykpIHtcbiAgICAgIGZvciAoaSA9IDA7IGkgPCBuYXYubGFuZ3VhZ2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGxhbmd1YWdlID0gbmF2Lmxhbmd1YWdlc1tpXTtcbiAgICAgICAgaWYgKGxhbmd1YWdlICYmIGxhbmd1YWdlLmxlbmd0aCkge1xuICAgICAgICAgIHJldHVybiBsYW5ndWFnZTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIHN1cHBvcnQgZm9yIG90aGVyIHdlbGwga25vd24gcHJvcGVydGllcyBpbiBicm93c2Vyc1xuICAgIGZvciAoaSA9IDA7IGkgPCBicm93c2VyTGFuZ3VhZ2VQcm9wZXJ0eUtleXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxhbmd1YWdlID0gbmF2W2Jyb3dzZXJMYW5ndWFnZVByb3BlcnR5S2V5c1tpXV07XG4gICAgICBpZiAobGFuZ3VhZ2UgJiYgbGFuZ3VhZ2UubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBsYW5ndWFnZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gbnVsbDtcbiAgfTtcbiAgZ2V0Rmlyc3RCcm93c2VyTGFuZ3VhZ2UuZGlzcGxheU5hbWUgPSAnYW5ndWxhci10cmFuc2xhdGUvc2VydmljZTogZ2V0Rmlyc3RCcm93c2VyTGFuZ3VhZ2UnO1xuXG4gIC8vIHRyaWVzIHRvIGRldGVybWluZSB0aGUgYnJvd3NlcnMgbG9jYWxlXG4gIHZhciBnZXRMb2NhbGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIChnZXRGaXJzdEJyb3dzZXJMYW5ndWFnZSgpIHx8ICcnKS5zcGxpdCgnLScpLmpvaW4oJ18nKTtcbiAgfTtcbiAgZ2V0TG9jYWxlLmRpc3BsYXlOYW1lID0gJ2FuZ3VsYXItdHJhbnNsYXRlL3NlcnZpY2U6IGdldExvY2FsZSc7XG5cbiAgLyoqXG4gICAqIEBuYW1lIGluZGV4T2ZcbiAgICogQHByaXZhdGVcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIGluZGV4T2YgcG9seWZpbGwuIEtpbmRhIHNvcnRhLlxuICAgKlxuICAgKiBAcGFyYW0ge2FycmF5fSBhcnJheSBBcnJheSB0byBzZWFyY2ggaW4uXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBzZWFyY2hFbGVtZW50IEVsZW1lbnQgdG8gc2VhcmNoIGZvci5cbiAgICpcbiAgICogQHJldHVybnMge2ludH0gSW5kZXggb2Ygc2VhcmNoIGVsZW1lbnQuXG4gICAqL1xuICB2YXIgaW5kZXhPZiA9IGZ1bmN0aW9uKGFycmF5LCBzZWFyY2hFbGVtZW50KSB7XG4gICAgZm9yICh2YXIgaSA9IDAsIGxlbiA9IGFycmF5Lmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBpZiAoYXJyYXlbaV0gPT09IHNlYXJjaEVsZW1lbnQpIHtcbiAgICAgICAgcmV0dXJuIGk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiAtMTtcbiAgfTtcblxuICAvKipcbiAgICogQG5hbWUgdHJpbVxuICAgKiBAcHJpdmF0ZVxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogdHJpbSBwb2x5ZmlsbFxuICAgKlxuICAgKiBAcmV0dXJucyB7c3RyaW5nfSBUaGUgc3RyaW5nIHN0cmlwcGVkIG9mIHdoaXRlc3BhY2UgZnJvbSBib3RoIGVuZHNcbiAgICovXG4gIHZhciB0cmltID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMucmVwbGFjZSgvXlxccyt8XFxzKyQvZywgJycpO1xuICB9O1xuXG4gIHZhciBuZWdvdGlhdGVMb2NhbGUgPSBmdW5jdGlvbiAocHJlZmVycmVkKSB7XG5cbiAgICB2YXIgYXZhaWwgPSBbXSxcbiAgICAgICAgbG9jYWxlID0gYW5ndWxhci5sb3dlcmNhc2UocHJlZmVycmVkKSxcbiAgICAgICAgaSA9IDAsXG4gICAgICAgIG4gPSAkYXZhaWxhYmxlTGFuZ3VhZ2VLZXlzLmxlbmd0aDtcblxuICAgIGZvciAoOyBpIDwgbjsgaSsrKSB7XG4gICAgICBhdmFpbC5wdXNoKGFuZ3VsYXIubG93ZXJjYXNlKCRhdmFpbGFibGVMYW5ndWFnZUtleXNbaV0pKTtcbiAgICB9XG5cbiAgICBpZiAoaW5kZXhPZihhdmFpbCwgbG9jYWxlKSA+IC0xKSB7XG4gICAgICByZXR1cm4gcHJlZmVycmVkO1xuICAgIH1cblxuICAgIGlmICgkbGFuZ3VhZ2VLZXlBbGlhc2VzKSB7XG4gICAgICB2YXIgYWxpYXM7XG4gICAgICBmb3IgKHZhciBsYW5nS2V5QWxpYXMgaW4gJGxhbmd1YWdlS2V5QWxpYXNlcykge1xuICAgICAgICB2YXIgaGFzV2lsZGNhcmRLZXkgPSBmYWxzZTtcbiAgICAgICAgdmFyIGhhc0V4YWN0S2V5ID0gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKCRsYW5ndWFnZUtleUFsaWFzZXMsIGxhbmdLZXlBbGlhcykgJiZcbiAgICAgICAgICBhbmd1bGFyLmxvd2VyY2FzZShsYW5nS2V5QWxpYXMpID09PSBhbmd1bGFyLmxvd2VyY2FzZShwcmVmZXJyZWQpO1xuXG4gICAgICAgIGlmIChsYW5nS2V5QWxpYXMuc2xpY2UoLTEpID09PSAnKicpIHtcbiAgICAgICAgICBoYXNXaWxkY2FyZEtleSA9IGxhbmdLZXlBbGlhcy5zbGljZSgwLCAtMSkgPT09IHByZWZlcnJlZC5zbGljZSgwLCBsYW5nS2V5QWxpYXMubGVuZ3RoLTEpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNFeGFjdEtleSB8fCBoYXNXaWxkY2FyZEtleSkge1xuICAgICAgICAgIGFsaWFzID0gJGxhbmd1YWdlS2V5QWxpYXNlc1tsYW5nS2V5QWxpYXNdO1xuICAgICAgICAgIGlmIChpbmRleE9mKGF2YWlsLCBhbmd1bGFyLmxvd2VyY2FzZShhbGlhcykpID4gLTEpIHtcbiAgICAgICAgICAgIHJldHVybiBhbGlhcztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB2YXIgcGFydHMgPSBwcmVmZXJyZWQuc3BsaXQoJ18nKTtcblxuICAgIGlmIChwYXJ0cy5sZW5ndGggPiAxICYmIGluZGV4T2YoYXZhaWwsIGFuZ3VsYXIubG93ZXJjYXNlKHBhcnRzWzBdKSkgPiAtMSkge1xuICAgICAgcmV0dXJuIHBhcnRzWzBdO1xuICAgIH1cblxuICAgIC8vIElmIGV2ZXJ5dGhpbmcgZmFpbHMsIGp1c3QgcmV0dXJuIHRoZSBwcmVmZXJyZWQsIHVuY2hhbmdlZC5cbiAgICByZXR1cm4gcHJlZmVycmVkO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdHJhbnNsYXRpb25zXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUmVnaXN0ZXJzIGEgbmV3IHRyYW5zbGF0aW9uIHRhYmxlIGZvciBzcGVjaWZpYyBsYW5ndWFnZSBrZXkuXG4gICAqXG4gICAqIFRvIHJlZ2lzdGVyIGEgdHJhbnNsYXRpb24gdGFibGUgZm9yIHNwZWNpZmljIGxhbmd1YWdlLCBwYXNzIGEgZGVmaW5lZCBsYW5ndWFnZVxuICAgKiBrZXkgYXMgZmlyc3QgcGFyYW1ldGVyLlxuICAgKlxuICAgKiA8cHJlPlxuICAgKiAgLy8gcmVnaXN0ZXIgdHJhbnNsYXRpb24gdGFibGUgZm9yIGxhbmd1YWdlOiAnZGVfREUnXG4gICAqICAkdHJhbnNsYXRlUHJvdmlkZXIudHJhbnNsYXRpb25zKCdkZV9ERScsIHtcbiAgICogICAgJ0dSRUVUSU5HJzogJ0hhbGxvIFdlbHQhJ1xuICAgKiAgfSk7XG4gICAqXG4gICAqICAvLyByZWdpc3RlciBhbm90aGVyIG9uZVxuICAgKiAgJHRyYW5zbGF0ZVByb3ZpZGVyLnRyYW5zbGF0aW9ucygnZW5fVVMnLCB7XG4gICAqICAgICdHUkVFVElORyc6ICdIZWxsbyB3b3JsZCEnXG4gICAqICB9KTtcbiAgICogPC9wcmU+XG4gICAqXG4gICAqIFdoZW4gcmVnaXN0ZXJpbmcgbXVsdGlwbGUgdHJhbnNsYXRpb24gdGFibGVzIGZvciBmb3IgdGhlIHNhbWUgbGFuZ3VhZ2Uga2V5LFxuICAgKiB0aGUgYWN0dWFsIHRyYW5zbGF0aW9uIHRhYmxlIGdldHMgZXh0ZW5kZWQuIFRoaXMgYWxsb3dzIHlvdSB0byBkZWZpbmUgbW9kdWxlXG4gICAqIHNwZWNpZmljIHRyYW5zbGF0aW9uIHdoaWNoIG9ubHkgZ2V0IGFkZGVkLCBvbmNlIGEgc3BlY2lmaWMgbW9kdWxlIGlzIGxvYWRlZCBpblxuICAgKiB5b3VyIGFwcC5cbiAgICpcbiAgICogSW52b2tpbmcgdGhpcyBtZXRob2Qgd2l0aCBubyBhcmd1bWVudHMgcmV0dXJucyB0aGUgdHJhbnNsYXRpb24gdGFibGUgd2hpY2ggd2FzXG4gICAqIHJlZ2lzdGVyZWQgd2l0aCBubyBsYW5ndWFnZSBrZXkuIEludm9raW5nIGl0IHdpdGggYSBsYW5ndWFnZSBrZXkgcmV0dXJucyB0aGVcbiAgICogcmVsYXRlZCB0cmFuc2xhdGlvbiB0YWJsZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBBIGxhbmd1YWdlIGtleS5cbiAgICogQHBhcmFtIHtvYmplY3R9IHRyYW5zbGF0aW9uVGFibGUgQSBwbGFpbiBvbGQgSmF2YVNjcmlwdCBvYmplY3QgdGhhdCByZXByZXNlbnRzIGEgdHJhbnNsYXRpb24gdGFibGUuXG4gICAqXG4gICAqL1xuICB2YXIgdHJhbnNsYXRpb25zID0gZnVuY3Rpb24gKGxhbmdLZXksIHRyYW5zbGF0aW9uVGFibGUpIHtcblxuICAgIGlmICghbGFuZ0tleSAmJiAhdHJhbnNsYXRpb25UYWJsZSkge1xuICAgICAgcmV0dXJuICR0cmFuc2xhdGlvblRhYmxlO1xuICAgIH1cblxuICAgIGlmIChsYW5nS2V5ICYmICF0cmFuc2xhdGlvblRhYmxlKSB7XG4gICAgICBpZiAoYW5ndWxhci5pc1N0cmluZyhsYW5nS2V5KSkge1xuICAgICAgICByZXR1cm4gJHRyYW5zbGF0aW9uVGFibGVbbGFuZ0tleV07XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICghYW5ndWxhci5pc09iamVjdCgkdHJhbnNsYXRpb25UYWJsZVtsYW5nS2V5XSkpIHtcbiAgICAgICAgJHRyYW5zbGF0aW9uVGFibGVbbGFuZ0tleV0gPSB7fTtcbiAgICAgIH1cbiAgICAgIGFuZ3VsYXIuZXh0ZW5kKCR0cmFuc2xhdGlvblRhYmxlW2xhbmdLZXldLCBmbGF0T2JqZWN0KHRyYW5zbGF0aW9uVGFibGUpKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgdGhpcy50cmFuc2xhdGlvbnMgPSB0cmFuc2xhdGlvbnM7XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciNjbG9ha0NsYXNzTmFtZVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIExldCdzIHlvdSBjaGFuZ2UgdGhlIGNsYXNzIG5hbWUgZm9yIGB0cmFuc2xhdGUtY2xvYWtgIGRpcmVjdGl2ZS5cbiAgICogRGVmYXVsdCBjbGFzcyBuYW1lIGlzIGB0cmFuc2xhdGUtY2xvYWtgLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSB0cmFuc2xhdGUtY2xvYWsgY2xhc3MgbmFtZVxuICAgKi9cbiAgdGhpcy5jbG9ha0NsYXNzTmFtZSA9IGZ1bmN0aW9uIChuYW1lKSB7XG4gICAgaWYgKCFuYW1lKSB7XG4gICAgICByZXR1cm4gJGNsb2FrQ2xhc3NOYW1lO1xuICAgIH1cbiAgICAkY2xvYWtDbGFzc05hbWUgPSBuYW1lO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmFtZSBmbGF0T2JqZWN0XG4gICAqIEBwcml2YXRlXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBGbGF0cyBhbiBvYmplY3QuIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byBmbGF0dGVuIGdpdmVuIHRyYW5zbGF0aW9uIGRhdGEgd2l0aFxuICAgKiBuYW1lc3BhY2VzLCBzbyB0aGV5IGFyZSBsYXRlciBhY2Nlc3NpYmxlIHZpYSBkb3Qgbm90YXRpb24uXG4gICAqL1xuICB2YXIgZmxhdE9iamVjdCA9IGZ1bmN0aW9uIChkYXRhLCBwYXRoLCByZXN1bHQsIHByZXZLZXkpIHtcbiAgICB2YXIga2V5LCBrZXlXaXRoUGF0aCwga2V5V2l0aFNob3J0UGF0aCwgdmFsO1xuXG4gICAgaWYgKCFwYXRoKSB7XG4gICAgICBwYXRoID0gW107XG4gICAgfVxuICAgIGlmICghcmVzdWx0KSB7XG4gICAgICByZXN1bHQgPSB7fTtcbiAgICB9XG4gICAgZm9yIChrZXkgaW4gZGF0YSkge1xuICAgICAgaWYgKCFPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZGF0YSwga2V5KSkge1xuICAgICAgICBjb250aW51ZTtcbiAgICAgIH1cbiAgICAgIHZhbCA9IGRhdGFba2V5XTtcbiAgICAgIGlmIChhbmd1bGFyLmlzT2JqZWN0KHZhbCkpIHtcbiAgICAgICAgZmxhdE9iamVjdCh2YWwsIHBhdGguY29uY2F0KGtleSksIHJlc3VsdCwga2V5KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGtleVdpdGhQYXRoID0gcGF0aC5sZW5ndGggPyAoJycgKyBwYXRoLmpvaW4oTkVTVEVEX09CSkVDVF9ERUxJTUlURVIpICsgTkVTVEVEX09CSkVDVF9ERUxJTUlURVIgKyBrZXkpIDoga2V5O1xuICAgICAgICBpZihwYXRoLmxlbmd0aCAmJiBrZXkgPT09IHByZXZLZXkpe1xuICAgICAgICAgIC8vIENyZWF0ZSBzaG9ydGN1dCBwYXRoIChmb28uYmFyID09IGZvby5iYXIuYmFyKVxuICAgICAgICAgIGtleVdpdGhTaG9ydFBhdGggPSAnJyArIHBhdGguam9pbihORVNURURfT0JKRUNUX0RFTElNSVRFUik7XG4gICAgICAgICAgLy8gTGluayBpdCB0byBvcmlnaW5hbCBwYXRoXG4gICAgICAgICAgcmVzdWx0W2tleVdpdGhTaG9ydFBhdGhdID0gJ0A6JyArIGtleVdpdGhQYXRoO1xuICAgICAgICB9XG4gICAgICAgIHJlc3VsdFtrZXlXaXRoUGF0aF0gPSB2YWw7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXN1bHQ7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciNhZGRJbnRlcnBvbGF0aW9uXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogQWRkcyBpbnRlcnBvbGF0aW9uIHNlcnZpY2VzIHRvIGFuZ3VsYXItdHJhbnNsYXRlLCBzbyBpdCBjYW4gbWFuYWdlIHRoZW0uXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBmYWN0b3J5IEludGVycG9sYXRpb24gc2VydmljZSBmYWN0b3J5XG4gICAqL1xuICB0aGlzLmFkZEludGVycG9sYXRpb24gPSBmdW5jdGlvbiAoZmFjdG9yeSkge1xuICAgICRpbnRlcnBvbGF0b3JGYWN0b3JpZXMucHVzaChmYWN0b3J5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyI3VzZU1lc3NhZ2VGb3JtYXRJbnRlcnBvbGF0aW9uXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVGVsbHMgYW5ndWxhci10cmFuc2xhdGUgdG8gdXNlIGludGVycG9sYXRpb24gZnVuY3Rpb25hbGl0eSBvZiBtZXNzYWdlZm9ybWF0LmpzLlxuICAgKiBUaGlzIGlzIHVzZWZ1bCB3aGVuIGhhdmluZyBoaWdoIGxldmVsIHBsdXJhbGl6YXRpb24gYW5kIGdlbmRlciBzZWxlY3Rpb24uXG4gICAqL1xuICB0aGlzLnVzZU1lc3NhZ2VGb3JtYXRJbnRlcnBvbGF0aW9uID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnVzZUludGVycG9sYXRpb24oJyR0cmFuc2xhdGVNZXNzYWdlRm9ybWF0SW50ZXJwb2xhdGlvbicpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlSW50ZXJwb2xhdGlvblxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFRlbGxzIGFuZ3VsYXItdHJhbnNsYXRlIHdoaWNoIGludGVycG9sYXRpb24gc3R5bGUgdG8gdXNlIGFzIGRlZmF1bHQsIGFwcGxpY2F0aW9uLXdpZGUuXG4gICAqIFNpbXBseSBwYXNzIGEgZmFjdG9yeS9zZXJ2aWNlIG5hbWUuIFRoZSBpbnRlcnBvbGF0aW9uIHNlcnZpY2UgaGFzIHRvIGltcGxlbWVudFxuICAgKiB0aGUgY29ycmVjdCBpbnRlcmZhY2UuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmYWN0b3J5IEludGVycG9sYXRpb24gc2VydmljZSBuYW1lLlxuICAgKi9cbiAgdGhpcy51c2VJbnRlcnBvbGF0aW9uID0gZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgICAkaW50ZXJwb2xhdGlvbkZhY3RvcnkgPSBmYWN0b3J5O1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlU2FuaXRpemVTdHJhdGVneVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFNpbXBseSBzZXRzIGEgc2FuaXRhdGlvbiBzdHJhdGVneSB0eXBlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWUgU3RyYXRlZ3kgdHlwZS5cbiAgICovXG4gIHRoaXMudXNlU2FuaXRpemVWYWx1ZVN0cmF0ZWd5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgJGludGVycG9sYXRpb25TYW5pdGl6YXRpb25TdHJhdGVneSA9IHZhbHVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciNwcmVmZXJyZWRMYW5ndWFnZVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFRlbGxzIHRoZSBtb2R1bGUgd2hpY2ggb2YgdGhlIHJlZ2lzdGVyZWQgdHJhbnNsYXRpb24gdGFibGVzIHRvIHVzZSBmb3IgdHJhbnNsYXRpb25cbiAgICogYXQgaW5pdGlhbCBzdGFydHVwIGJ5IHBhc3NpbmcgYSBsYW5ndWFnZSBrZXkuIFNpbWlsYXIgdG8gYCR0cmFuc2xhdGVQcm92aWRlciN1c2VgXG4gICAqIG9ubHkgdGhhdCBpdCBzYXlzIHdoaWNoIGxhbmd1YWdlIHRvICoqcHJlZmVyKiouXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nS2V5IEEgbGFuZ3VhZ2Uga2V5LlxuICAgKlxuICAgKi9cbiAgdGhpcy5wcmVmZXJyZWRMYW5ndWFnZSA9IGZ1bmN0aW9uKGxhbmdLZXkpIHtcbiAgICBzZXR1cFByZWZlcnJlZExhbmd1YWdlKGxhbmdLZXkpO1xuICAgIHJldHVybiB0aGlzO1xuXG4gIH07XG4gIHZhciBzZXR1cFByZWZlcnJlZExhbmd1YWdlID0gZnVuY3Rpb24gKGxhbmdLZXkpIHtcbiAgICBpZiAobGFuZ0tleSkge1xuICAgICAgJHByZWZlcnJlZExhbmd1YWdlID0gbGFuZ0tleTtcbiAgICB9XG4gICAgcmV0dXJuICRwcmVmZXJyZWRMYW5ndWFnZTtcbiAgfTtcbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciN0cmFuc2xhdGlvbk5vdEZvdW5kSW5kaWNhdG9yXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2V0cyBhbiBpbmRpY2F0b3Igd2hpY2ggaXMgdXNlZCB3aGVuIGEgdHJhbnNsYXRpb24gaXNuJ3QgZm91bmQuIEUuZy4gd2hlblxuICAgKiBzZXR0aW5nIHRoZSBpbmRpY2F0b3IgYXMgJ1gnIGFuZCBvbmUgdHJpZXMgdG8gdHJhbnNsYXRlIGEgdHJhbnNsYXRpb24gaWRcbiAgICogY2FsbGVkIGBOT1RfRk9VTkRgLCB0aGlzIHdpbGwgcmVzdWx0IGluIGBYIE5PVF9GT1VORCBYYC5cbiAgICpcbiAgICogSW50ZXJuYWxseSB0aGlzIG1ldGhvZHMgc2V0cyBhIGxlZnQgaW5kaWNhdG9yIGFuZCBhIHJpZ2h0IGluZGljYXRvciB1c2luZ1xuICAgKiBgJHRyYW5zbGF0ZVByb3ZpZGVyLnRyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3JMZWZ0KClgIGFuZFxuICAgKiBgJHRyYW5zbGF0ZVByb3ZpZGVyLnRyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3JSaWdodCgpYC5cbiAgICpcbiAgICogKipOb3RlKio6IFRoZXNlIG1ldGhvZHMgYXV0b21hdGljYWxseSBhZGQgYSB3aGl0ZXNwYWNlIGJldHdlZW4gdGhlIGluZGljYXRvcnNcbiAgICogYW5kIHRoZSB0cmFuc2xhdGlvbiBpZC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGluZGljYXRvciBBbiBpbmRpY2F0b3IsIGNvdWxkIGJlIGFueSBzdHJpbmcuXG4gICAqL1xuICB0aGlzLnRyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3IgPSBmdW5jdGlvbiAoaW5kaWNhdG9yKSB7XG4gICAgdGhpcy50cmFuc2xhdGlvbk5vdEZvdW5kSW5kaWNhdG9yTGVmdChpbmRpY2F0b3IpO1xuICAgIHRoaXMudHJhbnNsYXRpb25Ob3RGb3VuZEluZGljYXRvclJpZ2h0KGluZGljYXRvcik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyI3RyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3JMZWZ0XG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2V0cyBhbiBpbmRpY2F0b3Igd2hpY2ggaXMgdXNlZCB3aGVuIGEgdHJhbnNsYXRpb24gaXNuJ3QgZm91bmQgbGVmdCB0byB0aGVcbiAgICogdHJhbnNsYXRpb24gaWQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBpbmRpY2F0b3IgQW4gaW5kaWNhdG9yLlxuICAgKi9cbiAgdGhpcy50cmFuc2xhdGlvbk5vdEZvdW5kSW5kaWNhdG9yTGVmdCA9IGZ1bmN0aW9uIChpbmRpY2F0b3IpIHtcbiAgICBpZiAoIWluZGljYXRvcikge1xuICAgICAgcmV0dXJuICRub3RGb3VuZEluZGljYXRvckxlZnQ7XG4gICAgfVxuICAgICRub3RGb3VuZEluZGljYXRvckxlZnQgPSBpbmRpY2F0b3I7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyI3RyYW5zbGF0aW9uTm90Rm91bmRJbmRpY2F0b3JMZWZ0XG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2V0cyBhbiBpbmRpY2F0b3Igd2hpY2ggaXMgdXNlZCB3aGVuIGEgdHJhbnNsYXRpb24gaXNuJ3QgZm91bmQgcmlnaHQgdG8gdGhlXG4gICAqIHRyYW5zbGF0aW9uIGlkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gaW5kaWNhdG9yIEFuIGluZGljYXRvci5cbiAgICovXG4gIHRoaXMudHJhbnNsYXRpb25Ob3RGb3VuZEluZGljYXRvclJpZ2h0ID0gZnVuY3Rpb24gKGluZGljYXRvcikge1xuICAgIGlmICghaW5kaWNhdG9yKSB7XG4gICAgICByZXR1cm4gJG5vdEZvdW5kSW5kaWNhdG9yUmlnaHQ7XG4gICAgfVxuICAgICRub3RGb3VuZEluZGljYXRvclJpZ2h0ID0gaW5kaWNhdG9yO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjZmFsbGJhY2tMYW5ndWFnZVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFRlbGxzIHRoZSBtb2R1bGUgd2hpY2ggb2YgdGhlIHJlZ2lzdGVyZWQgdHJhbnNsYXRpb24gdGFibGVzIHRvIHVzZSB3aGVuIG1pc3NpbmcgdHJhbnNsYXRpb25zXG4gICAqIGF0IGluaXRpYWwgc3RhcnR1cCBieSBwYXNzaW5nIGEgbGFuZ3VhZ2Uga2V5LiBTaW1pbGFyIHRvIGAkdHJhbnNsYXRlUHJvdmlkZXIjdXNlYFxuICAgKiBvbmx5IHRoYXQgaXQgc2F5cyB3aGljaCBsYW5ndWFnZSB0byAqKmZhbGxiYWNrKiouXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfHxhcnJheX0gbGFuZ0tleSBBIGxhbmd1YWdlIGtleS5cbiAgICpcbiAgICovXG4gIHRoaXMuZmFsbGJhY2tMYW5ndWFnZSA9IGZ1bmN0aW9uIChsYW5nS2V5KSB7XG4gICAgZmFsbGJhY2tTdGFjayhsYW5nS2V5KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICB2YXIgZmFsbGJhY2tTdGFjayA9IGZ1bmN0aW9uIChsYW5nS2V5KSB7XG4gICAgaWYgKGxhbmdLZXkpIHtcbiAgICAgIGlmIChhbmd1bGFyLmlzU3RyaW5nKGxhbmdLZXkpKSB7XG4gICAgICAgICRmYWxsYmFja1dhc1N0cmluZyA9IHRydWU7XG4gICAgICAgICRmYWxsYmFja0xhbmd1YWdlID0gWyBsYW5nS2V5IF07XG4gICAgICB9IGVsc2UgaWYgKGFuZ3VsYXIuaXNBcnJheShsYW5nS2V5KSkge1xuICAgICAgICAkZmFsbGJhY2tXYXNTdHJpbmcgPSBmYWxzZTtcbiAgICAgICAgJGZhbGxiYWNrTGFuZ3VhZ2UgPSBsYW5nS2V5O1xuICAgICAgfVxuICAgICAgaWYgKGFuZ3VsYXIuaXNTdHJpbmcoJHByZWZlcnJlZExhbmd1YWdlKSAgJiYgaW5kZXhPZigkZmFsbGJhY2tMYW5ndWFnZSwgJHByZWZlcnJlZExhbmd1YWdlKSA8IDApIHtcbiAgICAgICAgJGZhbGxiYWNrTGFuZ3VhZ2UucHVzaCgkcHJlZmVycmVkTGFuZ3VhZ2UpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCRmYWxsYmFja1dhc1N0cmluZykge1xuICAgICAgICByZXR1cm4gJGZhbGxiYWNrTGFuZ3VhZ2VbMF07XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gJGZhbGxiYWNrTGFuZ3VhZ2U7XG4gICAgICB9XG4gICAgfVxuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2V0IHdoaWNoIHRyYW5zbGF0aW9uIHRhYmxlIHRvIHVzZSBmb3IgdHJhbnNsYXRpb24gYnkgZ2l2ZW4gbGFuZ3VhZ2Uga2V5LiBXaGVuXG4gICAqIHRyeWluZyB0byAndXNlJyBhIGxhbmd1YWdlIHdoaWNoIGlzbid0IHByb3ZpZGVkLCBpdCdsbCB0aHJvdyBhbiBlcnJvci5cbiAgICpcbiAgICogWW91IGFjdHVhbGx5IGRvbid0IGhhdmUgdG8gdXNlIHRoaXMgbWV0aG9kIHNpbmNlIGAkdHJhbnNsYXRlUHJvdmlkZXIjcHJlZmVycmVkTGFuZ3VhZ2VgXG4gICAqIGRvZXMgdGhlIGpvYiB0b28uXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBsYW5nS2V5IEEgbGFuZ3VhZ2Uga2V5LlxuICAgKi9cbiAgdGhpcy51c2UgPSBmdW5jdGlvbiAobGFuZ0tleSkge1xuICAgIGlmIChsYW5nS2V5KSB7XG4gICAgICBpZiAoISR0cmFuc2xhdGlvblRhYmxlW2xhbmdLZXldICYmICghJGxvYWRlckZhY3RvcnkpKSB7XG4gICAgICAgIC8vIG9ubHkgdGhyb3cgYW4gZXJyb3IsIHdoZW4gbm90IGxvYWRpbmcgdHJhbnNsYXRpb24gZGF0YSBhc3luY2hyb25vdXNseVxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCIkdHJhbnNsYXRlUHJvdmlkZXIgY291bGRuJ3QgZmluZCB0cmFuc2xhdGlvblRhYmxlIGZvciBsYW5nS2V5OiAnXCIgKyBsYW5nS2V5ICsgXCInXCIpO1xuICAgICAgfVxuICAgICAgJHVzZXMgPSBsYW5nS2V5O1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfVxuICAgIHJldHVybiAkdXNlcztcbiAgfTtcblxuIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjc3RvcmFnZUtleVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFRlbGxzIHRoZSBtb2R1bGUgd2hpY2gga2V5IG11c3QgcmVwcmVzZW50IHRoZSBjaG9vc2VkIGxhbmd1YWdlIGJ5IGEgdXNlciBpbiB0aGUgc3RvcmFnZS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGtleSBBIGtleSBmb3IgdGhlIHN0b3JhZ2UuXG4gICAqL1xuICB2YXIgc3RvcmFnZUtleSA9IGZ1bmN0aW9uKGtleSkge1xuICAgIGlmICgha2V5KSB7XG4gICAgICBpZiAoJHN0b3JhZ2VQcmVmaXgpIHtcbiAgICAgICAgcmV0dXJuICRzdG9yYWdlUHJlZml4ICsgJHN0b3JhZ2VLZXk7XG4gICAgICB9XG4gICAgICByZXR1cm4gJHN0b3JhZ2VLZXk7XG4gICAgfVxuICAgICRzdG9yYWdlS2V5ID0ga2V5O1xuICB9O1xuXG4gIHRoaXMuc3RvcmFnZUtleSA9IHN0b3JhZ2VLZXk7XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciN1c2VVcmxMb2FkZXJcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUZWxscyBhbmd1bGFyLXRyYW5zbGF0ZSB0byB1c2UgYCR0cmFuc2xhdGVVcmxMb2FkZXJgIGV4dGVuc2lvbiBzZXJ2aWNlIGFzIGxvYWRlci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IHVybCBVcmxcbiAgICogQHBhcmFtIHtPYmplY3Q9fSBvcHRpb25zIE9wdGlvbmFsIGNvbmZpZ3VyYXRpb24gb2JqZWN0XG4gICAqL1xuICB0aGlzLnVzZVVybExvYWRlciA9IGZ1bmN0aW9uICh1cmwsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy51c2VMb2FkZXIoJyR0cmFuc2xhdGVVcmxMb2FkZXInLCBhbmd1bGFyLmV4dGVuZCh7IHVybDogdXJsIH0sIG9wdGlvbnMpKTtcbiAgfTtcblxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyI3VzZVN0YXRpY0ZpbGVzTG9hZGVyXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVGVsbHMgYW5ndWxhci10cmFuc2xhdGUgdG8gdXNlIGAkdHJhbnNsYXRlU3RhdGljRmlsZXNMb2FkZXJgIGV4dGVuc2lvbiBzZXJ2aWNlIGFzIGxvYWRlci5cbiAgICpcbiAgICogQHBhcmFtIHtPYmplY3Q9fSBvcHRpb25zIE9wdGlvbmFsIGNvbmZpZ3VyYXRpb24gb2JqZWN0XG4gICAqL1xuICB0aGlzLnVzZVN0YXRpY0ZpbGVzTG9hZGVyID0gZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICByZXR1cm4gdGhpcy51c2VMb2FkZXIoJyR0cmFuc2xhdGVTdGF0aWNGaWxlc0xvYWRlcicsIG9wdGlvbnMpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlTG9hZGVyXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVGVsbHMgYW5ndWxhci10cmFuc2xhdGUgdG8gdXNlIGFueSBvdGhlciBzZXJ2aWNlIGFzIGxvYWRlci5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxvYWRlckZhY3RvcnkgRmFjdG9yeSBuYW1lIHRvIHVzZVxuICAgKiBAcGFyYW0ge09iamVjdD19IG9wdGlvbnMgT3B0aW9uYWwgY29uZmlndXJhdGlvbiBvYmplY3RcbiAgICovXG4gIHRoaXMudXNlTG9hZGVyID0gZnVuY3Rpb24gKGxvYWRlckZhY3RvcnksIG9wdGlvbnMpIHtcbiAgICAkbG9hZGVyRmFjdG9yeSA9IGxvYWRlckZhY3Rvcnk7XG4gICAgJGxvYWRlck9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlTG9jYWxTdG9yYWdlXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVGVsbHMgYW5ndWxhci10cmFuc2xhdGUgdG8gdXNlIGAkdHJhbnNsYXRlTG9jYWxTdG9yYWdlYCBzZXJ2aWNlIGFzIHN0b3JhZ2UgbGF5ZXIuXG4gICAqXG4gICAqL1xuICB0aGlzLnVzZUxvY2FsU3RvcmFnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy51c2VTdG9yYWdlKCckdHJhbnNsYXRlTG9jYWxTdG9yYWdlJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciN1c2VDb29raWVTdG9yYWdlXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVGVsbHMgYW5ndWxhci10cmFuc2xhdGUgdG8gdXNlIGAkdHJhbnNsYXRlQ29va2llU3RvcmFnZWAgc2VydmljZSBhcyBzdG9yYWdlIGxheWVyLlxuICAgKi9cbiAgdGhpcy51c2VDb29raWVTdG9yYWdlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLnVzZVN0b3JhZ2UoJyR0cmFuc2xhdGVDb29raWVTdG9yYWdlJyk7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciN1c2VTdG9yYWdlXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogVGVsbHMgYW5ndWxhci10cmFuc2xhdGUgdG8gdXNlIGN1c3RvbSBzZXJ2aWNlIGFzIHN0b3JhZ2UgbGF5ZXIuXG4gICAqL1xuICB0aGlzLnVzZVN0b3JhZ2UgPSBmdW5jdGlvbiAoc3RvcmFnZUZhY3RvcnkpIHtcbiAgICAkc3RvcmFnZUZhY3RvcnkgPSBzdG9yYWdlRmFjdG9yeTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyI3N0b3JhZ2VQcmVmaXhcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBTZXRzIHByZWZpeCBmb3Igc3RvcmFnZSBrZXkuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBwcmVmaXggU3RvcmFnZSBrZXkgcHJlZml4XG4gICAqL1xuICB0aGlzLnN0b3JhZ2VQcmVmaXggPSBmdW5jdGlvbiAocHJlZml4KSB7XG4gICAgaWYgKCFwcmVmaXgpIHtcbiAgICAgIHJldHVybiBwcmVmaXg7XG4gICAgfVxuICAgICRzdG9yYWdlUHJlZml4ID0gcHJlZml4O1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckxvZ1xuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFRlbGxzIGFuZ3VsYXItdHJhbnNsYXRlIHRvIHVzZSBidWlsdC1pbiBsb2cgaGFuZGxlciB3aGVuIHRyeWluZyB0byB0cmFuc2xhdGVcbiAgICogYSB0cmFuc2xhdGlvbiBJZCB3aGljaCBkb2Vzbid0IGV4aXN0LlxuICAgKlxuICAgKiBUaGlzIGlzIGFjdHVhbGx5IGEgc2hvcnRjdXQgbWV0aG9kIGZvciBgdXNlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlcigpYC5cbiAgICpcbiAgICovXG4gIHRoaXMudXNlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckxvZyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy51c2VNaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyKCckdHJhbnNsYXRlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckxvZycpO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlclxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIEV4cGVjdHMgYSBmYWN0b3J5IG5hbWUgd2hpY2ggbGF0ZXIgZ2V0cyBpbnN0YW50aWF0ZWQgd2l0aCBgJGluamVjdG9yYC5cbiAgICogVGhpcyBtZXRob2QgY2FuIGJlIHVzZWQgdG8gdGVsbCBhbmd1bGFyLXRyYW5zbGF0ZSB0byB1c2UgYSBjdXN0b21cbiAgICogbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlci4gSnVzdCBidWlsZCBhIGZhY3Rvcnkgd2hpY2ggcmV0dXJucyBhIGZ1bmN0aW9uXG4gICAqIGFuZCBleHBlY3RzIGEgdHJhbnNsYXRpb24gaWQgYXMgYXJndW1lbnQuXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqIDxwcmU+XG4gICAqICBhcHAuY29uZmlnKGZ1bmN0aW9uICgkdHJhbnNsYXRlUHJvdmlkZXIpIHtcbiAgICogICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXIoJ2N1c3RvbUhhbmRsZXInKTtcbiAgICogIH0pO1xuICAgKlxuICAgKiAgYXBwLmZhY3RvcnkoJ2N1c3RvbUhhbmRsZXInLCBmdW5jdGlvbiAoZGVwMSwgZGVwMikge1xuICAgKiAgICByZXR1cm4gZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQpIHtcbiAgICogICAgICAvLyBzb21ldGhpbmcgd2l0aCB0cmFuc2xhdGlvbklkIGFuZCBkZXAxIGFuZCBkZXAyXG4gICAqICAgIH07XG4gICAqICB9KTtcbiAgICogPC9wcmU+XG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmYWN0b3J5IEZhY3RvcnkgbmFtZVxuICAgKi9cbiAgdGhpcy51c2VNaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyID0gZnVuY3Rpb24gKGZhY3RvcnkpIHtcbiAgICAkbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckZhY3RvcnkgPSBmYWN0b3J5O1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjdXNlUG9zdENvbXBpbGluZ1xuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIElmIHBvc3QgY29tcGlsaW5nIGlzIGVuYWJsZWQsIGFsbCB0cmFuc2xhdGVkIHZhbHVlcyB3aWxsIGJlIHByb2Nlc3NlZFxuICAgKiBhZ2FpbiB3aXRoIEFuZ3VsYXJKUycgJGNvbXBpbGUuXG4gICAqXG4gICAqIEV4YW1wbGU6XG4gICAqIDxwcmU+XG4gICAqICBhcHAuY29uZmlnKGZ1bmN0aW9uICgkdHJhbnNsYXRlUHJvdmlkZXIpIHtcbiAgICogICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnVzZVBvc3RDb21waWxpbmcodHJ1ZSk7XG4gICAqICB9KTtcbiAgICogPC9wcmU+XG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBmYWN0b3J5IEZhY3RvcnkgbmFtZVxuICAgKi9cbiAgdGhpcy51c2VQb3N0Q29tcGlsaW5nID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgJHBvc3RDb21waWxpbmdFbmFibGVkID0gISghdmFsdWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2VcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUZWxscyBhbmd1bGFyLXRyYW5zbGF0ZSB0byB0cnkgdG8gZGV0ZXJtaW5lIG9uIGl0cyBvd24gd2hpY2ggbGFuZ3VhZ2Uga2V5XG4gICAqIHRvIHNldCBhcyBwcmVmZXJyZWQgbGFuZ3VhZ2UuIFdoZW4gYGZuYCBpcyBnaXZlbiwgYW5ndWxhci10cmFuc2xhdGUgdXNlcyBpdFxuICAgKiB0byBkZXRlcm1pbmUgYSBsYW5ndWFnZSBrZXksIG90aGVyd2lzZSBpdCB1c2VzIHRoZSBidWlsdC1pbiBgZ2V0TG9jYWxlKClgXG4gICAqIG1ldGhvZC5cbiAgICpcbiAgICogVGhlIGBnZXRMb2NhbGUoKWAgcmV0dXJucyBhIGxhbmd1YWdlIGtleSBpbiB0aGUgZm9ybWF0IGBbbGFuZ11fW2NvdW50cnldYCBvclxuICAgKiBgW2xhbmddYCBkZXBlbmRpbmcgb24gd2hhdCB0aGUgYnJvd3NlciBwcm92aWRlcy5cbiAgICpcbiAgICogVXNlIHRoaXMgbWV0aG9kIGF0IHlvdXIgb3duIHJpc2ssIHNpbmNlIG5vdCBhbGwgYnJvd3NlcnMgcmV0dXJuIGEgdmFsaWRcbiAgICogbG9jYWxlLlxuICAgKlxuICAgKiBAcGFyYW0ge29iamVjdD19IGZuIEZ1bmN0aW9uIHRvIGRldGVybWluZSBhIGJyb3dzZXIncyBsb2NhbGVcbiAgICovXG4gIHRoaXMuZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2UgPSBmdW5jdGlvbiAoZm4pIHtcblxuICAgIHZhciBsb2NhbGUgPSAoZm4gJiYgYW5ndWxhci5pc0Z1bmN0aW9uKGZuKSkgPyBmbigpIDogZ2V0TG9jYWxlKCk7XG5cbiAgICBpZiAoISRhdmFpbGFibGVMYW5ndWFnZUtleXMubGVuZ3RoKSB7XG4gICAgICAkcHJlZmVycmVkTGFuZ3VhZ2UgPSBsb2NhbGU7XG4gICAgfSBlbHNlIHtcbiAgICAgICRwcmVmZXJyZWRMYW5ndWFnZSA9IG5lZ290aWF0ZUxvY2FsZShsb2NhbGUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjcmVnaXN0ZXJBdmFpbGFibGVMYW5ndWFnZUtleXNcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZWdpc3RlcnMgYSBzZXQgb2YgbGFuZ3VhZ2Uga2V5cyB0aGUgYXBwIHdpbGwgd29yayB3aXRoLiBVc2UgdGhpcyBtZXRob2QgaW5cbiAgICogY29tYmluYXRpb24gd2l0aFxuICAgKiB7QGxpbmsgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2UgZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2V9LlxuICAgKiBXaGVuIGF2YWlsYWJsZSBsYW5ndWFnZXMga2V5cyBhcmUgcmVnaXN0ZXJlZCwgYW5ndWxhci10cmFuc2xhdGVcbiAgICogdHJpZXMgdG8gZmluZCB0aGUgYmVzdCBmaXR0aW5nIGxhbmd1YWdlIGtleSBkZXBlbmRpbmcgb24gdGhlIGJyb3dzZXJzIGxvY2FsZSxcbiAgICogY29uc2lkZXJpbmcgeW91ciBsYW5ndWFnZSBrZXkgY29udmVudGlvbi5cbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGxhbmd1YWdlS2V5cyBBcnJheSBvZiBsYW5ndWFnZSBrZXlzIHRoZSB5b3VyIGFwcCB3aWxsIHVzZVxuICAgKiBAcGFyYW0ge29iamVjdD19IGFsaWFzZXMgQWxpYXMgbWFwLlxuICAgKi9cbiAgdGhpcy5yZWdpc3RlckF2YWlsYWJsZUxhbmd1YWdlS2V5cyA9IGZ1bmN0aW9uIChsYW5ndWFnZUtleXMsIGFsaWFzZXMpIHtcbiAgICBpZiAobGFuZ3VhZ2VLZXlzKSB7XG4gICAgICAkYXZhaWxhYmxlTGFuZ3VhZ2VLZXlzID0gbGFuZ3VhZ2VLZXlzO1xuICAgICAgaWYgKGFsaWFzZXMpIHtcbiAgICAgICAgJGxhbmd1YWdlS2V5QWxpYXNlcyA9IGFsaWFzZXM7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gICAgcmV0dXJuICRhdmFpbGFibGVMYW5ndWFnZUtleXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciN1c2VMb2FkZXJDYWNoZVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFJlZ2lzdGVycyBhIGNhY2hlIGZvciBpbnRlcm5hbCAkaHR0cCBiYXNlZCBsb2FkZXJzLlxuICAgKiB7QGxpbmsgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2UgZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2V9LlxuICAgKiBXaGVuIGZhbHNlIHRoZSBjYWNoZSB3aWxsIGJlIGRpc2FibGVkIChkZWZhdWx0KS4gV2hlbiB0cnVlIG9yIHVuZGVmaW5lZFxuICAgKiB0aGUgY2FjaGUgd2lsbCBiZSBhIGRlZmF1bHQgKHNlZSAkY2FjaGVGYWN0b3J5KS4gV2hlbiBhbiBvYmplY3QgaXQgd2lsbFxuICAgKiBiZSB0cmVhdCBhcyBhIGNhY2hlIG9iamVjdCBpdHNlbGY6IHRoZSB1c2FnZSBpcyAkaHR0cCh7Y2FjaGU6IGNhY2hlfSlcbiAgICpcbiAgICogQHBhcmFtIHtvYmplY3R9IGNhY2hlIGJvb2xlYW4sIHN0cmluZyBvciBjYWNoZS1vYmplY3RcbiAgICovXG4gIHRoaXMudXNlTG9hZGVyQ2FjaGUgPSBmdW5jdGlvbiAoY2FjaGUpIHtcbiAgICBpZiAoY2FjaGUgPT09IGZhbHNlKSB7XG4gICAgICAvLyBkaXNhYmxlIGNhY2hlXG4gICAgICBsb2FkZXJDYWNoZSA9IHVuZGVmaW5lZDtcbiAgICB9IGVsc2UgaWYgKGNhY2hlID09PSB0cnVlKSB7XG4gICAgICAvLyBlbmFibGUgY2FjaGUgdXNpbmcgQUpTIGRlZmF1bHRzXG4gICAgICBsb2FkZXJDYWNoZSA9IHRydWU7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YoY2FjaGUpID09PSAndW5kZWZpbmVkJykge1xuICAgICAgLy8gZW5hYmxlIGNhY2hlIHVzaW5nIGRlZmF1bHRcbiAgICAgIGxvYWRlckNhY2hlID0gJyR0cmFuc2xhdGlvbkNhY2hlJztcbiAgICB9IGVsc2UgaWYgKGNhY2hlKSB7XG4gICAgICAvLyBlbmFibGUgY2FjaGUgdXNpbmcgZ2l2ZW4gb25lIChzZWUgJGNhY2hlRmFjdG9yeSlcbiAgICAgIGxvYWRlckNhY2hlID0gY2FjaGU7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXIjZGlyZWN0aXZlUHJpb3JpdHlcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBTZXRzIHRoZSBkZWZhdWx0IHByaW9yaXR5IG9mIHRoZSB0cmFuc2xhdGUgZGlyZWN0aXZlLiBUaGUgc3RhbmRhcmQgdmFsdWUgaXMgYDBgLlxuICAgKiBDYWxsaW5nIHRoaXMgZnVuY3Rpb24gd2l0aG91dCBhbiBhcmd1bWVudCB3aWxsIHJldHVybiB0aGUgY3VycmVudCB2YWx1ZS5cbiAgICpcbiAgICogQHBhcmFtIHtudW1iZXJ9IHByaW9yaXR5IGZvciB0aGUgdHJhbnNsYXRlLWRpcmVjdGl2ZVxuICAgKi9cbiAgdGhpcy5kaXJlY3RpdmVQcmlvcml0eSA9IGZ1bmN0aW9uIChwcmlvcml0eSkge1xuICAgIGlmIChwcmlvcml0eSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBnZXR0ZXJcbiAgICAgIHJldHVybiBkaXJlY3RpdmVQcmlvcml0eTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gc2V0dGVyIHdpdGggY2hhaW5pbmdcbiAgICAgIGRpcmVjdGl2ZVByaW9yaXR5ID0gcHJpb3JpdHk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQcm92aWRlciNzdGF0ZWZ1bEZpbHRlclxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUHJvdmlkZXJcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFNpbmNlIEFuZ3VsYXJKUyAxLjMsIGZpbHRlcnMgd2hpY2ggYXJlIG5vdCBzdGF0ZWxlc3MgKGRlcGVuZGluZyBhdCB0aGUgc2NvcGUpXG4gICAqIGhhdmUgdG8gZXhwbGljaXQgZGVmaW5lIHRoaXMgYmVoYXZpb3IuXG4gICAqIFNldHMgd2hldGhlciB0aGUgdHJhbnNsYXRlIGZpbHRlciBzaG91bGQgYmUgc3RhdGVmdWwgb3Igc3RhdGVsZXNzLiBUaGUgc3RhbmRhcmQgdmFsdWUgaXMgYHRydWVgXG4gICAqIG1lYW5pbmcgYmVpbmcgc3RhdGVmdWwuXG4gICAqIENhbGxpbmcgdGhpcyBmdW5jdGlvbiB3aXRob3V0IGFuIGFyZ3VtZW50IHdpbGwgcmV0dXJuIHRoZSBjdXJyZW50IHZhbHVlLlxuICAgKlxuICAgKiBAcGFyYW0ge2Jvb2xlYW59IHN0YXRlIC0gZGVmaW5lcyB0aGUgc3RhdGUgb2YgdGhlIGZpbHRlclxuICAgKi9cbiAgdGhpcy5zdGF0ZWZ1bEZpbHRlciA9IGZ1bmN0aW9uIChzdGF0ZSkge1xuICAgIGlmIChzdGF0ZSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAvLyBnZXR0ZXJcbiAgICAgIHJldHVybiBzdGF0ZWZ1bEZpbHRlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gc2V0dGVyIHdpdGggY2hhaW5pbmdcbiAgICAgIHN0YXRlZnVsRmlsdGVyID0gc3RhdGU7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBvYmplY3RcbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlXG4gICAqIEByZXF1aXJlcyAkaW50ZXJwb2xhdGVcbiAgICogQHJlcXVpcmVzICRsb2dcbiAgICogQHJlcXVpcmVzICRyb290U2NvcGVcbiAgICogQHJlcXVpcmVzICRxXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBUaGUgYCR0cmFuc2xhdGVgIHNlcnZpY2UgaXMgdGhlIGFjdHVhbCBjb3JlIG9mIGFuZ3VsYXItdHJhbnNsYXRlLiBJdCBleHBlY3RzIGEgdHJhbnNsYXRpb24gaWRcbiAgICogYW5kIG9wdGlvbmFsIGludGVycG9sYXRlIHBhcmFtZXRlcnMgdG8gdHJhbnNsYXRlIGNvbnRlbnRzLlxuICAgKlxuICAgKiA8cHJlPlxuICAgKiAgJHRyYW5zbGF0ZSgnSEVBRExJTkVfVEVYVCcpLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0aW9uKSB7XG4gICAqICAgICRzY29wZS50cmFuc2xhdGVkVGV4dCA9IHRyYW5zbGF0aW9uO1xuICAgKiAgfSk7XG4gICAqIDwvcHJlPlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ3xhcnJheX0gdHJhbnNsYXRpb25JZCBBIHRva2VuIHdoaWNoIHJlcHJlc2VudHMgYSB0cmFuc2xhdGlvbiBpZFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGNhbiBiZSBvcHRpb25hbGx5IGFuIGFycmF5IG9mIHRyYW5zbGF0aW9uIGlkcyB3aGljaFxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzIHRoYXQgdGhlIGZ1bmN0aW9uIHJldHVybnMgYW4gb2JqZWN0IHdoZXJlIGVhY2gga2V5XG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzIHRoZSB0cmFuc2xhdGlvbiBpZCBhbmQgdGhlIHZhbHVlIHRoZSB0cmFuc2xhdGlvbi5cbiAgICogQHBhcmFtIHtvYmplY3Q9fSBpbnRlcnBvbGF0ZVBhcmFtcyBBbiBvYmplY3QgaGFzaCBmb3IgZHluYW1pYyB2YWx1ZXNcbiAgICogQHBhcmFtIHtzdHJpbmd9IGludGVycG9sYXRpb25JZCBUaGUgaWQgb2YgdGhlIGludGVycG9sYXRpb24gdG8gdXNlXG4gICAqIEByZXR1cm5zIHtvYmplY3R9IHByb21pc2VcbiAgICovXG4gIHRoaXMuJGdldCA9IFtcbiAgICAnJGxvZycsXG4gICAgJyRpbmplY3RvcicsXG4gICAgJyRyb290U2NvcGUnLFxuICAgICckcScsXG4gICAgZnVuY3Rpb24gKCRsb2csICRpbmplY3RvciwgJHJvb3RTY29wZSwgJHEpIHtcblxuICAgICAgdmFyIFN0b3JhZ2UsXG4gICAgICAgICAgZGVmYXVsdEludGVycG9sYXRvciA9ICRpbmplY3Rvci5nZXQoJGludGVycG9sYXRpb25GYWN0b3J5IHx8ICckdHJhbnNsYXRlRGVmYXVsdEludGVycG9sYXRpb24nKSxcbiAgICAgICAgICBwZW5kaW5nTG9hZGVyID0gZmFsc2UsXG4gICAgICAgICAgaW50ZXJwb2xhdG9ySGFzaE1hcCA9IHt9LFxuICAgICAgICAgIGxhbmdQcm9taXNlcyA9IHt9LFxuICAgICAgICAgIGZhbGxiYWNrSW5kZXgsXG4gICAgICAgICAgc3RhcnRGYWxsYmFja0l0ZXJhdGlvbjtcblxuICAgICAgdmFyICR0cmFuc2xhdGUgPSBmdW5jdGlvbiAodHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIGludGVycG9sYXRpb25JZCwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCkge1xuXG4gICAgICAgIC8vIER1Y2sgZGV0ZWN0aW9uOiBJZiB0aGUgZmlyc3QgYXJndW1lbnQgaXMgYW4gYXJyYXksIGEgYnVuY2ggb2YgdHJhbnNsYXRpb25zIHdhcyByZXF1ZXN0ZWQuXG4gICAgICAgIC8vIFRoZSByZXN1bHQgaXMgYW4gb2JqZWN0LlxuICAgICAgICBpZiAoYW5ndWxhci5pc0FycmF5KHRyYW5zbGF0aW9uSWQpKSB7XG4gICAgICAgICAgLy8gSW5zcGlyZWQgYnkgUS5hbGxTZXR0bGVkIGJ5IEtyaXMgS293YWxcbiAgICAgICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20va3Jpc2tvd2FsL3EvYmxvYi9iMGZhNzI5ODA3MTdkYzIwMmZmYzNjYmYwM2I5MzZlMTBlYmJiOWQ3L3EuanMjTDE1NTMtMTU2M1xuICAgICAgICAgIC8vIFRoaXMgdHJhbnNmb3JtcyBhbGwgcHJvbWlzZXMgcmVnYXJkbGVzcyByZXNvbHZlZCBvciByZWplY3RlZFxuICAgICAgICAgIHZhciB0cmFuc2xhdGVBbGwgPSBmdW5jdGlvbiAodHJhbnNsYXRpb25JZHMpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHRzID0ge307IC8vIHN0b3JpbmcgdGhlIGFjdHVhbCByZXN1bHRzXG4gICAgICAgICAgICB2YXIgcHJvbWlzZXMgPSBbXTsgLy8gcHJvbWlzZXMgdG8gd2FpdCBmb3JcbiAgICAgICAgICAgIC8vIFdyYXBzIHRoZSBwcm9taXNlIGEpIGJlaW5nIGFsd2F5cyByZXNvbHZlZCBhbmQgYikgc3RvcmluZyB0aGUgbGluayBpZC0+dmFsdWVcbiAgICAgICAgICAgIHZhciB0cmFuc2xhdGUgPSBmdW5jdGlvbiAodHJhbnNsYXRpb25JZCkge1xuICAgICAgICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuICAgICAgICAgICAgICB2YXIgcmVnYXJkbGVzcyA9IGZ1bmN0aW9uICh2YWx1ZSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdHNbdHJhbnNsYXRpb25JZF0gPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKFt0cmFuc2xhdGlvbklkLCB2YWx1ZV0pO1xuICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAvLyB3ZSBkb24ndCBjYXJlIHdoZXRoZXIgdGhlIHByb21pc2Ugd2FzIHJlc29sdmVkIG9yIHJlamVjdGVkOyBqdXN0IHN0b3JlIHRoZSB2YWx1ZXNcbiAgICAgICAgICAgICAgJHRyYW5zbGF0ZSh0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcywgaW50ZXJwb2xhdGlvbklkLCBkZWZhdWx0VHJhbnNsYXRpb25UZXh0KS50aGVuKHJlZ2FyZGxlc3MsIHJlZ2FyZGxlc3MpO1xuICAgICAgICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgYyA9IHRyYW5zbGF0aW9uSWRzLmxlbmd0aDsgaSA8IGM7IGkrKykge1xuICAgICAgICAgICAgICBwcm9taXNlcy5wdXNoKHRyYW5zbGF0ZSh0cmFuc2xhdGlvbklkc1tpXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gd2FpdCBmb3IgYWxsIChpbmNsdWRpbmcgc3RvcmluZyB0byByZXN1bHRzKVxuICAgICAgICAgICAgcmV0dXJuICRxLmFsbChwcm9taXNlcykudGhlbihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgIC8vIHJldHVybiB0aGUgcmVzdWx0c1xuICAgICAgICAgICAgICByZXR1cm4gcmVzdWx0cztcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH07XG4gICAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZUFsbCh0cmFuc2xhdGlvbklkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgLy8gdHJpbSBvZmYgYW55IHdoaXRlc3BhY2VcbiAgICAgICAgaWYgKHRyYW5zbGF0aW9uSWQpIHtcbiAgICAgICAgICB0cmFuc2xhdGlvbklkID0gdHJpbS5hcHBseSh0cmFuc2xhdGlvbklkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBwcm9taXNlVG9XYWl0Rm9yID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICB2YXIgcHJvbWlzZSA9ICRwcmVmZXJyZWRMYW5ndWFnZSA/XG4gICAgICAgICAgICBsYW5nUHJvbWlzZXNbJHByZWZlcnJlZExhbmd1YWdlXSA6XG4gICAgICAgICAgICBsYW5nUHJvbWlzZXNbJHVzZXNdO1xuXG4gICAgICAgICAgZmFsbGJhY2tJbmRleCA9IDA7XG5cbiAgICAgICAgICBpZiAoJHN0b3JhZ2VGYWN0b3J5ICYmICFwcm9taXNlKSB7XG4gICAgICAgICAgICAvLyBsb29rcyBsaWtlIHRoZXJlJ3Mgbm8gcGVuZGluZyBwcm9taXNlIGZvciAkcHJlZmVycmVkTGFuZ3VhZ2Ugb3JcbiAgICAgICAgICAgIC8vICR1c2VzLiBNYXliZSB0aGVyZSdzIG9uZSBwZW5kaW5nIGZvciBhIGxhbmd1YWdlIHRoYXQgY29tZXMgZnJvbVxuICAgICAgICAgICAgLy8gc3RvcmFnZS5cbiAgICAgICAgICAgIHZhciBsYW5nS2V5ID0gU3RvcmFnZS5nZXQoJHN0b3JhZ2VLZXkpO1xuICAgICAgICAgICAgcHJvbWlzZSA9IGxhbmdQcm9taXNlc1tsYW5nS2V5XTtcblxuICAgICAgICAgICAgaWYgKCRmYWxsYmFja0xhbmd1YWdlICYmICRmYWxsYmFja0xhbmd1YWdlLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIHZhciBpbmRleCA9IGluZGV4T2YoJGZhbGxiYWNrTGFuZ3VhZ2UsIGxhbmdLZXkpO1xuICAgICAgICAgICAgICAgIC8vIG1heWJlIHRoZSBsYW5ndWFnZSBmcm9tIHN0b3JhZ2UgaXMgYWxzbyBkZWZpbmVkIGFzIGZhbGxiYWNrIGxhbmd1YWdlXG4gICAgICAgICAgICAgICAgLy8gd2UgaW5jcmVhc2UgdGhlIGZhbGxiYWNrIGxhbmd1YWdlIGluZGV4IHRvIG5vdCBzZWFyY2ggaW4gdGhhdCBsYW5ndWFnZVxuICAgICAgICAgICAgICAgIC8vIGFzIGZhbGxiYWNrLCBzaW5jZSBpdCdzIHByb2JhYmx5IHRoZSBmaXJzdCB1c2VkIGxhbmd1YWdlXG4gICAgICAgICAgICAgICAgLy8gaW4gdGhhdCBjYXNlIHRoZSBpbmRleCBzdGFydHMgYWZ0ZXIgdGhlIGZpcnN0IGVsZW1lbnRcbiAgICAgICAgICAgICAgICBmYWxsYmFja0luZGV4ID0gKGluZGV4ID09PSAwKSA/IDEgOiAwO1xuXG4gICAgICAgICAgICAgICAgLy8gYnV0IHdlIGNhbiBtYWtlIHN1cmUgdG8gQUxXQVlTIGZhbGxiYWNrIHRvIHByZWZlcnJlZCBsYW5ndWFnZSBhdCBsZWFzdFxuICAgICAgICAgICAgICAgIGlmIChpbmRleE9mKCRmYWxsYmFja0xhbmd1YWdlLCAkcHJlZmVycmVkTGFuZ3VhZ2UpIDwgMCkge1xuICAgICAgICAgICAgICAgICAgJGZhbGxiYWNrTGFuZ3VhZ2UucHVzaCgkcHJlZmVycmVkTGFuZ3VhZ2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHByb21pc2U7XG4gICAgICAgIH0oKSk7XG5cbiAgICAgICAgaWYgKCFwcm9taXNlVG9XYWl0Rm9yKSB7XG4gICAgICAgICAgLy8gbm8gcHJvbWlzZSB0byB3YWl0IGZvcj8gb2theS4gVGhlbiB0aGVyZSdzIG5vIGxvYWRlciByZWdpc3RlcmVkXG4gICAgICAgICAgLy8gbm9yIGlzIGEgb25lIHBlbmRpbmcgZm9yIGxhbmd1YWdlIHRoYXQgY29tZXMgZnJvbSBzdG9yYWdlLlxuICAgICAgICAgIC8vIFdlIGNhbiBqdXN0IHRyYW5zbGF0ZS5cbiAgICAgICAgICBkZXRlcm1pbmVUcmFuc2xhdGlvbih0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcywgaW50ZXJwb2xhdGlvbklkLCBkZWZhdWx0VHJhbnNsYXRpb25UZXh0KS50aGVuKGRlZmVycmVkLnJlc29sdmUsIGRlZmVycmVkLnJlamVjdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcHJvbWlzZVRvV2FpdEZvclsnZmluYWxseSddKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGRldGVybWluZVRyYW5zbGF0aW9uKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBpbnRlcnBvbGF0aW9uSWQsIGRlZmF1bHRUcmFuc2xhdGlvblRleHQpLnRoZW4oZGVmZXJyZWQucmVzb2x2ZSwgZGVmZXJyZWQucmVqZWN0KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQG5hbWUgYXBwbHlOb3RGb3VuZEluZGljYXRvcnNcbiAgICAgICAqIEBwcml2YXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBBcHBsaWVzIG5vdCBmb3VudCBpbmRpY2F0b3JzIHRvIGdpdmVuIHRyYW5zbGF0aW9uIGlkLCBpZiBuZWVkZWQuXG4gICAgICAgKiBUaGlzIGZ1bmN0aW9uIGdldHMgb25seSBleGVjdXRlZCwgaWYgYSB0cmFuc2xhdGlvbiBpZCBkb2Vzbid0IGV4aXN0LFxuICAgICAgICogd2hpY2ggaXMgd2h5IGEgdHJhbnNsYXRpb24gaWQgaXMgZXhwZWN0ZWQgYXMgYXJndW1lbnQuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IHRyYW5zbGF0aW9uSWQgVHJhbnNsYXRpb24gaWQuXG4gICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSBTYW1lIGFzIGdpdmVuIHRyYW5zbGF0aW9uIGlkIGJ1dCBhcHBsaWVkIHdpdGggbm90IGZvdW5kXG4gICAgICAgKiBpbmRpY2F0b3JzLlxuICAgICAgICovXG4gICAgICB2YXIgYXBwbHlOb3RGb3VuZEluZGljYXRvcnMgPSBmdW5jdGlvbiAodHJhbnNsYXRpb25JZCkge1xuICAgICAgICAvLyBhcHBseWluZyBub3RGb3VuZEluZGljYXRvcnNcbiAgICAgICAgaWYgKCRub3RGb3VuZEluZGljYXRvckxlZnQpIHtcbiAgICAgICAgICB0cmFuc2xhdGlvbklkID0gWyRub3RGb3VuZEluZGljYXRvckxlZnQsIHRyYW5zbGF0aW9uSWRdLmpvaW4oJyAnKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJG5vdEZvdW5kSW5kaWNhdG9yUmlnaHQpIHtcbiAgICAgICAgICB0cmFuc2xhdGlvbklkID0gW3RyYW5zbGF0aW9uSWQsICRub3RGb3VuZEluZGljYXRvclJpZ2h0XS5qb2luKCcgJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uSWQ7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuYW1lIHVzZUxhbmd1YWdlXG4gICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICpcbiAgICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAgICogTWFrZXMgYWN0dWFsIHVzZSBvZiBhIGxhbmd1YWdlIGJ5IHNldHRpbmcgYSBnaXZlbiBsYW5ndWFnZSBrZXkgYXMgdXNlZFxuICAgICAgICogbGFuZ3VhZ2UgYW5kIGluZm9ybXMgcmVnaXN0ZXJlZCBpbnRlcnBvbGF0b3JzIHRvIGFsc28gdXNlIHRoZSBnaXZlblxuICAgICAgICoga2V5IGFzIGxvY2FsZS5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge2tleX0gTG9jYWxlIGtleS5cbiAgICAgICAqL1xuICAgICAgdmFyIHVzZUxhbmd1YWdlID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAkdXNlcyA9IGtleTtcbiAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZUNoYW5nZVN1Y2Nlc3MnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuXG4gICAgICAgIGlmICgkc3RvcmFnZUZhY3RvcnkpIHtcbiAgICAgICAgICBTdG9yYWdlLnB1dCgkdHJhbnNsYXRlLnN0b3JhZ2VLZXkoKSwgJHVzZXMpO1xuICAgICAgICB9XG4gICAgICAgIC8vIGluZm9ybSBkZWZhdWx0IGludGVycG9sYXRvclxuICAgICAgICBkZWZhdWx0SW50ZXJwb2xhdG9yLnNldExvY2FsZSgkdXNlcyk7XG4gICAgICAgIC8vIGluZm9ybSBhbGwgb3RoZXJzIHRvbyFcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKGludGVycG9sYXRvckhhc2hNYXAsIGZ1bmN0aW9uIChpbnRlcnBvbGF0b3IsIGlkKSB7XG4gICAgICAgICAgaW50ZXJwb2xhdG9ySGFzaE1hcFtpZF0uc2V0TG9jYWxlKCR1c2VzKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRyb290U2NvcGUuJGVtaXQoJyR0cmFuc2xhdGVDaGFuZ2VFbmQnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAbmFtZSBsb2FkQXN5bmNcbiAgICAgICAqIEBwcml2YXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBLaWNrcyBvZiByZWdpc3RlcmVkIGFzeW5jIGxvYWRlciB1c2luZyBgJGluamVjdG9yYCBhbmQgYXBwbGllcyBleGlzdGluZ1xuICAgICAgICogbG9hZGVyIG9wdGlvbnMuIFdoZW4gcmVzb2x2ZWQsIGl0IHVwZGF0ZXMgdHJhbnNsYXRpb24gdGFibGVzIGFjY29yZGluZ2x5XG4gICAgICAgKiBvciByZWplY3RzIHdpdGggZ2l2ZW4gbGFuZ3VhZ2Uga2V5LlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBrZXkgTGFuZ3VhZ2Uga2V5LlxuICAgICAgICogQHJldHVybiB7UHJvbWlzZX0gQSBwcm9taXNlLlxuICAgICAgICovXG4gICAgICB2YXIgbG9hZEFzeW5jID0gZnVuY3Rpb24gKGtleSkge1xuICAgICAgICBpZiAoIWtleSkge1xuICAgICAgICAgIHRocm93ICdObyBsYW5ndWFnZSBrZXkgc3BlY2lmaWVkIGZvciBsb2FkaW5nLic7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgICRyb290U2NvcGUuJGVtaXQoJyR0cmFuc2xhdGVMb2FkaW5nU3RhcnQnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuICAgICAgICBwZW5kaW5nTG9hZGVyID0gdHJ1ZTtcblxuICAgICAgICB2YXIgY2FjaGUgPSBsb2FkZXJDYWNoZTtcbiAgICAgICAgaWYgKHR5cGVvZihjYWNoZSkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgLy8gZ2V0dGluZyBvbi1kZW1hbmQgaW5zdGFuY2Ugb2YgbG9hZGVyXG4gICAgICAgICAgY2FjaGUgPSAkaW5qZWN0b3IuZ2V0KGNhY2hlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBsb2FkZXJPcHRpb25zID0gYW5ndWxhci5leHRlbmQoe30sICRsb2FkZXJPcHRpb25zLCB7XG4gICAgICAgICAga2V5OiBrZXksXG4gICAgICAgICAgJGh0dHA6IGFuZ3VsYXIuZXh0ZW5kKHt9LCB7XG4gICAgICAgICAgICBjYWNoZTogY2FjaGVcbiAgICAgICAgICB9LCAkbG9hZGVyT3B0aW9ucy4kaHR0cClcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJGluamVjdG9yLmdldCgkbG9hZGVyRmFjdG9yeSkobG9hZGVyT3B0aW9ucykudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgIHZhciB0cmFuc2xhdGlvblRhYmxlID0ge307XG4gICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZUxvYWRpbmdTdWNjZXNzJywge2xhbmd1YWdlOiBrZXl9KTtcblxuICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoZGF0YSkpIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChkYXRhLCBmdW5jdGlvbiAodGFibGUpIHtcbiAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodHJhbnNsYXRpb25UYWJsZSwgZmxhdE9iamVjdCh0YWJsZSkpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHRyYW5zbGF0aW9uVGFibGUsIGZsYXRPYmplY3QoZGF0YSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBwZW5kaW5nTG9hZGVyID0gZmFsc2U7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh7XG4gICAgICAgICAgICBrZXk6IGtleSxcbiAgICAgICAgICAgIHRhYmxlOiB0cmFuc2xhdGlvblRhYmxlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZUxvYWRpbmdFbmQnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuICAgICAgICB9LCBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZUxvYWRpbmdFcnJvcicsIHtsYW5ndWFnZToga2V5fSk7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGtleSk7XG4gICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZUxvYWRpbmdFbmQnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICBpZiAoJHN0b3JhZ2VGYWN0b3J5KSB7XG4gICAgICAgIFN0b3JhZ2UgPSAkaW5qZWN0b3IuZ2V0KCRzdG9yYWdlRmFjdG9yeSk7XG5cbiAgICAgICAgaWYgKCFTdG9yYWdlLmdldCB8fCAhU3RvcmFnZS5wdXQpIHtcbiAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkblxcJ3QgdXNlIHN0b3JhZ2UgXFwnJyArICRzdG9yYWdlRmFjdG9yeSArICdcXCcsIG1pc3NpbmcgZ2V0KCkgb3IgcHV0KCkgbWV0aG9kIScpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIC8vIGFwcGx5IGFkZGl0aW9uYWwgc2V0dGluZ3NcbiAgICAgIGlmIChhbmd1bGFyLmlzRnVuY3Rpb24oZGVmYXVsdEludGVycG9sYXRvci51c2VTYW5pdGl6ZVZhbHVlU3RyYXRlZ3kpKSB7XG4gICAgICAgIGRlZmF1bHRJbnRlcnBvbGF0b3IudXNlU2FuaXRpemVWYWx1ZVN0cmF0ZWd5KCRpbnRlcnBvbGF0aW9uU2FuaXRpemF0aW9uU3RyYXRlZ3kpO1xuICAgICAgfVxuXG4gICAgICAvLyBpZiB3ZSBoYXZlIGFkZGl0aW9uYWwgaW50ZXJwb2xhdGlvbnMgdGhhdCB3ZXJlIGFkZGVkIHZpYVxuICAgICAgLy8gJHRyYW5zbGF0ZVByb3ZpZGVyLmFkZEludGVycG9sYXRpb24oKSwgd2UgaGF2ZSB0byBtYXAnZW1cbiAgICAgIGlmICgkaW50ZXJwb2xhdG9yRmFjdG9yaWVzLmxlbmd0aCkge1xuICAgICAgICBhbmd1bGFyLmZvckVhY2goJGludGVycG9sYXRvckZhY3RvcmllcywgZnVuY3Rpb24gKGludGVycG9sYXRvckZhY3RvcnkpIHtcbiAgICAgICAgICB2YXIgaW50ZXJwb2xhdG9yID0gJGluamVjdG9yLmdldChpbnRlcnBvbGF0b3JGYWN0b3J5KTtcbiAgICAgICAgICAvLyBzZXR0aW5nIGluaXRpYWwgbG9jYWxlIGZvciBlYWNoIGludGVycG9sYXRpb24gc2VydmljZVxuICAgICAgICAgIGludGVycG9sYXRvci5zZXRMb2NhbGUoJHByZWZlcnJlZExhbmd1YWdlIHx8ICR1c2VzKTtcbiAgICAgICAgICAvLyBhcHBseSBhZGRpdGlvbmFsIHNldHRpbmdzXG4gICAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihpbnRlcnBvbGF0b3IudXNlU2FuaXRpemVWYWx1ZVN0cmF0ZWd5KSkge1xuICAgICAgICAgICAgaW50ZXJwb2xhdG9yLnVzZVNhbml0aXplVmFsdWVTdHJhdGVneSgkaW50ZXJwb2xhdGlvblNhbml0aXphdGlvblN0cmF0ZWd5KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgLy8gbWFrZSdlbSByZWNvZ25pemFibGUgdGhyb3VnaCBpZFxuICAgICAgICAgIGludGVycG9sYXRvckhhc2hNYXBbaW50ZXJwb2xhdG9yLmdldEludGVycG9sYXRpb25JZGVudGlmaWVyKCldID0gaW50ZXJwb2xhdG9yO1xuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBAbmFtZSBnZXRUcmFuc2xhdGlvblRhYmxlXG4gICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICpcbiAgICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAgICogUmV0dXJucyBhIHByb21pc2UgdGhhdCByZXNvbHZlcyB0byB0aGUgdHJhbnNsYXRpb24gdGFibGVcbiAgICAgICAqIG9yIGlzIHJlamVjdGVkIGlmIGFuIGVycm9yIG9jY3VycmVkLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSBsYW5nS2V5XG4gICAgICAgKiBAcmV0dXJucyB7US5wcm9taXNlfVxuICAgICAgICovXG4gICAgICB2YXIgZ2V0VHJhbnNsYXRpb25UYWJsZSA9IGZ1bmN0aW9uIChsYW5nS2V5KSB7XG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG4gICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoJHRyYW5zbGF0aW9uVGFibGUsIGxhbmdLZXkpKSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSgkdHJhbnNsYXRpb25UYWJsZVtsYW5nS2V5XSk7XG4gICAgICAgIH0gZWxzZSBpZiAobGFuZ1Byb21pc2VzW2xhbmdLZXldKSB7XG4gICAgICAgICAgbGFuZ1Byb21pc2VzW2xhbmdLZXldLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICAgIHRyYW5zbGF0aW9ucyhkYXRhLmtleSwgZGF0YS50YWJsZSk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEudGFibGUpO1xuICAgICAgICAgIH0sIGRlZmVycmVkLnJlamVjdCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuYW1lIGdldEZhbGxiYWNrVHJhbnNsYXRpb25cbiAgICAgICAqIEBwcml2YXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB0aGF0IHdpbGwgcmVzb2x2ZSB0byB0aGUgdHJhbnNsYXRpb25cbiAgICAgICAqIG9yIGJlIHJlamVjdGVkIGlmIG5vIHRyYW5zbGF0aW9uIHdhcyBmb3VuZCBmb3IgdGhlIGxhbmd1YWdlLlxuICAgICAgICogVGhpcyBmdW5jdGlvbiBpcyBjdXJyZW50bHkgb25seSB1c2VkIGZvciBmYWxsYmFjayBsYW5ndWFnZSB0cmFuc2xhdGlvbi5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gbGFuZ0tleSBUaGUgbGFuZ3VhZ2UgdG8gdHJhbnNsYXRlIHRvLlxuICAgICAgICogQHBhcmFtIHRyYW5zbGF0aW9uSWRcbiAgICAgICAqIEBwYXJhbSBpbnRlcnBvbGF0ZVBhcmFtc1xuICAgICAgICogQHBhcmFtIEludGVycG9sYXRvclxuICAgICAgICogQHJldHVybnMge1EucHJvbWlzZX1cbiAgICAgICAqL1xuICAgICAgdmFyIGdldEZhbGxiYWNrVHJhbnNsYXRpb24gPSBmdW5jdGlvbiAobGFuZ0tleSwgdHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcikge1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIGdldFRyYW5zbGF0aW9uVGFibGUobGFuZ0tleSkudGhlbihmdW5jdGlvbiAodHJhbnNsYXRpb25UYWJsZSkge1xuICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodHJhbnNsYXRpb25UYWJsZSwgdHJhbnNsYXRpb25JZCkpIHtcbiAgICAgICAgICAgIEludGVycG9sYXRvci5zZXRMb2NhbGUobGFuZ0tleSk7XG4gICAgICAgICAgICB2YXIgdHJhbnNsYXRpb24gPSB0cmFuc2xhdGlvblRhYmxlW3RyYW5zbGF0aW9uSWRdO1xuICAgICAgICAgICAgaWYgKHRyYW5zbGF0aW9uLnN1YnN0cigwLCAyKSA9PT0gJ0A6Jykge1xuICAgICAgICAgICAgICBnZXRGYWxsYmFja1RyYW5zbGF0aW9uKGxhbmdLZXksIHRyYW5zbGF0aW9uLnN1YnN0cigyKSwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcilcbiAgICAgICAgICAgICAgICAudGhlbihkZWZlcnJlZC5yZXNvbHZlLCBkZWZlcnJlZC5yZWplY3QpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShJbnRlcnBvbGF0b3IuaW50ZXJwb2xhdGUodHJhbnNsYXRpb25UYWJsZVt0cmFuc2xhdGlvbklkXSwgaW50ZXJwb2xhdGVQYXJhbXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIEludGVycG9sYXRvci5zZXRMb2NhbGUoJHVzZXMpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sIGRlZmVycmVkLnJlamVjdCk7XG5cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuYW1lIGdldEZhbGxiYWNrVHJhbnNsYXRpb25JbnN0YW50XG4gICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICpcbiAgICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAgICogUmV0dXJucyBhIHRyYW5zbGF0aW9uXG4gICAgICAgKiBUaGlzIGZ1bmN0aW9uIGlzIGN1cnJlbnRseSBvbmx5IHVzZWQgZm9yIGZhbGxiYWNrIGxhbmd1YWdlIHRyYW5zbGF0aW9uLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSBsYW5nS2V5IFRoZSBsYW5ndWFnZSB0byB0cmFuc2xhdGUgdG8uXG4gICAgICAgKiBAcGFyYW0gdHJhbnNsYXRpb25JZFxuICAgICAgICogQHBhcmFtIGludGVycG9sYXRlUGFyYW1zXG4gICAgICAgKiBAcGFyYW0gSW50ZXJwb2xhdG9yXG4gICAgICAgKiBAcmV0dXJucyB7c3RyaW5nfSB0cmFuc2xhdGlvblxuICAgICAgICovXG4gICAgICB2YXIgZ2V0RmFsbGJhY2tUcmFuc2xhdGlvbkluc3RhbnQgPSBmdW5jdGlvbiAobGFuZ0tleSwgdHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcikge1xuICAgICAgICB2YXIgcmVzdWx0LCB0cmFuc2xhdGlvblRhYmxlID0gJHRyYW5zbGF0aW9uVGFibGVbbGFuZ0tleV07XG5cbiAgICAgICAgaWYgKHRyYW5zbGF0aW9uVGFibGUgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHRyYW5zbGF0aW9uVGFibGUsIHRyYW5zbGF0aW9uSWQpKSB7XG4gICAgICAgICAgSW50ZXJwb2xhdG9yLnNldExvY2FsZShsYW5nS2V5KTtcbiAgICAgICAgICByZXN1bHQgPSBJbnRlcnBvbGF0b3IuaW50ZXJwb2xhdGUodHJhbnNsYXRpb25UYWJsZVt0cmFuc2xhdGlvbklkXSwgaW50ZXJwb2xhdGVQYXJhbXMpO1xuICAgICAgICAgIGlmIChyZXN1bHQuc3Vic3RyKDAsIDIpID09PSAnQDonKSB7XG4gICAgICAgICAgICByZXR1cm4gZ2V0RmFsbGJhY2tUcmFuc2xhdGlvbkluc3RhbnQobGFuZ0tleSwgcmVzdWx0LnN1YnN0cigyKSwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcik7XG4gICAgICAgICAgfVxuICAgICAgICAgIEludGVycG9sYXRvci5zZXRMb2NhbGUoJHVzZXMpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG5cblxuICAgICAgLyoqXG4gICAgICAgKiBAbmFtZSB0cmFuc2xhdGVCeUhhbmRsZXJcbiAgICAgICAqIEBwcml2YXRlXG4gICAgICAgKlxuICAgICAgICogVHJhbnNsYXRlIGJ5IG1pc3NpbmcgdHJhbnNsYXRpb24gaGFuZGxlci5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gdHJhbnNsYXRpb25JZFxuICAgICAgICogQHJldHVybnMgdHJhbnNsYXRpb24gY3JlYXRlZCBieSAkbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlciBvciB0cmFuc2xhdGlvbklkIGlzICRtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyIGlzXG4gICAgICAgKiBhYnNlbnRcbiAgICAgICAqL1xuICAgICAgdmFyIHRyYW5zbGF0ZUJ5SGFuZGxlciA9IGZ1bmN0aW9uICh0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcykge1xuICAgICAgICAvLyBJZiB3ZSBoYXZlIGEgaGFuZGxlciBmYWN0b3J5IC0gd2UgbWlnaHQgYWxzbyBjYWxsIGl0IGhlcmUgdG8gZGV0ZXJtaW5lIGlmIGl0IHByb3ZpZGVzXG4gICAgICAgIC8vIGEgZGVmYXVsdCB0ZXh0IGZvciBhIHRyYW5zbGF0aW9uaWQgdGhhdCBjYW4ndCBiZSBmb3VuZCBhbnl3aGVyZSBpbiBvdXIgdGFibGVzXG4gICAgICAgIGlmICgkbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckZhY3RvcnkpIHtcbiAgICAgICAgICB2YXIgcmVzdWx0U3RyaW5nID0gJGluamVjdG9yLmdldCgkbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckZhY3RvcnkpKHRyYW5zbGF0aW9uSWQsICR1c2VzLCBpbnRlcnBvbGF0ZVBhcmFtcyk7XG4gICAgICAgICAgaWYgKHJlc3VsdFN0cmluZyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzdWx0U3RyaW5nO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gdHJhbnNsYXRpb25JZDtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uSWQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQG5hbWUgcmVzb2x2ZUZvckZhbGxiYWNrTGFuZ3VhZ2VcbiAgICAgICAqIEBwcml2YXRlXG4gICAgICAgKlxuICAgICAgICogUmVjdXJzaXZlIGhlbHBlciBmdW5jdGlvbiBmb3IgZmFsbGJhY2tUcmFuc2xhdGlvbiB0aGF0IHdpbGwgc2VxdWVudGlhbGx5IGxvb2tcbiAgICAgICAqIGZvciBhIHRyYW5zbGF0aW9uIGluIHRoZSBmYWxsYmFja0xhbmd1YWdlcyBzdGFydGluZyB3aXRoIGZhbGxiYWNrTGFuZ3VhZ2VJbmRleC5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gZmFsbGJhY2tMYW5ndWFnZUluZGV4XG4gICAgICAgKiBAcGFyYW0gdHJhbnNsYXRpb25JZFxuICAgICAgICogQHBhcmFtIGludGVycG9sYXRlUGFyYW1zXG4gICAgICAgKiBAcGFyYW0gSW50ZXJwb2xhdG9yXG4gICAgICAgKiBAcmV0dXJucyB7US5wcm9taXNlfSBQcm9taXNlIHRoYXQgd2lsbCByZXNvbHZlIHRvIHRoZSB0cmFuc2xhdGlvbi5cbiAgICAgICAqL1xuICAgICAgdmFyIHJlc29sdmVGb3JGYWxsYmFja0xhbmd1YWdlID0gZnVuY3Rpb24gKGZhbGxiYWNrTGFuZ3VhZ2VJbmRleCwgdHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvciwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCkge1xuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIGlmIChmYWxsYmFja0xhbmd1YWdlSW5kZXggPCAkZmFsbGJhY2tMYW5ndWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICB2YXIgbGFuZ0tleSA9ICRmYWxsYmFja0xhbmd1YWdlW2ZhbGxiYWNrTGFuZ3VhZ2VJbmRleF07XG4gICAgICAgICAgZ2V0RmFsbGJhY2tUcmFuc2xhdGlvbihsYW5nS2V5LCB0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcywgSW50ZXJwb2xhdG9yKS50aGVuKFxuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgLy8gTG9vayBpbiB0aGUgbmV4dCBmYWxsYmFjayBsYW5ndWFnZSBmb3IgYSB0cmFuc2xhdGlvbi5cbiAgICAgICAgICAgICAgLy8gSXQgZGVsYXlzIHRoZSByZXNvbHZpbmcgYnkgcGFzc2luZyBhbm90aGVyIHByb21pc2UgdG8gcmVzb2x2ZS5cbiAgICAgICAgICAgICAgcmVzb2x2ZUZvckZhbGxiYWNrTGFuZ3VhZ2UoZmFsbGJhY2tMYW5ndWFnZUluZGV4ICsgMSwgdHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvciwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCkudGhlbihkZWZlcnJlZC5yZXNvbHZlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIE5vIHRyYW5zbGF0aW9uIGZvdW5kIGluIGFueSBmYWxsYmFjayBsYW5ndWFnZVxuICAgICAgICAgIC8vIGlmIGEgZGVmYXVsdCB0cmFuc2xhdGlvbiB0ZXh0IGlzIHNldCBpbiB0aGUgZGlyZWN0aXZlLCB0aGVuIHJldHVybiB0aGlzIGFzIGEgcmVzdWx0XG4gICAgICAgICAgaWYgKGRlZmF1bHRUcmFuc2xhdGlvblRleHQpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGlmIG5vIGRlZmF1bHQgdHJhbnNsYXRpb24gaXMgc2V0IGFuZCBhbiBlcnJvciBoYW5kbGVyIGlzIGRlZmluZWQsIHNlbmQgaXQgdG8gdGhlIGhhbmRsZXJcbiAgICAgICAgICAgIC8vIGFuZCB0aGVuIHJldHVybiB0aGUgcmVzdWx0XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRyYW5zbGF0ZUJ5SGFuZGxlcih0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQG5hbWUgcmVzb2x2ZUZvckZhbGxiYWNrTGFuZ3VhZ2VJbnN0YW50XG4gICAgICAgKiBAcHJpdmF0ZVxuICAgICAgICpcbiAgICAgICAqIFJlY3Vyc2l2ZSBoZWxwZXIgZnVuY3Rpb24gZm9yIGZhbGxiYWNrVHJhbnNsYXRpb24gdGhhdCB3aWxsIHNlcXVlbnRpYWxseSBsb29rXG4gICAgICAgKiBmb3IgYSB0cmFuc2xhdGlvbiBpbiB0aGUgZmFsbGJhY2tMYW5ndWFnZXMgc3RhcnRpbmcgd2l0aCBmYWxsYmFja0xhbmd1YWdlSW5kZXguXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIGZhbGxiYWNrTGFuZ3VhZ2VJbmRleFxuICAgICAgICogQHBhcmFtIHRyYW5zbGF0aW9uSWRcbiAgICAgICAqIEBwYXJhbSBpbnRlcnBvbGF0ZVBhcmFtc1xuICAgICAgICogQHBhcmFtIEludGVycG9sYXRvclxuICAgICAgICogQHJldHVybnMge3N0cmluZ30gdHJhbnNsYXRpb25cbiAgICAgICAqL1xuICAgICAgdmFyIHJlc29sdmVGb3JGYWxsYmFja0xhbmd1YWdlSW5zdGFudCA9IGZ1bmN0aW9uIChmYWxsYmFja0xhbmd1YWdlSW5kZXgsIHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBJbnRlcnBvbGF0b3IpIHtcbiAgICAgICAgdmFyIHJlc3VsdDtcblxuICAgICAgICBpZiAoZmFsbGJhY2tMYW5ndWFnZUluZGV4IDwgJGZhbGxiYWNrTGFuZ3VhZ2UubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIGxhbmdLZXkgPSAkZmFsbGJhY2tMYW5ndWFnZVtmYWxsYmFja0xhbmd1YWdlSW5kZXhdO1xuICAgICAgICAgIHJlc3VsdCA9IGdldEZhbGxiYWNrVHJhbnNsYXRpb25JbnN0YW50KGxhbmdLZXksIHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBJbnRlcnBvbGF0b3IpO1xuICAgICAgICAgIGlmICghcmVzdWx0KSB7XG4gICAgICAgICAgICByZXN1bHQgPSByZXNvbHZlRm9yRmFsbGJhY2tMYW5ndWFnZUluc3RhbnQoZmFsbGJhY2tMYW5ndWFnZUluZGV4ICsgMSwgdHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIFRyYW5zbGF0ZXMgd2l0aCB0aGUgdXNhZ2Ugb2YgdGhlIGZhbGxiYWNrIGxhbmd1YWdlcy5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gdHJhbnNsYXRpb25JZFxuICAgICAgICogQHBhcmFtIGludGVycG9sYXRlUGFyYW1zXG4gICAgICAgKiBAcGFyYW0gSW50ZXJwb2xhdG9yXG4gICAgICAgKiBAcmV0dXJucyB7US5wcm9taXNlfSBQcm9taXNlLCB0aGF0IHJlc29sdmVzIHRvIHRoZSB0cmFuc2xhdGlvbi5cbiAgICAgICAqL1xuICAgICAgdmFyIGZhbGxiYWNrVHJhbnNsYXRpb24gPSBmdW5jdGlvbiAodHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvciwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCkge1xuICAgICAgICAvLyBTdGFydCB3aXRoIHRoZSBmYWxsYmFja0xhbmd1YWdlIHdpdGggaW5kZXggMFxuICAgICAgICByZXR1cm4gcmVzb2x2ZUZvckZhbGxiYWNrTGFuZ3VhZ2UoKHN0YXJ0RmFsbGJhY2tJdGVyYXRpb24+MCA/IHN0YXJ0RmFsbGJhY2tJdGVyYXRpb24gOiBmYWxsYmFja0luZGV4KSwgdHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvciwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIFRyYW5zbGF0ZXMgd2l0aCB0aGUgdXNhZ2Ugb2YgdGhlIGZhbGxiYWNrIGxhbmd1YWdlcy5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0gdHJhbnNsYXRpb25JZFxuICAgICAgICogQHBhcmFtIGludGVycG9sYXRlUGFyYW1zXG4gICAgICAgKiBAcGFyYW0gSW50ZXJwb2xhdG9yXG4gICAgICAgKiBAcmV0dXJucyB7U3RyaW5nfSB0cmFuc2xhdGlvblxuICAgICAgICovXG4gICAgICB2YXIgZmFsbGJhY2tUcmFuc2xhdGlvbkluc3RhbnQgPSBmdW5jdGlvbiAodHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcikge1xuICAgICAgICAvLyBTdGFydCB3aXRoIHRoZSBmYWxsYmFja0xhbmd1YWdlIHdpdGggaW5kZXggMFxuICAgICAgICByZXR1cm4gcmVzb2x2ZUZvckZhbGxiYWNrTGFuZ3VhZ2VJbnN0YW50KChzdGFydEZhbGxiYWNrSXRlcmF0aW9uPjAgPyBzdGFydEZhbGxiYWNrSXRlcmF0aW9uIDogZmFsbGJhY2tJbmRleCksIHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBJbnRlcnBvbGF0b3IpO1xuICAgICAgfTtcblxuICAgICAgdmFyIGRldGVybWluZVRyYW5zbGF0aW9uID0gZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBpbnRlcnBvbGF0aW9uSWQsIGRlZmF1bHRUcmFuc2xhdGlvblRleHQpIHtcblxuICAgICAgICB2YXIgZGVmZXJyZWQgPSAkcS5kZWZlcigpO1xuXG4gICAgICAgIHZhciB0YWJsZSA9ICR1c2VzID8gJHRyYW5zbGF0aW9uVGFibGVbJHVzZXNdIDogJHRyYW5zbGF0aW9uVGFibGUsXG4gICAgICAgICAgICBJbnRlcnBvbGF0b3IgPSAoaW50ZXJwb2xhdGlvbklkKSA/IGludGVycG9sYXRvckhhc2hNYXBbaW50ZXJwb2xhdGlvbklkXSA6IGRlZmF1bHRJbnRlcnBvbGF0b3I7XG5cbiAgICAgICAgLy8gaWYgdGhlIHRyYW5zbGF0aW9uIGlkIGV4aXN0cywgd2UgY2FuIGp1c3QgaW50ZXJwb2xhdGUgaXRcbiAgICAgICAgaWYgKHRhYmxlICYmIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbCh0YWJsZSwgdHJhbnNsYXRpb25JZCkpIHtcbiAgICAgICAgICB2YXIgdHJhbnNsYXRpb24gPSB0YWJsZVt0cmFuc2xhdGlvbklkXTtcblxuICAgICAgICAgIC8vIElmIHVzaW5nIGxpbmssIHJlcnVuICR0cmFuc2xhdGUgd2l0aCBsaW5rZWQgdHJhbnNsYXRpb25JZCBhbmQgcmV0dXJuIGl0XG4gICAgICAgICAgaWYgKHRyYW5zbGF0aW9uLnN1YnN0cigwLCAyKSA9PT0gJ0A6Jykge1xuXG4gICAgICAgICAgICAkdHJhbnNsYXRlKHRyYW5zbGF0aW9uLnN1YnN0cigyKSwgaW50ZXJwb2xhdGVQYXJhbXMsIGludGVycG9sYXRpb25JZCwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dClcbiAgICAgICAgICAgICAgLnRoZW4oZGVmZXJyZWQucmVzb2x2ZSwgZGVmZXJyZWQucmVqZWN0KTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShJbnRlcnBvbGF0b3IuaW50ZXJwb2xhdGUodHJhbnNsYXRpb24sIGludGVycG9sYXRlUGFyYW1zKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyVHJhbnNsYXRpb247XG4gICAgICAgICAgLy8gZm9yIGxvZ2dpbmcgcHVycG9zZXMgb25seSAoYXMgaW4gJHRyYW5zbGF0ZU1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJMb2cpLCB2YWx1ZSBpcyBub3QgcmV0dXJuZWQgdG8gcHJvbWlzZVxuICAgICAgICAgIGlmICgkbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckZhY3RvcnkgJiYgIXBlbmRpbmdMb2FkZXIpIHtcbiAgICAgICAgICAgIG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJUcmFuc2xhdGlvbiA9IHRyYW5zbGF0ZUJ5SGFuZGxlcih0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgLy8gc2luY2Ugd2UgY291bGRuJ3QgdHJhbnNsYXRlIHRoZSBpbml0YWwgcmVxdWVzdGVkIHRyYW5zbGF0aW9uIGlkLFxuICAgICAgICAgIC8vIHdlIHRyeSBpdCBub3cgd2l0aCBvbmUgb3IgbW9yZSBmYWxsYmFjayBsYW5ndWFnZXMsIGlmIGZhbGxiYWNrIGxhbmd1YWdlKHMpIGlzXG4gICAgICAgICAgLy8gY29uZmlndXJlZC5cbiAgICAgICAgICBpZiAoJHVzZXMgJiYgJGZhbGxiYWNrTGFuZ3VhZ2UgJiYgJGZhbGxiYWNrTGFuZ3VhZ2UubGVuZ3RoKSB7XG4gICAgICAgICAgICBmYWxsYmFja1RyYW5zbGF0aW9uKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBJbnRlcnBvbGF0b3IsIGRlZmF1bHRUcmFuc2xhdGlvblRleHQpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRyYW5zbGF0aW9uKTtcbiAgICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAoX3RyYW5zbGF0aW9uSWQpIHtcbiAgICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChhcHBseU5vdEZvdW5kSW5kaWNhdG9ycyhfdHJhbnNsYXRpb25JZCkpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH0gZWxzZSBpZiAoJG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJGYWN0b3J5ICYmICFwZW5kaW5nTG9hZGVyICYmIG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJUcmFuc2xhdGlvbikge1xuICAgICAgICAgICAgLy8gbG9va3MgbGlrZSB0aGUgcmVxdWVzdGVkIHRyYW5zbGF0aW9uIGlkIGRvZXNuJ3QgZXhpc3RzLlxuICAgICAgICAgICAgLy8gTm93LCBpZiB0aGVyZSBpcyBhIHJlZ2lzdGVyZWQgaGFuZGxlciBmb3IgbWlzc2luZyB0cmFuc2xhdGlvbnMgYW5kIG5vXG4gICAgICAgICAgICAvLyBhc3luY0xvYWRlciBpcyBwZW5kaW5nLCB3ZSBleGVjdXRlIHRoZSBoYW5kbGVyXG4gICAgICAgICAgICBpZiAoZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCkge1xuICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRlZmF1bHRUcmFuc2xhdGlvblRleHQpO1xuICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUobWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlclRyYW5zbGF0aW9uKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZGVmYXVsdFRyYW5zbGF0aW9uVGV4dCkge1xuICAgICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRlZmF1bHRUcmFuc2xhdGlvblRleHQpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KGFwcGx5Tm90Rm91bmRJbmRpY2F0b3JzKHRyYW5zbGF0aW9uSWQpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZGV0ZXJtaW5lVHJhbnNsYXRpb25JbnN0YW50ID0gZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBpbnRlcnBvbGF0aW9uSWQpIHtcblxuICAgICAgICB2YXIgcmVzdWx0LCB0YWJsZSA9ICR1c2VzID8gJHRyYW5zbGF0aW9uVGFibGVbJHVzZXNdIDogJHRyYW5zbGF0aW9uVGFibGUsXG4gICAgICAgICAgICBJbnRlcnBvbGF0b3IgPSBkZWZhdWx0SW50ZXJwb2xhdG9yO1xuXG4gICAgICAgIC8vIGlmIHRoZSBpbnRlcnBvbGF0aW9uIGlkIGV4aXN0cyB1c2UgY3VzdG9tIGludGVycG9sYXRvclxuICAgICAgICBpZiAoaW50ZXJwb2xhdG9ySGFzaE1hcCAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoaW50ZXJwb2xhdG9ySGFzaE1hcCwgaW50ZXJwb2xhdGlvbklkKSkge1xuICAgICAgICAgIEludGVycG9sYXRvciA9IGludGVycG9sYXRvckhhc2hNYXBbaW50ZXJwb2xhdGlvbklkXTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIHRoZSB0cmFuc2xhdGlvbiBpZCBleGlzdHMsIHdlIGNhbiBqdXN0IGludGVycG9sYXRlIGl0XG4gICAgICAgIGlmICh0YWJsZSAmJiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwodGFibGUsIHRyYW5zbGF0aW9uSWQpKSB7XG4gICAgICAgICAgdmFyIHRyYW5zbGF0aW9uID0gdGFibGVbdHJhbnNsYXRpb25JZF07XG5cbiAgICAgICAgICAvLyBJZiB1c2luZyBsaW5rLCByZXJ1biAkdHJhbnNsYXRlIHdpdGggbGlua2VkIHRyYW5zbGF0aW9uSWQgYW5kIHJldHVybiBpdFxuICAgICAgICAgIGlmICh0cmFuc2xhdGlvbi5zdWJzdHIoMCwgMikgPT09ICdAOicpIHtcbiAgICAgICAgICAgIHJlc3VsdCA9IGRldGVybWluZVRyYW5zbGF0aW9uSW5zdGFudCh0cmFuc2xhdGlvbi5zdWJzdHIoMiksIGludGVycG9sYXRlUGFyYW1zLCBpbnRlcnBvbGF0aW9uSWQpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByZXN1bHQgPSBJbnRlcnBvbGF0b3IuaW50ZXJwb2xhdGUodHJhbnNsYXRpb24sIGludGVycG9sYXRlUGFyYW1zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJUcmFuc2xhdGlvbjtcbiAgICAgICAgICAvLyBmb3IgbG9nZ2luZyBwdXJwb3NlcyBvbmx5IChhcyBpbiAkdHJhbnNsYXRlTWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckxvZyksIHZhbHVlIGlzIG5vdCByZXR1cm5lZCB0byBwcm9taXNlXG4gICAgICAgICAgaWYgKCRtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyRmFjdG9yeSAmJiAhcGVuZGluZ0xvYWRlcikge1xuICAgICAgICAgICAgbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlclRyYW5zbGF0aW9uID0gdHJhbnNsYXRlQnlIYW5kbGVyKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyBzaW5jZSB3ZSBjb3VsZG4ndCB0cmFuc2xhdGUgdGhlIGluaXRhbCByZXF1ZXN0ZWQgdHJhbnNsYXRpb24gaWQsXG4gICAgICAgICAgLy8gd2UgdHJ5IGl0IG5vdyB3aXRoIG9uZSBvciBtb3JlIGZhbGxiYWNrIGxhbmd1YWdlcywgaWYgZmFsbGJhY2sgbGFuZ3VhZ2UocykgaXNcbiAgICAgICAgICAvLyBjb25maWd1cmVkLlxuICAgICAgICAgIGlmICgkdXNlcyAmJiAkZmFsbGJhY2tMYW5ndWFnZSAmJiAkZmFsbGJhY2tMYW5ndWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZhbGxiYWNrSW5kZXggPSAwO1xuICAgICAgICAgICAgcmVzdWx0ID0gZmFsbGJhY2tUcmFuc2xhdGlvbkluc3RhbnQodHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIEludGVycG9sYXRvcik7XG4gICAgICAgICAgfSBlbHNlIGlmICgkbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlckZhY3RvcnkgJiYgIXBlbmRpbmdMb2FkZXIgJiYgbWlzc2luZ1RyYW5zbGF0aW9uSGFuZGxlclRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgICAvLyBsb29rcyBsaWtlIHRoZSByZXF1ZXN0ZWQgdHJhbnNsYXRpb24gaWQgZG9lc24ndCBleGlzdHMuXG4gICAgICAgICAgICAvLyBOb3csIGlmIHRoZXJlIGlzIGEgcmVnaXN0ZXJlZCBoYW5kbGVyIGZvciBtaXNzaW5nIHRyYW5zbGF0aW9ucyBhbmQgbm9cbiAgICAgICAgICAgIC8vIGFzeW5jTG9hZGVyIGlzIHBlbmRpbmcsIHdlIGV4ZWN1dGUgdGhlIGhhbmRsZXJcbiAgICAgICAgICAgIHJlc3VsdCA9IG1pc3NpbmdUcmFuc2xhdGlvbkhhbmRsZXJUcmFuc2xhdGlvbjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmVzdWx0ID0gYXBwbHlOb3RGb3VuZEluZGljYXRvcnModHJhbnNsYXRpb25JZCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICAgIH07XG5cbiAgICAgIHZhciBjbGVhck5leHRMYW5nQW5kUHJvbWlzZSA9IGZ1bmN0aW9uKGtleSkge1xuICAgICAgICBpZiAoJG5leHRMYW5nID09PSBrZXkpIHtcbiAgICAgICAgICAkbmV4dExhbmcgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgbGFuZ1Byb21pc2VzW2tleV0gPSB1bmRlZmluZWQ7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlI3ByZWZlcnJlZExhbmd1YWdlXG4gICAgICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBSZXR1cm5zIHRoZSBsYW5ndWFnZSBrZXkgZm9yIHRoZSBwcmVmZXJyZWQgbGFuZ3VhZ2UuXG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmdLZXkgbGFuZ3VhZ2UgU3RyaW5nIG9yIEFycmF5IHRvIGJlIHVzZWQgYXMgcHJlZmVycmVkTGFuZ3VhZ2UgKGNoYW5naW5nIGF0IHJ1bnRpbWUpXG4gICAgICAgKlxuICAgICAgICogQHJldHVybiB7c3RyaW5nfSBwcmVmZXJyZWQgbGFuZ3VhZ2Uga2V5XG4gICAgICAgKi9cbiAgICAgICR0cmFuc2xhdGUucHJlZmVycmVkTGFuZ3VhZ2UgPSBmdW5jdGlvbiAobGFuZ0tleSkge1xuICAgICAgICBpZihsYW5nS2V5KSB7XG4gICAgICAgICAgc2V0dXBQcmVmZXJyZWRMYW5ndWFnZShsYW5nS2V5KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gJHByZWZlcnJlZExhbmd1YWdlO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZSNjbG9ha0NsYXNzTmFtZVxuICAgICAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVxuICAgICAgICpcbiAgICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAgICogUmV0dXJucyB0aGUgY29uZmlndXJlZCBjbGFzcyBuYW1lIGZvciBgdHJhbnNsYXRlLWNsb2FrYCBkaXJlY3RpdmUuXG4gICAgICAgKlxuICAgICAgICogQHJldHVybiB7c3RyaW5nfSBjbG9ha0NsYXNzTmFtZVxuICAgICAgICovXG4gICAgICAkdHJhbnNsYXRlLmNsb2FrQ2xhc3NOYW1lID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJGNsb2FrQ2xhc3NOYW1lO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZSNmYWxsYmFja0xhbmd1YWdlXG4gICAgICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBSZXR1cm5zIHRoZSBsYW5ndWFnZSBrZXkgZm9yIHRoZSBmYWxsYmFjayBsYW5ndWFnZXMgb3Igc2V0cyBhIG5ldyBmYWxsYmFjayBzdGFjay5cbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZz19IGxhbmdLZXkgbGFuZ3VhZ2UgU3RyaW5nIG9yIEFycmF5IG9mIGZhbGxiYWNrIGxhbmd1YWdlcyB0byBiZSB1c2VkICh0byBjaGFuZ2Ugc3RhY2sgYXQgcnVudGltZSlcbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJuIHtzdHJpbmd8fGFycmF5fSBmYWxsYmFjayBsYW5ndWFnZSBrZXlcbiAgICAgICAqL1xuICAgICAgJHRyYW5zbGF0ZS5mYWxsYmFja0xhbmd1YWdlID0gZnVuY3Rpb24gKGxhbmdLZXkpIHtcbiAgICAgICAgaWYgKGxhbmdLZXkgIT09IHVuZGVmaW5lZCAmJiBsYW5nS2V5ICE9PSBudWxsKSB7XG4gICAgICAgICAgZmFsbGJhY2tTdGFjayhsYW5nS2V5KTtcblxuICAgICAgICAgIC8vIGFzIHdlIG1pZ2h0IGhhdmUgYW4gYXN5bmMgbG9hZGVyIGluaXRpYXRlZCBhbmQgYSBuZXcgdHJhbnNsYXRpb24gbGFuZ3VhZ2UgbWlnaHQgaGF2ZSBiZWVuIGRlZmluZWRcbiAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGFkZCB0aGUgcHJvbWlzZSB0byB0aGUgc3RhY2sgYWxzby4gU28gLSBpdGVyYXRlLlxuICAgICAgICAgIGlmICgkbG9hZGVyRmFjdG9yeSkge1xuICAgICAgICAgICAgaWYgKCRmYWxsYmFja0xhbmd1YWdlICYmICRmYWxsYmFja0xhbmd1YWdlLmxlbmd0aCkge1xuICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gJGZhbGxiYWNrTGFuZ3VhZ2UubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHtcbiAgICAgICAgICAgICAgICBpZiAoIWxhbmdQcm9taXNlc1skZmFsbGJhY2tMYW5ndWFnZVtpXV0pIHtcbiAgICAgICAgICAgICAgICAgIGxhbmdQcm9taXNlc1skZmFsbGJhY2tMYW5ndWFnZVtpXV0gPSBsb2FkQXN5bmMoJGZhbGxiYWNrTGFuZ3VhZ2VbaV0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICAkdHJhbnNsYXRlLnVzZSgkdHJhbnNsYXRlLnVzZSgpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJGZhbGxiYWNrV2FzU3RyaW5nKSB7XG4gICAgICAgICAgcmV0dXJuICRmYWxsYmFja0xhbmd1YWdlWzBdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiAkZmFsbGJhY2tMYW5ndWFnZTtcbiAgICAgICAgfVxuXG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlI3VzZUZhbGxiYWNrTGFuZ3VhZ2VcbiAgICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVcbiAgICAgICAqXG4gICAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgICAqIFNldHMgdGhlIGZpcnN0IGtleSBvZiB0aGUgZmFsbGJhY2sgbGFuZ3VhZ2Ugc3RhY2sgdG8gYmUgdXNlZCBmb3IgdHJhbnNsYXRpb24uXG4gICAgICAgKiBUaGVyZWZvcmUgYWxsIGxhbmd1YWdlcyBpbiB0aGUgZmFsbGJhY2sgYXJyYXkgQkVGT1JFIHRoaXMga2V5IHdpbGwgYmUgc2tpcHBlZCFcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZz19IGxhbmdLZXkgQ29udGFpbnMgdGhlIGxhbmdLZXkgdGhlIGl0ZXJhdGlvbiBzaGFsbCBzdGFydCB3aXRoLiBTZXQgdG8gZmFsc2UgaWYgeW91IHdhbnQgdG9cbiAgICAgICAqIGdldCBiYWNrIHRvIHRoZSB3aG9sZSBzdGFja1xuICAgICAgICovXG4gICAgICAkdHJhbnNsYXRlLnVzZUZhbGxiYWNrTGFuZ3VhZ2UgPSBmdW5jdGlvbiAobGFuZ0tleSkge1xuICAgICAgICBpZiAobGFuZ0tleSAhPT0gdW5kZWZpbmVkICYmIGxhbmdLZXkgIT09IG51bGwpIHtcbiAgICAgICAgICBpZiAoIWxhbmdLZXkpIHtcbiAgICAgICAgICAgIHN0YXJ0RmFsbGJhY2tJdGVyYXRpb24gPSAwO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgbGFuZ0tleVBvc2l0aW9uID0gaW5kZXhPZigkZmFsbGJhY2tMYW5ndWFnZSwgbGFuZ0tleSk7XG4gICAgICAgICAgICBpZiAobGFuZ0tleVBvc2l0aW9uID4gLTEpIHtcbiAgICAgICAgICAgICAgc3RhcnRGYWxsYmFja0l0ZXJhdGlvbiA9IGxhbmdLZXlQb3NpdGlvbjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgfVxuXG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlI3Byb3Bvc2VkTGFuZ3VhZ2VcbiAgICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVcbiAgICAgICAqXG4gICAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgICAqIFJldHVybnMgdGhlIGxhbmd1YWdlIGtleSBvZiBsYW5ndWFnZSB0aGF0IGlzIGN1cnJlbnRseSBsb2FkZWQgYXN5bmNocm9ub3VzbHkuXG4gICAgICAgKlxuICAgICAgICogQHJldHVybiB7c3RyaW5nfSBsYW5ndWFnZSBrZXlcbiAgICAgICAqL1xuICAgICAgJHRyYW5zbGF0ZS5wcm9wb3NlZExhbmd1YWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gJG5leHRMYW5nO1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZSNzdG9yYWdlXG4gICAgICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBSZXR1cm5zIHJlZ2lzdGVyZWQgc3RvcmFnZS5cbiAgICAgICAqXG4gICAgICAgKiBAcmV0dXJuIHtvYmplY3R9IFN0b3JhZ2VcbiAgICAgICAqL1xuICAgICAgJHRyYW5zbGF0ZS5zdG9yYWdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gU3RvcmFnZTtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAgICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGUjdXNlXG4gICAgICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlXG4gICAgICAgKlxuICAgICAgICogQGRlc2NyaXB0aW9uXG4gICAgICAgKiBUZWxscyBhbmd1bGFyLXRyYW5zbGF0ZSB3aGljaCBsYW5ndWFnZSB0byB1c2UgYnkgZ2l2ZW4gbGFuZ3VhZ2Uga2V5LiBUaGlzIG1ldGhvZCBpc1xuICAgICAgICogdXNlZCB0byBjaGFuZ2UgbGFuZ3VhZ2UgYXQgcnVudGltZS4gSXQgYWxzbyB0YWtlcyBjYXJlIG9mIHN0b3JpbmcgdGhlIGxhbmd1YWdlXG4gICAgICAgKiBrZXkgaW4gYSBjb25maWd1cmVkIHN0b3JlIHRvIGxldCB5b3VyIGFwcCByZW1lbWJlciB0aGUgY2hvb3NlZCBsYW5ndWFnZS5cbiAgICAgICAqXG4gICAgICAgKiBXaGVuIHRyeWluZyB0byAndXNlJyBhIGxhbmd1YWdlIHdoaWNoIGlzbid0IGF2YWlsYWJsZSBpdCB0cmllcyB0byBsb2FkIGl0XG4gICAgICAgKiBhc3luY2hyb25vdXNseSB3aXRoIHJlZ2lzdGVyZWQgbG9hZGVycy5cbiAgICAgICAqXG4gICAgICAgKiBSZXR1cm5zIHByb21pc2Ugb2JqZWN0IHdpdGggbG9hZGVkIGxhbmd1YWdlIGZpbGUgZGF0YVxuICAgICAgICogQGV4YW1wbGVcbiAgICAgICAqICR0cmFuc2xhdGUudXNlKFwiZW5fVVNcIikudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAqICAgJHNjb3BlLnRleHQgPSAkdHJhbnNsYXRlKFwiSEVMTE9cIik7XG4gICAgICAgKiB9KTtcbiAgICAgICAqXG4gICAgICAgKiBAcGFyYW0ge3N0cmluZ30ga2V5IExhbmd1YWdlIGtleVxuICAgICAgICogQHJldHVybiB7c3RyaW5nfSBMYW5ndWFnZSBrZXlcbiAgICAgICAqL1xuICAgICAgJHRyYW5zbGF0ZS51c2UgPSBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgIGlmICgha2V5KSB7XG4gICAgICAgICAgcmV0dXJuICR1c2VzO1xuICAgICAgICB9XG5cbiAgICAgICAgdmFyIGRlZmVycmVkID0gJHEuZGVmZXIoKTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCckdHJhbnNsYXRlQ2hhbmdlU3RhcnQnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuXG4gICAgICAgIC8vIFRyeSB0byBnZXQgdGhlIGFsaWFzZWQgbGFuZ3VhZ2Uga2V5XG4gICAgICAgIHZhciBhbGlhc2VkS2V5ID0gbmVnb3RpYXRlTG9jYWxlKGtleSk7XG4gICAgICAgIGlmIChhbGlhc2VkS2V5KSB7XG4gICAgICAgICAga2V5ID0gYWxpYXNlZEtleTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGlmIHRoZXJlIGlzbid0IGEgdHJhbnNsYXRpb24gdGFibGUgZm9yIHRoZSBsYW5ndWFnZSB3ZSd2ZSByZXF1ZXN0ZWQsXG4gICAgICAgIC8vIHdlIGxvYWQgaXQgYXN5bmNocm9ub3VzbHlcbiAgICAgICAgaWYgKCEkdHJhbnNsYXRpb25UYWJsZVtrZXldICYmICRsb2FkZXJGYWN0b3J5ICYmICFsYW5nUHJvbWlzZXNba2V5XSkge1xuICAgICAgICAgICRuZXh0TGFuZyA9IGtleTtcbiAgICAgICAgICBsYW5nUHJvbWlzZXNba2V5XSA9IGxvYWRBc3luYyhrZXkpLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGlvbnModHJhbnNsYXRpb24ua2V5LCB0cmFuc2xhdGlvbi50YWJsZSk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRyYW5zbGF0aW9uLmtleSk7XG4gICAgICAgICAgICB1c2VMYW5ndWFnZSh0cmFuc2xhdGlvbi5rZXkpO1xuICAgICAgICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJyR0cmFuc2xhdGVDaGFuZ2VFcnJvcicsIHtsYW5ndWFnZToga2V5fSk7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZWplY3Qoa2V5KTtcbiAgICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJyR0cmFuc2xhdGVDaGFuZ2VFbmQnLCB7bGFuZ3VhZ2U6IGtleX0pO1xuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChrZXkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIGxhbmdQcm9taXNlc1trZXldWydmaW5hbGx5J10oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgY2xlYXJOZXh0TGFuZ0FuZFByb21pc2Uoa2V5KTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIGlmICgkbmV4dExhbmcgPT09IGtleSAmJiBsYW5nUHJvbWlzZXNba2V5XSkge1xuICAgICAgICAgIC8vIHdlIGFyZSBhbHJlYWR5IGxvYWRpbmcgdGhpcyBhc3luY2hyb25vdXNseVxuICAgICAgICAgIC8vIHJlc29sdmUgb3VyIG5ldyBkZWZlcnJlZCB3aGVuIHRoZSBvbGQgbGFuZ1Byb21pc2UgaXMgcmVzb2x2ZWRcbiAgICAgICAgICBsYW5nUHJvbWlzZXNba2V5XS50aGVuKGZ1bmN0aW9uICh0cmFuc2xhdGlvbikge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVzb2x2ZSh0cmFuc2xhdGlvbi5rZXkpO1xuICAgICAgICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIGRlZmVycmVkLnJlamVjdChrZXkpO1xuICAgICAgICAgICAgcmV0dXJuICRxLnJlamVjdChrZXkpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRlZmVycmVkLnJlc29sdmUoa2V5KTtcbiAgICAgICAgICB1c2VMYW5ndWFnZShrZXkpO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlI3N0b3JhZ2VLZXlcbiAgICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVcbiAgICAgICAqXG4gICAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgICAqIFJldHVybnMgdGhlIGtleSBmb3IgdGhlIHN0b3JhZ2UuXG4gICAgICAgKlxuICAgICAgICogQHJldHVybiB7c3RyaW5nfSBzdG9yYWdlIGtleVxuICAgICAgICovXG4gICAgICAkdHJhbnNsYXRlLnN0b3JhZ2VLZXkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBzdG9yYWdlS2V5KCk7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlI2lzUG9zdENvbXBpbGluZ0VuYWJsZWRcbiAgICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVcbiAgICAgICAqXG4gICAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgICAqIFJldHVybnMgd2hldGhlciBwb3N0IGNvbXBpbGluZyBpcyBlbmFibGVkIG9yIG5vdFxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm4ge2Jvb2x9IHN0b3JhZ2Uga2V5XG4gICAgICAgKi9cbiAgICAgICR0cmFuc2xhdGUuaXNQb3N0Q29tcGlsaW5nRW5hYmxlZCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICRwb3N0Q29tcGlsaW5nRW5hYmxlZDtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAgICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGUjcmVmcmVzaFxuICAgICAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVxuICAgICAgICpcbiAgICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAgICogUmVmcmVzaGVzIGEgdHJhbnNsYXRpb24gdGFibGUgcG9pbnRlZCBieSB0aGUgZ2l2ZW4gbGFuZ0tleS4gSWYgbGFuZ0tleSBpcyBub3Qgc3BlY2lmaWVkLFxuICAgICAgICogdGhlIG1vZHVsZSB3aWxsIGRyb3AgYWxsIGV4aXN0ZW50IHRyYW5zbGF0aW9uIHRhYmxlcyBhbmQgbG9hZCBuZXcgdmVyc2lvbiBvZiB0aG9zZSB3aGljaFxuICAgICAgICogYXJlIGN1cnJlbnRseSBpbiB1c2UuXG4gICAgICAgKlxuICAgICAgICogUmVmcmVzaCBtZWFucyB0aGF0IHRoZSBtb2R1bGUgd2lsbCBkcm9wIHRhcmdldCB0cmFuc2xhdGlvbiB0YWJsZSBhbmQgdHJ5IHRvIGxvYWQgaXQgYWdhaW4uXG4gICAgICAgKlxuICAgICAgICogSW4gY2FzZSB0aGVyZSBhcmUgbm8gbG9hZGVycyByZWdpc3RlcmVkIHRoZSByZWZyZXNoKCkgbWV0aG9kIHdpbGwgdGhyb3cgYW4gRXJyb3IuXG4gICAgICAgKlxuICAgICAgICogSWYgdGhlIG1vZHVsZSBpcyBhYmxlIHRvIHJlZnJlc2ggdHJhbnNsYXRpb24gdGFibGVzIHJlZnJlc2goKSBtZXRob2Qgd2lsbCBicm9hZGNhc3RcbiAgICAgICAqICR0cmFuc2xhdGVSZWZyZXNoU3RhcnQgYW5kICR0cmFuc2xhdGVSZWZyZXNoRW5kIGV2ZW50cy5cbiAgICAgICAqXG4gICAgICAgKiBAZXhhbXBsZVxuICAgICAgICogLy8gdGhpcyB3aWxsIGRyb3AgYWxsIGN1cnJlbnRseSBleGlzdGVudCB0cmFuc2xhdGlvbiB0YWJsZXMgYW5kIHJlbG9hZCB0aG9zZSB3aGljaCBhcmVcbiAgICAgICAqIC8vIGN1cnJlbnRseSBpbiB1c2VcbiAgICAgICAqICR0cmFuc2xhdGUucmVmcmVzaCgpO1xuICAgICAgICogLy8gdGhpcyB3aWxsIHJlZnJlc2ggYSB0cmFuc2xhdGlvbiB0YWJsZSBmb3IgdGhlIGVuX1VTIGxhbmd1YWdlXG4gICAgICAgKiAkdHJhbnNsYXRlLnJlZnJlc2goJ2VuX1VTJyk7XG4gICAgICAgKlxuICAgICAgICogQHBhcmFtIHtzdHJpbmd9IGxhbmdLZXkgQSBsYW5ndWFnZSBrZXkgb2YgdGhlIHRhYmxlLCB3aGljaCBoYXMgdG8gYmUgcmVmcmVzaGVkXG4gICAgICAgKlxuICAgICAgICogQHJldHVybiB7cHJvbWlzZX0gUHJvbWlzZSwgd2hpY2ggd2lsbCBiZSByZXNvbHZlZCBpbiBjYXNlIGEgdHJhbnNsYXRpb24gdGFibGVzIHJlZnJlc2hpbmdcbiAgICAgICAqIHByb2Nlc3MgaXMgZmluaXNoZWQgc3VjY2Vzc2Z1bGx5LCBhbmQgcmVqZWN0IGlmIG5vdC5cbiAgICAgICAqL1xuICAgICAgJHRyYW5zbGF0ZS5yZWZyZXNoID0gZnVuY3Rpb24gKGxhbmdLZXkpIHtcbiAgICAgICAgaWYgKCEkbG9hZGVyRmFjdG9yeSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQ291bGRuXFwndCByZWZyZXNoIHRyYW5zbGF0aW9uIHRhYmxlLCBubyBsb2FkZXIgcmVnaXN0ZXJlZCEnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICAgICAgZnVuY3Rpb24gcmVzb2x2ZSgpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKCk7XG4gICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZVJlZnJlc2hFbmQnLCB7bGFuZ3VhZ2U6IGxhbmdLZXl9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdCgpIHtcbiAgICAgICAgICBkZWZlcnJlZC5yZWplY3QoKTtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRlbWl0KCckdHJhbnNsYXRlUmVmcmVzaEVuZCcsIHtsYW5ndWFnZTogbGFuZ0tleX0pO1xuICAgICAgICB9XG5cbiAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZVJlZnJlc2hTdGFydCcsIHtsYW5ndWFnZTogbGFuZ0tleX0pO1xuXG4gICAgICAgIGlmICghbGFuZ0tleSkge1xuICAgICAgICAgIC8vIGlmIHRoZXJlJ3Mgbm8gbGFuZ3VhZ2Uga2V5IHNwZWNpZmllZCB3ZSByZWZyZXNoIEFMTCBUSEUgVEhJTkdTIVxuICAgICAgICAgIHZhciB0YWJsZXMgPSBbXSwgbG9hZGluZ0tleXMgPSB7fTtcblxuICAgICAgICAgIC8vIHJlbG9hZCByZWdpc3RlcmVkIGZhbGxiYWNrIGxhbmd1YWdlc1xuICAgICAgICAgIGlmICgkZmFsbGJhY2tMYW5ndWFnZSAmJiAkZmFsbGJhY2tMYW5ndWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSAkZmFsbGJhY2tMYW5ndWFnZS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgICB0YWJsZXMucHVzaChsb2FkQXN5bmMoJGZhbGxiYWNrTGFuZ3VhZ2VbaV0pKTtcbiAgICAgICAgICAgICAgbG9hZGluZ0tleXNbJGZhbGxiYWNrTGFuZ3VhZ2VbaV1dID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG5cbiAgICAgICAgICAvLyByZWxvYWQgY3VycmVudGx5IHVzZWQgbGFuZ3VhZ2VcbiAgICAgICAgICBpZiAoJHVzZXMgJiYgIWxvYWRpbmdLZXlzWyR1c2VzXSkge1xuICAgICAgICAgICAgdGFibGVzLnB1c2gobG9hZEFzeW5jKCR1c2VzKSk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgJHEuYWxsKHRhYmxlcykudGhlbihmdW5jdGlvbiAodGFibGVEYXRhKSB7XG4gICAgICAgICAgICBhbmd1bGFyLmZvckVhY2godGFibGVEYXRhLCBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICAgICAgICBpZiAoJHRyYW5zbGF0aW9uVGFibGVbZGF0YS5rZXldKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlICR0cmFuc2xhdGlvblRhYmxlW2RhdGEua2V5XTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB0cmFuc2xhdGlvbnMoZGF0YS5rZXksIGRhdGEudGFibGUpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoJHVzZXMpIHtcbiAgICAgICAgICAgICAgdXNlTGFuZ3VhZ2UoJHVzZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgIH0pO1xuXG4gICAgICAgIH0gZWxzZSBpZiAoJHRyYW5zbGF0aW9uVGFibGVbbGFuZ0tleV0pIHtcblxuICAgICAgICAgIGxvYWRBc3luYyhsYW5nS2V5KS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGlvbnMoZGF0YS5rZXksIGRhdGEudGFibGUpO1xuICAgICAgICAgICAgaWYgKGxhbmdLZXkgPT09ICR1c2VzKSB7XG4gICAgICAgICAgICAgIHVzZUxhbmd1YWdlKCR1c2VzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICB9LCByZWplY3QpO1xuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVqZWN0KCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgICB9O1xuXG4gICAgICAvKipcbiAgICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlI2luc3RhbnRcbiAgICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVcbiAgICAgICAqXG4gICAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgICAqIFJldHVybnMgYSB0cmFuc2xhdGlvbiBpbnN0YW50bHkgZnJvbSB0aGUgaW50ZXJuYWwgc3RhdGUgb2YgbG9hZGVkIHRyYW5zbGF0aW9uLiBBbGwgcnVsZXNcbiAgICAgICAqIHJlZ2FyZGluZyB0aGUgY3VycmVudCBsYW5ndWFnZSwgdGhlIHByZWZlcnJlZCBsYW5ndWFnZSBvZiBldmVuIGZhbGxiYWNrIGxhbmd1YWdlcyB3aWxsIGJlXG4gICAgICAgKiB1c2VkIGV4Y2VwdCBhbnkgcHJvbWlzZSBoYW5kbGluZy4gSWYgYSBsYW5ndWFnZSB3YXMgbm90IGZvdW5kLCBhbiBhc3luY2hyb25vdXMgbG9hZGluZ1xuICAgICAgICogd2lsbCBiZSBpbnZva2VkIGluIHRoZSBiYWNrZ3JvdW5kLlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfGFycmF5fSB0cmFuc2xhdGlvbklkIEEgdG9rZW4gd2hpY2ggcmVwcmVzZW50cyBhIHRyYW5zbGF0aW9uIGlkXG4gICAgICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUaGlzIGNhbiBiZSBvcHRpb25hbGx5IGFuIGFycmF5IG9mIHRyYW5zbGF0aW9uIGlkcyB3aGljaFxuICAgICAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0cyB0aGF0IHRoZSBmdW5jdGlvbidzIHByb21pc2UgcmV0dXJucyBhbiBvYmplY3Qgd2hlcmVcbiAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVhY2gga2V5IGlzIHRoZSB0cmFuc2xhdGlvbiBpZCBhbmQgdGhlIHZhbHVlIHRoZSB0cmFuc2xhdGlvbi5cbiAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBpbnRlcnBvbGF0ZVBhcmFtcyBQYXJhbXNcbiAgICAgICAqIEBwYXJhbSB7c3RyaW5nfSBpbnRlcnBvbGF0aW9uSWQgVGhlIGlkIG9mIHRoZSBpbnRlcnBvbGF0aW9uIHRvIHVzZVxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gdHJhbnNsYXRpb25cbiAgICAgICAqL1xuICAgICAgJHRyYW5zbGF0ZS5pbnN0YW50ID0gZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBpbnRlcnBvbGF0aW9uSWQpIHtcblxuICAgICAgICAvLyBEZXRlY3QgdW5kZWZpbmVkIGFuZCBudWxsIHZhbHVlcyB0byBzaG9ydGVuIHRoZSBleGVjdXRpb24gYW5kIHByZXZlbnQgZXhjZXB0aW9uc1xuICAgICAgICBpZiAodHJhbnNsYXRpb25JZCA9PT0gbnVsbCB8fCBhbmd1bGFyLmlzVW5kZWZpbmVkKHRyYW5zbGF0aW9uSWQpKSB7XG4gICAgICAgICAgcmV0dXJuIHRyYW5zbGF0aW9uSWQ7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBEdWNrIGRldGVjdGlvbjogSWYgdGhlIGZpcnN0IGFyZ3VtZW50IGlzIGFuIGFycmF5LCBhIGJ1bmNoIG9mIHRyYW5zbGF0aW9ucyB3YXMgcmVxdWVzdGVkLlxuICAgICAgICAvLyBUaGUgcmVzdWx0IGlzIGFuIG9iamVjdC5cbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheSh0cmFuc2xhdGlvbklkKSkge1xuICAgICAgICAgIHZhciByZXN1bHRzID0ge307XG4gICAgICAgICAgZm9yICh2YXIgaSA9IDAsIGMgPSB0cmFuc2xhdGlvbklkLmxlbmd0aDsgaSA8IGM7IGkrKykge1xuICAgICAgICAgICAgcmVzdWx0c1t0cmFuc2xhdGlvbklkW2ldXSA9ICR0cmFuc2xhdGUuaW5zdGFudCh0cmFuc2xhdGlvbklkW2ldLCBpbnRlcnBvbGF0ZVBhcmFtcywgaW50ZXJwb2xhdGlvbklkKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIHJlc3VsdHM7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBXZSBkaXNjYXJkZWQgdW5hY2NlcHRhYmxlIHZhbHVlcy4gU28gd2UganVzdCBuZWVkIHRvIHZlcmlmeSBpZiB0cmFuc2xhdGlvbklkIGlzIGVtcHR5IFN0cmluZ1xuICAgICAgICBpZiAoYW5ndWxhci5pc1N0cmluZyh0cmFuc2xhdGlvbklkKSAmJiB0cmFuc2xhdGlvbklkLmxlbmd0aCA8IDEpIHtcbiAgICAgICAgICByZXR1cm4gdHJhbnNsYXRpb25JZDtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIHRyaW0gb2ZmIGFueSB3aGl0ZXNwYWNlXG4gICAgICAgIGlmICh0cmFuc2xhdGlvbklkKSB7XG4gICAgICAgICAgdHJhbnNsYXRpb25JZCA9IHRyaW0uYXBwbHkodHJhbnNsYXRpb25JZCk7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcmVzdWx0LCBwb3NzaWJsZUxhbmdLZXlzID0gW107XG4gICAgICAgIGlmICgkcHJlZmVycmVkTGFuZ3VhZ2UpIHtcbiAgICAgICAgICBwb3NzaWJsZUxhbmdLZXlzLnB1c2goJHByZWZlcnJlZExhbmd1YWdlKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoJHVzZXMpIHtcbiAgICAgICAgICBwb3NzaWJsZUxhbmdLZXlzLnB1c2goJHVzZXMpO1xuICAgICAgICB9XG4gICAgICAgIGlmICgkZmFsbGJhY2tMYW5ndWFnZSAmJiAkZmFsbGJhY2tMYW5ndWFnZS5sZW5ndGgpIHtcbiAgICAgICAgICBwb3NzaWJsZUxhbmdLZXlzID0gcG9zc2libGVMYW5nS2V5cy5jb25jYXQoJGZhbGxiYWNrTGFuZ3VhZ2UpO1xuICAgICAgICB9XG4gICAgICAgIGZvciAodmFyIGogPSAwLCBkID0gcG9zc2libGVMYW5nS2V5cy5sZW5ndGg7IGogPCBkOyBqKyspIHtcbiAgICAgICAgICB2YXIgcG9zc2libGVMYW5nS2V5ID0gcG9zc2libGVMYW5nS2V5c1tqXTtcbiAgICAgICAgICBpZiAoJHRyYW5zbGF0aW9uVGFibGVbcG9zc2libGVMYW5nS2V5XSkge1xuICAgICAgICAgICAgaWYgKHR5cGVvZiAkdHJhbnNsYXRpb25UYWJsZVtwb3NzaWJsZUxhbmdLZXldW3RyYW5zbGF0aW9uSWRdICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICByZXN1bHQgPSBkZXRlcm1pbmVUcmFuc2xhdGlvbkluc3RhbnQodHJhbnNsYXRpb25JZCwgaW50ZXJwb2xhdGVQYXJhbXMsIGludGVycG9sYXRpb25JZCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCRub3RGb3VuZEluZGljYXRvckxlZnQgfHwgJG5vdEZvdW5kSW5kaWNhdG9yUmlnaHQpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gYXBwbHlOb3RGb3VuZEluZGljYXRvcnModHJhbnNsYXRpb25JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFyZXN1bHQgJiYgcmVzdWx0ICE9PSAnJykge1xuICAgICAgICAgIC8vIFJldHVybiB0cmFuc2xhdGlvbiBvZiBkZWZhdWx0IGludGVycG9sYXRvciBpZiBub3QgZm91bmQgYW55dGhpbmcuXG4gICAgICAgICAgcmVzdWx0ID0gZGVmYXVsdEludGVycG9sYXRvci5pbnRlcnBvbGF0ZSh0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcyk7XG4gICAgICAgICAgaWYgKCRtaXNzaW5nVHJhbnNsYXRpb25IYW5kbGVyRmFjdG9yeSAmJiAhcGVuZGluZ0xvYWRlcikge1xuICAgICAgICAgICAgcmVzdWx0ID0gdHJhbnNsYXRlQnlIYW5kbGVyKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgfTtcblxuICAgICAgLyoqXG4gICAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZSN2ZXJzaW9uSW5mb1xuICAgICAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVxuICAgICAgICpcbiAgICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAgICogUmV0dXJucyB0aGUgY3VycmVudCB2ZXJzaW9uIGluZm9ybWF0aW9uIGZvciB0aGUgYW5ndWxhci10cmFuc2xhdGUgbGlicmFyeVxuICAgICAgICpcbiAgICAgICAqIEByZXR1cm4ge3N0cmluZ30gYW5ndWxhci10cmFuc2xhdGUgdmVyc2lvblxuICAgICAgICovXG4gICAgICAkdHJhbnNsYXRlLnZlcnNpb25JbmZvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdmVyc2lvbjtcbiAgICAgIH07XG5cbiAgICAgIC8qKlxuICAgICAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAgICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGUjbG9hZGVyQ2FjaGVcbiAgICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVcbiAgICAgICAqXG4gICAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgICAqIFJldHVybnMgdGhlIGRlZmluZWQgbG9hZGVyQ2FjaGUuXG4gICAgICAgKlxuICAgICAgICogQHJldHVybiB7Ym9vbGVhbnxzdHJpbmd8b2JqZWN0fSBjdXJyZW50IHZhbHVlIG9mIGxvYWRlckNhY2hlXG4gICAgICAgKi9cbiAgICAgICR0cmFuc2xhdGUubG9hZGVyQ2FjaGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiBsb2FkZXJDYWNoZTtcbiAgICAgIH07XG5cbiAgICAgIC8vIGludGVybmFsIHB1cnBvc2Ugb25seVxuICAgICAgJHRyYW5zbGF0ZS5kaXJlY3RpdmVQcmlvcml0eSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGl2ZVByaW9yaXR5O1xuICAgICAgfTtcblxuICAgICAgLy8gaW50ZXJuYWwgcHVycG9zZSBvbmx5XG4gICAgICAkdHJhbnNsYXRlLnN0YXRlZnVsRmlsdGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gc3RhdGVmdWxGaWx0ZXI7XG4gICAgICB9O1xuXG4gICAgICBpZiAoJGxvYWRlckZhY3RvcnkpIHtcblxuICAgICAgICAvLyBJZiBhdCBsZWFzdCBvbmUgYXN5bmMgbG9hZGVyIGlzIGRlZmluZWQgYW5kIHRoZXJlIGFyZSBub1xuICAgICAgICAvLyAoZGVmYXVsdCkgdHJhbnNsYXRpb25zIGF2YWlsYWJsZSB3ZSBzaG91bGQgdHJ5IHRvIGxvYWQgdGhlbS5cbiAgICAgICAgaWYgKGFuZ3VsYXIuZXF1YWxzKCR0cmFuc2xhdGlvblRhYmxlLCB7fSkpIHtcbiAgICAgICAgICAkdHJhbnNsYXRlLnVzZSgkdHJhbnNsYXRlLnVzZSgpKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEFsc28sIGlmIHRoZXJlIGFyZSBhbnkgZmFsbGJhY2sgbGFuZ3VhZ2UgcmVnaXN0ZXJlZCwgd2Ugc3RhcnRcbiAgICAgICAgLy8gbG9hZGluZyB0aGVtIGFzeW5jaHJvbm91c2x5IGFzIHNvb24gYXMgd2UgY2FuLlxuICAgICAgICBpZiAoJGZhbGxiYWNrTGFuZ3VhZ2UgJiYgJGZhbGxiYWNrTGFuZ3VhZ2UubGVuZ3RoKSB7XG4gICAgICAgICAgdmFyIHByb2Nlc3NBc3luY1Jlc3VsdCA9IGZ1bmN0aW9uICh0cmFuc2xhdGlvbikge1xuICAgICAgICAgICAgdHJhbnNsYXRpb25zKHRyYW5zbGF0aW9uLmtleSwgdHJhbnNsYXRpb24udGFibGUpO1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZUNoYW5nZUVuZCcsIHsgbGFuZ3VhZ2U6IHRyYW5zbGF0aW9uLmtleSB9KTtcbiAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGlvbjtcbiAgICAgICAgICB9O1xuICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBsZW4gPSAkZmFsbGJhY2tMYW5ndWFnZS5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgICAgICAgdmFyIGZhbGxiYWNrTGFuZ3VhZ2VJZCA9ICRmYWxsYmFja0xhbmd1YWdlW2ldO1xuICAgICAgICAgICAgaWYgKCEkdHJhbnNsYXRpb25UYWJsZVtmYWxsYmFja0xhbmd1YWdlSWRdKSB7XG4gICAgICAgICAgICAgIGxhbmdQcm9taXNlc1tmYWxsYmFja0xhbmd1YWdlSWRdID0gbG9hZEFzeW5jKGZhbGxiYWNrTGFuZ3VhZ2VJZCkudGhlbihwcm9jZXNzQXN5bmNSZXN1bHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gJHRyYW5zbGF0ZTtcbiAgICB9XG4gIF07XG59XSk7XG5cbi8qKlxuICogQG5nZG9jIG9iamVjdFxuICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlRGVmYXVsdEludGVycG9sYXRpb25cbiAqIEByZXF1aXJlcyAkaW50ZXJwb2xhdGVcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFVzZXMgYW5ndWxhcidzIGAkaW50ZXJwb2xhdGVgIHNlcnZpY2VzIHRvIGludGVycG9sYXRlIHN0cmluZ3MgYWdhaW5zdCBzb21lIHZhbHVlcy5cbiAqXG4gKiBAcmV0dXJuIHtvYmplY3R9ICR0cmFuc2xhdGVJbnRlcnBvbGF0b3IgSW50ZXJwb2xhdG9yIHNlcnZpY2VcbiAqL1xuYW5ndWxhci5tb2R1bGUoJ3Bhc2NhbHByZWNodC50cmFuc2xhdGUnKS5mYWN0b3J5KCckdHJhbnNsYXRlRGVmYXVsdEludGVycG9sYXRpb24nLCBbJyRpbnRlcnBvbGF0ZScsIGZ1bmN0aW9uICgkaW50ZXJwb2xhdGUpIHtcblxuICB2YXIgJHRyYW5zbGF0ZUludGVycG9sYXRvciA9IHt9LFxuICAgICAgJGxvY2FsZSxcbiAgICAgICRpZGVudGlmaWVyID0gJ2RlZmF1bHQnLFxuICAgICAgJHNhbml0aXplVmFsdWVTdHJhdGVneSA9IG51bGwsXG4gICAgICAvLyBtYXAgb2YgYWxsIHNhbml0aXplIHN0cmF0ZWdpZXNcbiAgICAgIHNhbml0aXplVmFsdWVTdHJhdGVnaWVzID0ge1xuICAgICAgICBlc2NhcGVkOiBmdW5jdGlvbiAocGFyYW1zKSB7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IHt9O1xuICAgICAgICAgIGZvciAodmFyIGtleSBpbiBwYXJhbXMpIHtcbiAgICAgICAgICAgIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocGFyYW1zLCBrZXkpKSB7XG4gICAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzTnVtYmVyKHBhcmFtc1trZXldKSkge1xuICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gcGFyYW1zW2tleV07XG4gICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBhbmd1bGFyLmVsZW1lbnQoJzxkaXY+PC9kaXY+JykudGV4dChwYXJhbXNba2V5XSkuaHRtbCgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgICAgIH1cbiAgICAgIH07XG5cbiAgdmFyIHNhbml0aXplUGFyYW1zID0gZnVuY3Rpb24gKHBhcmFtcykge1xuICAgIHZhciByZXN1bHQ7XG4gICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihzYW5pdGl6ZVZhbHVlU3RyYXRlZ2llc1skc2FuaXRpemVWYWx1ZVN0cmF0ZWd5XSkpIHtcbiAgICAgIHJlc3VsdCA9IHNhbml0aXplVmFsdWVTdHJhdGVnaWVzWyRzYW5pdGl6ZVZhbHVlU3RyYXRlZ3ldKHBhcmFtcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdCA9IHBhcmFtcztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfTtcblxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZURlZmF1bHRJbnRlcnBvbGF0aW9uI3NldExvY2FsZVxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlRGVmYXVsdEludGVycG9sYXRpb25cbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIFNldHMgY3VycmVudCBsb2NhbGUgKHRoaXMgaXMgY3VycmVudGx5IG5vdCB1c2UgaW4gdGhpcyBpbnRlcnBvbGF0aW9uKS5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IGxvY2FsZSBMYW5ndWFnZSBrZXkgb3IgbG9jYWxlLlxuICAgKi9cbiAgJHRyYW5zbGF0ZUludGVycG9sYXRvci5zZXRMb2NhbGUgPSBmdW5jdGlvbiAobG9jYWxlKSB7XG4gICAgJGxvY2FsZSA9IGxvY2FsZTtcbiAgfTtcblxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZURlZmF1bHRJbnRlcnBvbGF0aW9uI2dldEludGVycG9sYXRpb25JZGVudGlmaWVyXG4gICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVEZWZhdWx0SW50ZXJwb2xhdGlvblxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUmV0dXJucyBhbiBpZGVudGlmaWVyIGZvciB0aGlzIGludGVycG9sYXRpb24gc2VydmljZS5cbiAgICpcbiAgICogQHJldHVybnMge3N0cmluZ30gJGlkZW50aWZpZXJcbiAgICovXG4gICR0cmFuc2xhdGVJbnRlcnBvbGF0b3IuZ2V0SW50ZXJwb2xhdGlvbklkZW50aWZpZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuICRpZGVudGlmaWVyO1xuICB9O1xuXG4gICR0cmFuc2xhdGVJbnRlcnBvbGF0b3IudXNlU2FuaXRpemVWYWx1ZVN0cmF0ZWd5ID0gZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgJHNhbml0aXplVmFsdWVTdHJhdGVneSA9IHZhbHVlO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIC8qKlxuICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlRGVmYXVsdEludGVycG9sYXRpb24jaW50ZXJwb2xhdGVcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZURlZmF1bHRJbnRlcnBvbGF0aW9uXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBJbnRlcnBvbGF0ZXMgZ2l2ZW4gc3RyaW5nIGFnYWlucyBnaXZlbiBpbnRlcnBvbGF0ZSBwYXJhbXMgdXNpbmcgYW5ndWxhcnNcbiAgICogYCRpbnRlcnBvbGF0ZWAgc2VydmljZS5cbiAgICpcbiAgICogQHJldHVybnMge3N0cmluZ30gaW50ZXJwb2xhdGVkIHN0cmluZy5cbiAgICovXG4gICR0cmFuc2xhdGVJbnRlcnBvbGF0b3IuaW50ZXJwb2xhdGUgPSBmdW5jdGlvbiAoc3RyaW5nLCBpbnRlcnBvbGF0ZVBhcmFtcykge1xuICAgIGlmICgkc2FuaXRpemVWYWx1ZVN0cmF0ZWd5KSB7XG4gICAgICBpbnRlcnBvbGF0ZVBhcmFtcyA9IHNhbml0aXplUGFyYW1zKGludGVycG9sYXRlUGFyYW1zKTtcbiAgICB9XG4gICAgcmV0dXJuICRpbnRlcnBvbGF0ZShzdHJpbmcpKGludGVycG9sYXRlUGFyYW1zIHx8IHt9KTtcbiAgfTtcblxuICByZXR1cm4gJHRyYW5zbGF0ZUludGVycG9sYXRvcjtcbn1dKTtcblxuYW5ndWxhci5tb2R1bGUoJ3Bhc2NhbHByZWNodC50cmFuc2xhdGUnKS5jb25zdGFudCgnJFNUT1JBR0VfS0VZJywgJ05HX1RSQU5TTEFURV9MQU5HX0tFWScpO1xuXG5hbmd1bGFyLm1vZHVsZSgncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScpXG4vKipcbiAqIEBuZ2RvYyBkaXJlY3RpdmVcbiAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuZGlyZWN0aXZlOnRyYW5zbGF0ZVxuICogQHJlcXVpcmVzICRjb21waWxlXG4gKiBAcmVxdWlyZXMgJGZpbHRlclxuICogQHJlcXVpcmVzICRpbnRlcnBvbGF0ZVxuICogQHJlc3RyaWN0IEFcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIFRyYW5zbGF0ZXMgZ2l2ZW4gdHJhbnNsYXRpb24gaWQgZWl0aGVyIHRocm91Z2ggYXR0cmlidXRlIG9yIERPTSBjb250ZW50LlxuICogSW50ZXJuYWxseSBpdCB1c2VzIGB0cmFuc2xhdGVgIGZpbHRlciB0byB0cmFuc2xhdGUgdHJhbnNsYXRpb24gaWQuIEl0IHBvc3NpYmxlIHRvXG4gKiBwYXNzIGFuIG9wdGlvbmFsIGB0cmFuc2xhdGUtdmFsdWVzYCBvYmplY3QgbGl0ZXJhbCBhcyBzdHJpbmcgaW50byB0cmFuc2xhdGlvbiBpZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZz19IHRyYW5zbGF0ZSBUcmFuc2xhdGlvbiBpZCB3aGljaCBjb3VsZCBiZSBlaXRoZXIgc3RyaW5nIG9yIGludGVycG9sYXRlZCBzdHJpbmcuXG4gKiBAcGFyYW0ge3N0cmluZz19IHRyYW5zbGF0ZS12YWx1ZXMgVmFsdWVzIHRvIHBhc3MgaW50byB0cmFuc2xhdGlvbiBpZC4gQ2FuIGJlIHBhc3NlZCBhcyBvYmplY3QgbGl0ZXJhbCBzdHJpbmcgb3IgaW50ZXJwb2xhdGVkIG9iamVjdC5cbiAqIEBwYXJhbSB7c3RyaW5nPX0gdHJhbnNsYXRlLWF0dHItQVRUUiB0cmFuc2xhdGUgVHJhbnNsYXRpb24gaWQgYW5kIHB1dCBpdCBpbnRvIEFUVFIgYXR0cmlidXRlLlxuICogQHBhcmFtIHtzdHJpbmc9fSB0cmFuc2xhdGUtZGVmYXVsdCB3aWxsIGJlIHVzZWQgdW5sZXNzIHRyYW5zbGF0aW9uIHdhcyBzdWNjZXNzZnVsXG4gKiBAcGFyYW0ge2Jvb2xlYW49fSB0cmFuc2xhdGUtY29tcGlsZSAoZGVmYXVsdCB0cnVlIGlmIHByZXNlbnQpIGRlZmluZXMgbG9jYWxseSBhY3RpdmF0aW9uIG9mIHtAbGluayBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGUjdXNlUG9zdENvbXBpbGluZ31cbiAqXG4gKiBAZXhhbXBsZVxuICAgPGV4YW1wbGUgbW9kdWxlPVwibmdWaWV3XCI+XG4gICAgPGZpbGUgbmFtZT1cImluZGV4Lmh0bWxcIj5cbiAgICAgIDxkaXYgbmctY29udHJvbGxlcj1cIlRyYW5zbGF0ZUN0cmxcIj5cblxuICAgICAgICA8cHJlIHRyYW5zbGF0ZT1cIlRSQU5TTEFUSU9OX0lEXCI+PC9wcmU+XG4gICAgICAgIDxwcmUgdHJhbnNsYXRlPlRSQU5TTEFUSU9OX0lEPC9wcmU+XG4gICAgICAgIDxwcmUgdHJhbnNsYXRlIHRyYW5zbGF0ZS1hdHRyLXRpdGxlPVwiVFJBTlNMQVRJT05fSURcIj48L3ByZT5cbiAgICAgICAgPHByZSB0cmFuc2xhdGU9XCJ7e3RyYW5zbGF0aW9uSWR9fVwiPjwvcHJlPlxuICAgICAgICA8cHJlIHRyYW5zbGF0ZT57e3RyYW5zbGF0aW9uSWR9fTwvcHJlPlxuICAgICAgICA8cHJlIHRyYW5zbGF0ZT1cIldJVEhfVkFMVUVTXCIgdHJhbnNsYXRlLXZhbHVlcz1cInt2YWx1ZTogNX1cIj48L3ByZT5cbiAgICAgICAgPHByZSB0cmFuc2xhdGUgdHJhbnNsYXRlLXZhbHVlcz1cInt2YWx1ZTogNX1cIj5XSVRIX1ZBTFVFUzwvcHJlPlxuICAgICAgICA8cHJlIHRyYW5zbGF0ZT1cIldJVEhfVkFMVUVTXCIgdHJhbnNsYXRlLXZhbHVlcz1cInt7dmFsdWVzfX1cIj48L3ByZT5cbiAgICAgICAgPHByZSB0cmFuc2xhdGUgdHJhbnNsYXRlLXZhbHVlcz1cInt7dmFsdWVzfX1cIj5XSVRIX1ZBTFVFUzwvcHJlPlxuICAgICAgICA8cHJlIHRyYW5zbGF0ZSB0cmFuc2xhdGUtYXR0ci10aXRsZT1cIldJVEhfVkFMVUVTXCIgdHJhbnNsYXRlLXZhbHVlcz1cInt7dmFsdWVzfX1cIj48L3ByZT5cblxuICAgICAgPC9kaXY+XG4gICAgPC9maWxlPlxuICAgIDxmaWxlIG5hbWU9XCJzY3JpcHQuanNcIj5cbiAgICAgIGFuZ3VsYXIubW9kdWxlKCduZ1ZpZXcnLCBbJ3Bhc2NhbHByZWNodC50cmFuc2xhdGUnXSlcblxuICAgICAgLmNvbmZpZyhmdW5jdGlvbiAoJHRyYW5zbGF0ZVByb3ZpZGVyKSB7XG5cbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnRyYW5zbGF0aW9ucygnZW4nLHtcbiAgICAgICAgICAnVFJBTlNMQVRJT05fSUQnOiAnSGVsbG8gdGhlcmUhJyxcbiAgICAgICAgICAnV0lUSF9WQUxVRVMnOiAnVGhlIGZvbGxvd2luZyB2YWx1ZSBpcyBkeW5hbWljOiB7e3ZhbHVlfX0nXG4gICAgICAgIH0pLnByZWZlcnJlZExhbmd1YWdlKCdlbicpO1xuXG4gICAgICB9KTtcblxuICAgICAgYW5ndWxhci5tb2R1bGUoJ25nVmlldycpLmNvbnRyb2xsZXIoJ1RyYW5zbGF0ZUN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS50cmFuc2xhdGlvbklkID0gJ1RSQU5TTEFUSU9OX0lEJztcblxuICAgICAgICAkc2NvcGUudmFsdWVzID0ge1xuICAgICAgICAgIHZhbHVlOiA3OFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgPC9maWxlPlxuICAgIDxmaWxlIG5hbWU9XCJzY2VuYXJpby5qc1wiPlxuICAgICAgaXQoJ3Nob3VsZCB0cmFuc2xhdGUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGluamVjdChmdW5jdGlvbiAoJHJvb3RTY29wZSwgJGNvbXBpbGUpIHtcbiAgICAgICAgICAkcm9vdFNjb3BlLnRyYW5zbGF0aW9uSWQgPSAnVFJBTlNMQVRJT05fSUQnO1xuXG4gICAgICAgICAgZWxlbWVudCA9ICRjb21waWxlKCc8cCB0cmFuc2xhdGU9XCJUUkFOU0xBVElPTl9JRFwiPjwvcD4nKSgkcm9vdFNjb3BlKTtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgICBleHBlY3QoZWxlbWVudC50ZXh0KCkpLnRvQmUoJ0hlbGxvIHRoZXJlIScpO1xuXG4gICAgICAgICAgZWxlbWVudCA9ICRjb21waWxlKCc8cCB0cmFuc2xhdGU9XCJ7e3RyYW5zbGF0aW9uSWR9fVwiPjwvcD4nKSgkcm9vdFNjb3BlKTtcbiAgICAgICAgICAkcm9vdFNjb3BlLiRkaWdlc3QoKTtcbiAgICAgICAgICBleHBlY3QoZWxlbWVudC50ZXh0KCkpLnRvQmUoJ0hlbGxvIHRoZXJlIScpO1xuXG4gICAgICAgICAgZWxlbWVudCA9ICRjb21waWxlKCc8cCB0cmFuc2xhdGU+VFJBTlNMQVRJT05fSUQ8L3A+JykoJHJvb3RTY29wZSk7XG4gICAgICAgICAgJHJvb3RTY29wZS4kZGlnZXN0KCk7XG4gICAgICAgICAgZXhwZWN0KGVsZW1lbnQudGV4dCgpKS50b0JlKCdIZWxsbyB0aGVyZSEnKTtcblxuICAgICAgICAgIGVsZW1lbnQgPSAkY29tcGlsZSgnPHAgdHJhbnNsYXRlPnt7dHJhbnNsYXRpb25JZH19PC9wPicpKCRyb290U2NvcGUpO1xuICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgIGV4cGVjdChlbGVtZW50LnRleHQoKSkudG9CZSgnSGVsbG8gdGhlcmUhJyk7XG5cbiAgICAgICAgICBlbGVtZW50ID0gJGNvbXBpbGUoJzxwIHRyYW5zbGF0ZSB0cmFuc2xhdGUtYXR0ci10aXRsZT1cIlRSQU5TTEFUSU9OX0lEXCI+PC9wPicpKCRyb290U2NvcGUpO1xuICAgICAgICAgICRyb290U2NvcGUuJGRpZ2VzdCgpO1xuICAgICAgICAgIGV4cGVjdChlbGVtZW50LmF0dHIoJ3RpdGxlJykpLnRvQmUoJ0hlbGxvIHRoZXJlIScpO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIDwvZmlsZT5cbiAgIDwvZXhhbXBsZT5cbiAqL1xuLmRpcmVjdGl2ZSgndHJhbnNsYXRlJywgWyckdHJhbnNsYXRlJywgJyRxJywgJyRpbnRlcnBvbGF0ZScsICckY29tcGlsZScsICckcGFyc2UnLCAnJHJvb3RTY29wZScsIGZ1bmN0aW9uICgkdHJhbnNsYXRlLCAkcSwgJGludGVycG9sYXRlLCAkY29tcGlsZSwgJHBhcnNlLCAkcm9vdFNjb3BlKSB7XG5cbiAgLyoqXG4gICAqIEBuYW1lIHRyaW1cbiAgICogQHByaXZhdGVcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqIHRyaW0gcG9seWZpbGxcbiAgICpcbiAgICogQHJldHVybnMge3N0cmluZ30gVGhlIHN0cmluZyBzdHJpcHBlZCBvZiB3aGl0ZXNwYWNlIGZyb20gYm90aCBlbmRzXG4gICAqL1xuICB2YXIgdHJpbSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnJlcGxhY2UoL15cXHMrfFxccyskL2csICcnKTtcbiAgfTtcblxuICByZXR1cm4ge1xuICAgIHJlc3RyaWN0OiAnQUUnLFxuICAgIHNjb3BlOiB0cnVlLFxuICAgIHByaW9yaXR5OiAkdHJhbnNsYXRlLmRpcmVjdGl2ZVByaW9yaXR5KCksXG4gICAgY29tcGlsZTogZnVuY3Rpb24gKHRFbGVtZW50LCB0QXR0cikge1xuXG4gICAgICB2YXIgdHJhbnNsYXRlVmFsdWVzRXhpc3QgPSAodEF0dHIudHJhbnNsYXRlVmFsdWVzKSA/XG4gICAgICAgIHRBdHRyLnRyYW5zbGF0ZVZhbHVlcyA6IHVuZGVmaW5lZDtcblxuICAgICAgdmFyIHRyYW5zbGF0ZUludGVycG9sYXRpb24gPSAodEF0dHIudHJhbnNsYXRlSW50ZXJwb2xhdGlvbikgP1xuICAgICAgICB0QXR0ci50cmFuc2xhdGVJbnRlcnBvbGF0aW9uIDogdW5kZWZpbmVkO1xuXG4gICAgICB2YXIgdHJhbnNsYXRlVmFsdWVFeGlzdCA9IHRFbGVtZW50WzBdLm91dGVySFRNTC5tYXRjaCgvdHJhbnNsYXRlLXZhbHVlLSsvaSk7XG5cbiAgICAgIHZhciBpbnRlcnBvbGF0ZVJlZ0V4cCA9ICdeKC4qKSgnICsgJGludGVycG9sYXRlLnN0YXJ0U3ltYm9sKCkgKyAnLionICsgJGludGVycG9sYXRlLmVuZFN5bWJvbCgpICsgJykoLiopJyxcbiAgICAgICAgICB3YXRjaGVyUmVnRXhwID0gJ14oLiopJyArICRpbnRlcnBvbGF0ZS5zdGFydFN5bWJvbCgpICsgJyguKiknICsgJGludGVycG9sYXRlLmVuZFN5bWJvbCgpICsgJyguKiknO1xuXG4gICAgICByZXR1cm4gZnVuY3Rpb24gbGlua0ZuKHNjb3BlLCBpRWxlbWVudCwgaUF0dHIpIHtcblxuICAgICAgICBzY29wZS5pbnRlcnBvbGF0ZVBhcmFtcyA9IHt9O1xuICAgICAgICBzY29wZS5wcmVUZXh0ID0gJyc7XG4gICAgICAgIHNjb3BlLnBvc3RUZXh0ID0gJyc7XG4gICAgICAgIHZhciB0cmFuc2xhdGlvbklkcyA9IHt9O1xuXG4gICAgICAgIC8vIGluaXRpYWwgc2V0dXBcbiAgICAgICAgaWYgKGlBdHRyLnRyYW5zbGF0ZVZhbHVlcykge1xuICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKHNjb3BlLmludGVycG9sYXRlUGFyYW1zLCAkcGFyc2UoaUF0dHIudHJhbnNsYXRlVmFsdWVzKShzY29wZS4kcGFyZW50KSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBFbnN1cmVzIGFueSBjaGFuZ2Ugb2YgdGhlIGF0dHJpYnV0ZSBcInRyYW5zbGF0ZVwiIGNvbnRhaW5pbmcgdGhlIGlkIHdpbGxcbiAgICAgICAgLy8gYmUgcmUtc3RvcmVkIHRvIHRoZSBzY29wZSdzIFwidHJhbnNsYXRpb25JZFwiLlxuICAgICAgICAvLyBJZiB0aGUgYXR0cmlidXRlIGhhcyBubyBjb250ZW50LCB0aGUgZWxlbWVudCdzIHRleHQgdmFsdWUgKHdoaXRlIHNwYWNlcyB0cmltbWVkIG9mZikgd2lsbCBiZSB1c2VkLlxuICAgICAgICB2YXIgb2JzZXJ2ZUVsZW1lbnRUcmFuc2xhdGlvbiA9IGZ1bmN0aW9uICh0cmFuc2xhdGlvbklkKSB7XG5cbiAgICAgICAgICAvLyBSZW1vdmUgYW55IG9sZCB3YXRjaGVyXG4gICAgICAgICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbihvYnNlcnZlRWxlbWVudFRyYW5zbGF0aW9uLl91bndhdGNoT2xkKSkge1xuICAgICAgICAgICAgb2JzZXJ2ZUVsZW1lbnRUcmFuc2xhdGlvbi5fdW53YXRjaE9sZCgpO1xuICAgICAgICAgICAgb2JzZXJ2ZUVsZW1lbnRUcmFuc2xhdGlvbi5fdW53YXRjaE9sZCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoYW5ndWxhci5lcXVhbHModHJhbnNsYXRpb25JZCAsICcnKSB8fCAhYW5ndWxhci5pc0RlZmluZWQodHJhbnNsYXRpb25JZCkpIHtcbiAgICAgICAgICAgIC8vIGluaXRpYWxseSBmZXRjaCBhbGwgYXR0cmlidXRlcyBpZiBleGlzdGluZyBhbmQgZmlsbCB0aGUgcGFyYW1zXG4gICAgICAgICAgICBpZiAodHJhbnNsYXRlVmFsdWVFeGlzdCkge1xuICAgICAgICAgICAgICBmb3IgKHZhciBhdHRyIGluIHRBdHRyKSB7XG4gICAgICAgICAgICAgICAgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChpQXR0ciwgYXR0cikgJiYgYXR0ci5zdWJzdHIoMCwgMTQpID09PSAndHJhbnNsYXRlVmFsdWUnICYmIGF0dHIgIT09ICd0cmFuc2xhdGVWYWx1ZXMnKSB7XG4gICAgICAgICAgICAgICAgICB2YXIgYXR0cmlidXRlTmFtZSA9IGFuZ3VsYXIubG93ZXJjYXNlKGF0dHIuc3Vic3RyKDE0LCAxKSkgKyBhdHRyLnN1YnN0cigxNSk7XG4gICAgICAgICAgICAgICAgICBzY29wZS5pbnRlcnBvbGF0ZVBhcmFtc1thdHRyaWJ1dGVOYW1lXSA9IHRBdHRyW2F0dHJdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBSZXNvbHZlIHRyYW5zbGF0aW9uIGlkIGJ5IGlubmVyIGh0bWwgaWYgcmVxdWlyZWRcbiAgICAgICAgICAgIHZhciBpbnRlcnBvbGF0ZU1hdGNoZXMgPSB0cmltLmFwcGx5KGlFbGVtZW50LnRleHQoKSkubWF0Y2goaW50ZXJwb2xhdGVSZWdFeHApO1xuICAgICAgICAgICAgLy8gSW50ZXJwb2xhdGUgdHJhbnNsYXRpb24gaWQgaWYgcmVxdWlyZWRcbiAgICAgICAgICAgIGlmIChhbmd1bGFyLmlzQXJyYXkoaW50ZXJwb2xhdGVNYXRjaGVzKSkge1xuICAgICAgICAgICAgICBzY29wZS5wcmVUZXh0ID0gaW50ZXJwb2xhdGVNYXRjaGVzWzFdO1xuICAgICAgICAgICAgICBzY29wZS5wb3N0VGV4dCA9IGludGVycG9sYXRlTWF0Y2hlc1szXTtcbiAgICAgICAgICAgICAgdHJhbnNsYXRpb25JZHMudHJhbnNsYXRlID0gJGludGVycG9sYXRlKGludGVycG9sYXRlTWF0Y2hlc1syXSkoc2NvcGUuJHBhcmVudCk7XG4gICAgICAgICAgICAgIHZhciB3YXRjaGVyTWF0Y2hlcyA9IGlFbGVtZW50LnRleHQoKS5tYXRjaCh3YXRjaGVyUmVnRXhwKTtcbiAgICAgICAgICAgICAgaWYgKGFuZ3VsYXIuaXNBcnJheSh3YXRjaGVyTWF0Y2hlcykgJiYgd2F0Y2hlck1hdGNoZXNbMl0gJiYgd2F0Y2hlck1hdGNoZXNbMl0ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgb2JzZXJ2ZUVsZW1lbnRUcmFuc2xhdGlvbi5fdW53YXRjaE9sZCA9IHNjb3BlLiR3YXRjaCh3YXRjaGVyTWF0Y2hlc1syXSwgZnVuY3Rpb24gKG5ld1ZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICB0cmFuc2xhdGlvbklkcy50cmFuc2xhdGUgPSBuZXdWYWx1ZTtcbiAgICAgICAgICAgICAgICAgIHVwZGF0ZVRyYW5zbGF0aW9ucygpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICB0cmFuc2xhdGlvbklkcy50cmFuc2xhdGUgPSBpRWxlbWVudC50ZXh0KCkucmVwbGFjZSgvXlxccyt8XFxzKyQvZywnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRyYW5zbGF0aW9uSWRzLnRyYW5zbGF0ZSA9IHRyYW5zbGF0aW9uSWQ7XG4gICAgICAgICAgfVxuICAgICAgICAgIHVwZGF0ZVRyYW5zbGF0aW9ucygpO1xuICAgICAgICB9O1xuXG4gICAgICAgIHZhciBvYnNlcnZlQXR0cmlidXRlVHJhbnNsYXRpb24gPSBmdW5jdGlvbiAodHJhbnNsYXRlQXR0cikge1xuICAgICAgICAgIGlBdHRyLiRvYnNlcnZlKHRyYW5zbGF0ZUF0dHIsIGZ1bmN0aW9uICh0cmFuc2xhdGlvbklkKSB7XG4gICAgICAgICAgICB0cmFuc2xhdGlvbklkc1t0cmFuc2xhdGVBdHRyXSA9IHRyYW5zbGF0aW9uSWQ7XG4gICAgICAgICAgICB1cGRhdGVUcmFuc2xhdGlvbnMoKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgZmlyc3RBdHRyaWJ1dGVDaGFuZ2VkRXZlbnQgPSB0cnVlO1xuICAgICAgICBpQXR0ci4kb2JzZXJ2ZSgndHJhbnNsYXRlJywgZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQpIHtcbiAgICAgICAgICBpZiAodHlwZW9mIHRyYW5zbGF0aW9uSWQgPT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAvLyBjYXNlIG9mIGVsZW1lbnQgXCI8dHJhbnNsYXRlPnh5ejwvdHJhbnNsYXRlPlwiXG4gICAgICAgICAgICBvYnNlcnZlRWxlbWVudFRyYW5zbGF0aW9uKCcnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgLy8gY2FzZSBvZiByZWd1bGFyIGF0dHJpYnV0ZVxuICAgICAgICAgICAgaWYgKHRyYW5zbGF0aW9uSWQgIT09ICcnIHx8ICFmaXJzdEF0dHJpYnV0ZUNoYW5nZWRFdmVudCkge1xuICAgICAgICAgICAgICB0cmFuc2xhdGlvbklkcy50cmFuc2xhdGUgPSB0cmFuc2xhdGlvbklkO1xuICAgICAgICAgICAgICB1cGRhdGVUcmFuc2xhdGlvbnMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgICAgZmlyc3RBdHRyaWJ1dGVDaGFuZ2VkRXZlbnQgPSBmYWxzZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgZm9yICh2YXIgdHJhbnNsYXRlQXR0ciBpbiBpQXR0cikge1xuICAgICAgICAgIGlmIChpQXR0ci5oYXNPd25Qcm9wZXJ0eSh0cmFuc2xhdGVBdHRyKSAmJiB0cmFuc2xhdGVBdHRyLnN1YnN0cigwLCAxMykgPT09ICd0cmFuc2xhdGVBdHRyJykge1xuICAgICAgICAgICAgb2JzZXJ2ZUF0dHJpYnV0ZVRyYW5zbGF0aW9uKHRyYW5zbGF0ZUF0dHIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGlBdHRyLiRvYnNlcnZlKCd0cmFuc2xhdGVEZWZhdWx0JywgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgc2NvcGUuZGVmYXVsdFRleHQgPSB2YWx1ZTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKHRyYW5zbGF0ZVZhbHVlc0V4aXN0KSB7XG4gICAgICAgICAgaUF0dHIuJG9ic2VydmUoJ3RyYW5zbGF0ZVZhbHVlcycsIGZ1bmN0aW9uIChpbnRlcnBvbGF0ZVBhcmFtcykge1xuICAgICAgICAgICAgaWYgKGludGVycG9sYXRlUGFyYW1zKSB7XG4gICAgICAgICAgICAgIHNjb3BlLiRwYXJlbnQuJHdhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChzY29wZS5pbnRlcnBvbGF0ZVBhcmFtcywgJHBhcnNlKGludGVycG9sYXRlUGFyYW1zKShzY29wZS4kcGFyZW50KSk7XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRyYW5zbGF0ZVZhbHVlRXhpc3QpIHtcbiAgICAgICAgICB2YXIgb2JzZXJ2ZVZhbHVlQXR0cmlidXRlID0gZnVuY3Rpb24gKGF0dHJOYW1lKSB7XG4gICAgICAgICAgICBpQXR0ci4kb2JzZXJ2ZShhdHRyTmFtZSwgZnVuY3Rpb24gKHZhbHVlKSB7XG4gICAgICAgICAgICAgIHZhciBhdHRyaWJ1dGVOYW1lID0gYW5ndWxhci5sb3dlcmNhc2UoYXR0ck5hbWUuc3Vic3RyKDE0LCAxKSkgKyBhdHRyTmFtZS5zdWJzdHIoMTUpO1xuICAgICAgICAgICAgICBzY29wZS5pbnRlcnBvbGF0ZVBhcmFtc1thdHRyaWJ1dGVOYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfTtcbiAgICAgICAgICBmb3IgKHZhciBhdHRyIGluIGlBdHRyKSB7XG4gICAgICAgICAgICBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGlBdHRyLCBhdHRyKSAmJiBhdHRyLnN1YnN0cigwLCAxNCkgPT09ICd0cmFuc2xhdGVWYWx1ZScgJiYgYXR0ciAhPT0gJ3RyYW5zbGF0ZVZhbHVlcycpIHtcbiAgICAgICAgICAgICAgb2JzZXJ2ZVZhbHVlQXR0cmlidXRlKGF0dHIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vIE1hc3RlciB1cGRhdGUgZnVuY3Rpb25cbiAgICAgICAgdmFyIHVwZGF0ZVRyYW5zbGF0aW9ucyA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICBmb3IgKHZhciBrZXkgaW4gdHJhbnNsYXRpb25JZHMpIHtcblxuICAgICAgICAgICAgaWYgKHRyYW5zbGF0aW9uSWRzLmhhc093blByb3BlcnR5KGtleSkgJiYgdHJhbnNsYXRpb25JZHNba2V5XSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgIHVwZGF0ZVRyYW5zbGF0aW9uKGtleSwgdHJhbnNsYXRpb25JZHNba2V5XSwgc2NvcGUsIHNjb3BlLmludGVycG9sYXRlUGFyYW1zLCBzY29wZS5kZWZhdWx0VGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIC8vIFB1dCB0cmFuc2xhdGlvbiBwcm9jZXNzaW5nIGZ1bmN0aW9uIG91dHNpZGUgbG9vcFxuICAgICAgICB2YXIgdXBkYXRlVHJhbnNsYXRpb24gPSBmdW5jdGlvbih0cmFuc2xhdGVBdHRyLCB0cmFuc2xhdGlvbklkLCBzY29wZSwgaW50ZXJwb2xhdGVQYXJhbXMsIGRlZmF1bHRUcmFuc2xhdGlvblRleHQpIHtcbiAgICAgICAgICBpZiAodHJhbnNsYXRpb25JZCkge1xuICAgICAgICAgICAgJHRyYW5zbGF0ZSh0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcywgdHJhbnNsYXRlSW50ZXJwb2xhdGlvbiwgZGVmYXVsdFRyYW5zbGF0aW9uVGV4dClcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHRyYW5zbGF0aW9uKSB7XG4gICAgICAgICAgICAgICAgYXBwbHlUcmFuc2xhdGlvbih0cmFuc2xhdGlvbiwgc2NvcGUsIHRydWUsIHRyYW5zbGF0ZUF0dHIpO1xuICAgICAgICAgICAgICB9LCBmdW5jdGlvbiAodHJhbnNsYXRpb25JZCkge1xuICAgICAgICAgICAgICAgIGFwcGx5VHJhbnNsYXRpb24odHJhbnNsYXRpb25JZCwgc2NvcGUsIGZhbHNlLCB0cmFuc2xhdGVBdHRyKTtcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIGFzIGFuIGVtcHR5IHN0cmluZyBjYW5ub3QgYmUgdHJhbnNsYXRlZCwgd2UgY2FuIHNvbHZlIHRoaXMgdXNpbmcgc3VjY2Vzc2Z1bD1mYWxzZVxuICAgICAgICAgICAgYXBwbHlUcmFuc2xhdGlvbih0cmFuc2xhdGlvbklkLCBzY29wZSwgZmFsc2UsIHRyYW5zbGF0ZUF0dHIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgYXBwbHlUcmFuc2xhdGlvbiA9IGZ1bmN0aW9uICh2YWx1ZSwgc2NvcGUsIHN1Y2Nlc3NmdWwsIHRyYW5zbGF0ZUF0dHIpIHtcbiAgICAgICAgICBpZiAodHJhbnNsYXRlQXR0ciA9PT0gJ3RyYW5zbGF0ZScpIHtcbiAgICAgICAgICAgIC8vIGRlZmF1bHQgdHJhbnNsYXRlIGludG8gaW5uZXJIVE1MXG4gICAgICAgICAgICBpZiAoIXN1Y2Nlc3NmdWwgJiYgdHlwZW9mIHNjb3BlLmRlZmF1bHRUZXh0ICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICB2YWx1ZSA9IHNjb3BlLmRlZmF1bHRUZXh0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaUVsZW1lbnQuaHRtbChzY29wZS5wcmVUZXh0ICsgdmFsdWUgKyBzY29wZS5wb3N0VGV4dCk7XG4gICAgICAgICAgICB2YXIgZ2xvYmFsbHlFbmFibGVkID0gJHRyYW5zbGF0ZS5pc1Bvc3RDb21waWxpbmdFbmFibGVkKCk7XG4gICAgICAgICAgICB2YXIgbG9jYWxseURlZmluZWQgPSB0eXBlb2YgdEF0dHIudHJhbnNsYXRlQ29tcGlsZSAhPT0gJ3VuZGVmaW5lZCc7XG4gICAgICAgICAgICB2YXIgbG9jYWxseUVuYWJsZWQgPSBsb2NhbGx5RGVmaW5lZCAmJiB0QXR0ci50cmFuc2xhdGVDb21waWxlICE9PSAnZmFsc2UnO1xuICAgICAgICAgICAgaWYgKChnbG9iYWxseUVuYWJsZWQgJiYgIWxvY2FsbHlEZWZpbmVkKSB8fCBsb2NhbGx5RW5hYmxlZCkge1xuICAgICAgICAgICAgICAkY29tcGlsZShpRWxlbWVudC5jb250ZW50cygpKShzY29wZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIHRyYW5zbGF0ZSBhdHRyaWJ1dGVcbiAgICAgICAgICAgIGlmICghc3VjY2Vzc2Z1bCAmJiB0eXBlb2Ygc2NvcGUuZGVmYXVsdFRleHQgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgIHZhbHVlID0gc2NvcGUuZGVmYXVsdFRleHQ7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYXR0cmlidXRlTmFtZSA9IGlBdHRyLiRhdHRyW3RyYW5zbGF0ZUF0dHJdO1xuICAgICAgICAgICAgaWYgKGF0dHJpYnV0ZU5hbWUuc3Vic3RyKDAsIDUpID09PSAnZGF0YS0nKSB7XG4gICAgICAgICAgICAgIC8vIGVuc3VyZSBodG1sNSBkYXRhIHByZWZpeCBpcyBzdHJpcHBlZFxuICAgICAgICAgICAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS5zdWJzdHIoNSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhdHRyaWJ1dGVOYW1lID0gYXR0cmlidXRlTmFtZS5zdWJzdHIoMTUpO1xuICAgICAgICAgICAgaUVsZW1lbnQuYXR0cihhdHRyaWJ1dGVOYW1lLCB2YWx1ZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIHNjb3BlLiR3YXRjaCgnaW50ZXJwb2xhdGVQYXJhbXMnLCB1cGRhdGVUcmFuc2xhdGlvbnMsIHRydWUpO1xuXG4gICAgICAgIC8vIEVuc3VyZXMgdGhlIHRleHQgd2lsbCBiZSByZWZyZXNoZWQgYWZ0ZXIgdGhlIGN1cnJlbnQgbGFuZ3VhZ2Ugd2FzIGNoYW5nZWRcbiAgICAgICAgLy8gdy8gJHRyYW5zbGF0ZS51c2UoLi4uKVxuICAgICAgICB2YXIgdW5iaW5kID0gJHJvb3RTY29wZS4kb24oJyR0cmFuc2xhdGVDaGFuZ2VTdWNjZXNzJywgdXBkYXRlVHJhbnNsYXRpb25zKTtcblxuICAgICAgICAvLyBlbnN1cmUgdHJhbnNsYXRpb24gd2lsbCBiZSBsb29rZWQgdXAgYXQgbGVhc3Qgb25lXG4gICAgICAgIGlmIChpRWxlbWVudC50ZXh0KCkubGVuZ3RoKSB7XG4gICAgICAgICAgaWYgKGlBdHRyLnRyYW5zbGF0ZSkge1xuICAgICAgICAgICAgb2JzZXJ2ZUVsZW1lbnRUcmFuc2xhdGlvbihpQXR0ci50cmFuc2xhdGUpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvYnNlcnZlRWxlbWVudFRyYW5zbGF0aW9uKCcnKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdXBkYXRlVHJhbnNsYXRpb25zKCk7XG4gICAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCB1bmJpbmQpO1xuICAgICAgfTtcbiAgICB9XG4gIH07XG59XSk7XG5cbmFuZ3VsYXIubW9kdWxlKCdwYXNjYWxwcmVjaHQudHJhbnNsYXRlJylcbi8qKlxuICogQG5nZG9jIGRpcmVjdGl2ZVxuICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS5kaXJlY3RpdmU6dHJhbnNsYXRlQ2xvYWtcbiAqIEByZXF1aXJlcyAkcm9vdFNjb3BlXG4gKiBAcmVxdWlyZXMgJHRyYW5zbGF0ZVxuICogQHJlc3RyaWN0IEFcbiAqXG4gKiAkZGVzY3JpcHRpb25cbiAqIEFkZHMgYSBgdHJhbnNsYXRlLWNsb2FrYCBjbGFzcyBuYW1lIHRvIHRoZSBnaXZlbiBlbGVtZW50IHdoZXJlIHRoaXMgZGlyZWN0aXZlXG4gKiBpcyBhcHBsaWVkIGluaXRpYWxseSBhbmQgcmVtb3ZlcyBpdCwgb25jZSBhIGxvYWRlciBoYXMgZmluaXNoZWQgbG9hZGluZy5cbiAqXG4gKiBUaGlzIGRpcmVjdGl2ZSBjYW4gYmUgdXNlZCB0byBwcmV2ZW50IGluaXRpYWwgZmxpY2tlcmluZyB3aGVuIGxvYWRpbmcgdHJhbnNsYXRpb25cbiAqIGRhdGEgYXN5bmNocm9ub3VzbHkuXG4gKlxuICogVGhlIGNsYXNzIG5hbWUgaXMgZGVmaW5lZCBpblxuICoge0BsaW5rIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVByb3ZpZGVyI2Nsb2FrQ2xhc3NOYW1lICR0cmFuc2xhdGUuY2xvYWtDbGFzc05hbWUoKX0uXG4gKlxuICogQHBhcmFtIHtzdHJpbmc9fSB0cmFuc2xhdGUtY2xvYWsgSWYgYSB0cmFuc2xhdGlvbklkIGlzIHByb3ZpZGVkLCBpdCB3aWxsIGJlIHVzZWQgZm9yIHNob3dpbmdcbiAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9yIGhpZGluZyB0aGUgY2xvYWsuIEJhc2ljYWxseSBpdCByZWxpZXMgb24gdGhlIHRyYW5zbGF0aW9uXG4gKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlLlxuICovXG4uZGlyZWN0aXZlKCd0cmFuc2xhdGVDbG9haycsIFsnJHJvb3RTY29wZScsICckdHJhbnNsYXRlJywgZnVuY3Rpb24gKCRyb290U2NvcGUsICR0cmFuc2xhdGUpIHtcblxuICByZXR1cm4ge1xuICAgIGNvbXBpbGU6IGZ1bmN0aW9uICh0RWxlbWVudCkge1xuICAgICAgdmFyIGFwcGx5Q2xvYWsgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRFbGVtZW50LmFkZENsYXNzKCR0cmFuc2xhdGUuY2xvYWtDbGFzc05hbWUoKSk7XG4gICAgICB9LFxuICAgICAgcmVtb3ZlQ2xvYWsgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRFbGVtZW50LnJlbW92ZUNsYXNzKCR0cmFuc2xhdGUuY2xvYWtDbGFzc05hbWUoKSk7XG4gICAgICB9LFxuICAgICAgcmVtb3ZlTGlzdGVuZXIgPSAkcm9vdFNjb3BlLiRvbignJHRyYW5zbGF0ZUNoYW5nZUVuZCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmVtb3ZlQ2xvYWsoKTtcbiAgICAgICAgcmVtb3ZlTGlzdGVuZXIoKTtcbiAgICAgICAgcmVtb3ZlTGlzdGVuZXIgPSBudWxsO1xuICAgICAgfSk7XG4gICAgICBhcHBseUNsb2FrKCk7XG5cbiAgICAgIHJldHVybiBmdW5jdGlvbiBsaW5rRm4oc2NvcGUsIGlFbGVtZW50LCBpQXR0cikge1xuICAgICAgICAvLyBSZWdpc3RlciBhIHdhdGNoZXIgZm9yIHRoZSBkZWZpbmVkIHRyYW5zbGF0aW9uIGFsbG93aW5nIGEgZmluZSB0dW5lZCBjbG9ha1xuICAgICAgICBpZiAoaUF0dHIudHJhbnNsYXRlQ2xvYWsgJiYgaUF0dHIudHJhbnNsYXRlQ2xvYWsubGVuZ3RoKSB7XG4gICAgICAgICAgaUF0dHIuJG9ic2VydmUoJ3RyYW5zbGF0ZUNsb2FrJywgZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQpIHtcbiAgICAgICAgICAgICR0cmFuc2xhdGUodHJhbnNsYXRpb25JZCkudGhlbihyZW1vdmVDbG9haywgYXBwbHlDbG9hayk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfVxuICB9O1xufV0pO1xuXG5hbmd1bGFyLm1vZHVsZSgncGFzY2FscHJlY2h0LnRyYW5zbGF0ZScpXG4vKipcbiAqIEBuZ2RvYyBmaWx0ZXJcbiAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuZmlsdGVyOnRyYW5zbGF0ZVxuICogQHJlcXVpcmVzICRwYXJzZVxuICogQHJlcXVpcmVzIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVxuICogQGZ1bmN0aW9uXG4gKlxuICogQGRlc2NyaXB0aW9uXG4gKiBVc2VzIGAkdHJhbnNsYXRlYCBzZXJ2aWNlIHRvIHRyYW5zbGF0ZSBjb250ZW50cy4gQWNjZXB0cyBpbnRlcnBvbGF0ZSBwYXJhbWV0ZXJzXG4gKiB0byBwYXNzIGR5bmFtaXplZCB2YWx1ZXMgdGhvdWdoIHRyYW5zbGF0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSB0cmFuc2xhdGlvbklkIEEgdHJhbnNsYXRpb24gaWQgdG8gYmUgdHJhbnNsYXRlZC5cbiAqIEBwYXJhbSB7Kj19IGludGVycG9sYXRlUGFyYW1zIE9wdGlvbmFsIG9iamVjdCBsaXRlcmFsIChhcyBoYXNoIG9yIHN0cmluZykgdG8gcGFzcyB2YWx1ZXMgaW50byB0cmFuc2xhdGlvbi5cbiAqXG4gKiBAcmV0dXJucyB7c3RyaW5nfSBUcmFuc2xhdGVkIHRleHQuXG4gKlxuICogQGV4YW1wbGVcbiAgIDxleGFtcGxlIG1vZHVsZT1cIm5nVmlld1wiPlxuICAgIDxmaWxlIG5hbWU9XCJpbmRleC5odG1sXCI+XG4gICAgICA8ZGl2IG5nLWNvbnRyb2xsZXI9XCJUcmFuc2xhdGVDdHJsXCI+XG5cbiAgICAgICAgPHByZT57eyAnVFJBTlNMQVRJT05fSUQnIHwgdHJhbnNsYXRlIH19PC9wcmU+XG4gICAgICAgIDxwcmU+e3sgdHJhbnNsYXRpb25JZCB8IHRyYW5zbGF0ZSB9fTwvcHJlPlxuICAgICAgICA8cHJlPnt7ICdXSVRIX1ZBTFVFUycgfCB0cmFuc2xhdGU6J3t2YWx1ZTogNX0nIH19PC9wcmU+XG4gICAgICAgIDxwcmU+e3sgJ1dJVEhfVkFMVUVTJyB8IHRyYW5zbGF0ZTp2YWx1ZXMgfX08L3ByZT5cblxuICAgICAgPC9kaXY+XG4gICAgPC9maWxlPlxuICAgIDxmaWxlIG5hbWU9XCJzY3JpcHQuanNcIj5cbiAgICAgIGFuZ3VsYXIubW9kdWxlKCduZ1ZpZXcnLCBbJ3Bhc2NhbHByZWNodC50cmFuc2xhdGUnXSlcblxuICAgICAgLmNvbmZpZyhmdW5jdGlvbiAoJHRyYW5zbGF0ZVByb3ZpZGVyKSB7XG5cbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnRyYW5zbGF0aW9ucygnZW4nLCB7XG4gICAgICAgICAgJ1RSQU5TTEFUSU9OX0lEJzogJ0hlbGxvIHRoZXJlIScsXG4gICAgICAgICAgJ1dJVEhfVkFMVUVTJzogJ1RoZSBmb2xsb3dpbmcgdmFsdWUgaXMgZHluYW1pYzoge3t2YWx1ZX19J1xuICAgICAgICB9KTtcbiAgICAgICAgJHRyYW5zbGF0ZVByb3ZpZGVyLnByZWZlcnJlZExhbmd1YWdlKCdlbicpO1xuXG4gICAgICB9KTtcblxuICAgICAgYW5ndWxhci5tb2R1bGUoJ25nVmlldycpLmNvbnRyb2xsZXIoJ1RyYW5zbGF0ZUN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlKSB7XG4gICAgICAgICRzY29wZS50cmFuc2xhdGlvbklkID0gJ1RSQU5TTEFUSU9OX0lEJztcblxuICAgICAgICAkc2NvcGUudmFsdWVzID0ge1xuICAgICAgICAgIHZhbHVlOiA3OFxuICAgICAgICB9O1xuICAgICAgfSk7XG4gICAgPC9maWxlPlxuICAgPC9leGFtcGxlPlxuICovXG4uZmlsdGVyKCd0cmFuc2xhdGUnLCBbJyRwYXJzZScsICckdHJhbnNsYXRlJywgZnVuY3Rpb24gKCRwYXJzZSwgJHRyYW5zbGF0ZSkge1xuICB2YXIgdHJhbnNsYXRlRmlsdGVyID0gZnVuY3Rpb24gKHRyYW5zbGF0aW9uSWQsIGludGVycG9sYXRlUGFyYW1zLCBpbnRlcnBvbGF0aW9uKSB7XG5cbiAgICBpZiAoIWFuZ3VsYXIuaXNPYmplY3QoaW50ZXJwb2xhdGVQYXJhbXMpKSB7XG4gICAgICBpbnRlcnBvbGF0ZVBhcmFtcyA9ICRwYXJzZShpbnRlcnBvbGF0ZVBhcmFtcykodGhpcyk7XG4gICAgfVxuXG4gICAgcmV0dXJuICR0cmFuc2xhdGUuaW5zdGFudCh0cmFuc2xhdGlvbklkLCBpbnRlcnBvbGF0ZVBhcmFtcywgaW50ZXJwb2xhdGlvbik7XG4gIH07XG5cbiAgaWYgKCR0cmFuc2xhdGUuc3RhdGVmdWxGaWx0ZXIoKSkge1xuICAgIHRyYW5zbGF0ZUZpbHRlci4kc3RhdGVmdWwgPSB0cnVlO1xuICB9XG5cbiAgcmV0dXJuIHRyYW5zbGF0ZUZpbHRlcjtcbn1dKTtcbnJldHVybiAncGFzY2FscHJlY2h0LnRyYW5zbGF0ZSc7XG5cbn0pKTtcbiIsIi8qIVxuICogYW5ndWxhci10cmFuc2xhdGUgLSB2Mi43LjAgLSAyMDE1LTA0LTE1XG4gKiBodHRwOi8vZ2l0aHViLmNvbS9hbmd1bGFyLXRyYW5zbGF0ZS9hbmd1bGFyLXRyYW5zbGF0ZVxuICogQ29weXJpZ2h0IChjKSAyMDE1IDsgTGljZW5zZWQgTUlUXG4gKi9cbihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuICBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG4gICAgLy8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlIHVubGVzcyBhbWRNb2R1bGVJZCBpcyBzZXRcbiAgICBkZWZpbmUoW10sIGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiAoZmFjdG9yeSgpKTtcbiAgICB9KTtcbiAgfSBlbHNlIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpIHtcbiAgICAvLyBOb2RlLiBEb2VzIG5vdCB3b3JrIHdpdGggc3RyaWN0IENvbW1vbkpTLCBidXRcbiAgICAvLyBvbmx5IENvbW1vbkpTLWxpa2UgZW52aXJvbm1lbnRzIHRoYXQgc3VwcG9ydCBtb2R1bGUuZXhwb3J0cyxcbiAgICAvLyBsaWtlIE5vZGUuXG4gICAgbW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG4gIH0gZWxzZSB7XG4gICAgZmFjdG9yeSgpO1xuICB9XG59KHRoaXMsIGZ1bmN0aW9uICgpIHtcblxuYW5ndWxhci5tb2R1bGUoJ3Bhc2NhbHByZWNodC50cmFuc2xhdGUnKVxuLyoqXG4gKiBAbmdkb2Mgb2JqZWN0XG4gKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyUHJvdmlkZXJcbiAqXG4gKiBAZGVzY3JpcHRpb25cbiAqIEJ5IHVzaW5nIGEgJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJQcm92aWRlciB5b3UgY2FuIGNvbmZpZ3VyZSBhIGxpc3Qgb2YgYSBuZWVkZWRcbiAqIHRyYW5zbGF0aW9uIHBhcnRzIGRpcmVjdGx5IGR1cmluZyB0aGUgY29uZmlndXJhdGlvbiBwaGFzZSBvZiB5b3VyIGFwcGxpY2F0aW9uJ3NcbiAqIGxpZmV0aW1lLiBBbGwgcGFydHMgeW91IGFkZCBieSB1c2luZyB0aGlzIHByb3ZpZGVyIHdvdWxkIGJlIGxvYWRlZCBieVxuICogYW5ndWxhci10cmFuc2xhdGUgYXQgdGhlIHN0YXJ0dXAgYXMgc29vbiBhcyBwb3NzaWJsZS5cbiAqL1xuLnByb3ZpZGVyKCckdHJhbnNsYXRlUGFydGlhbExvYWRlcicsIGZ1bmN0aW9uKCkge1xuXG4gIC8qKlxuICAgKiBAY29uc3RydWN0b3JcbiAgICogQG5hbWUgUGFydFxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogUmVwcmVzZW50cyBQYXJ0IG9iamVjdCB0byBhZGQgYW5kIHNldCBwYXJ0cyBhdCBydW50aW1lLlxuICAgKi9cbiAgZnVuY3Rpb24gUGFydChuYW1lLCBwcmlvcml0eSkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5pc0FjdGl2ZSA9IHRydWU7XG4gICAgdGhpcy50YWJsZXMgPSB7fTtcbiAgICB0aGlzLnByaW9yaXR5ID0gcHJpb3JpdHkgfHwgMDtcbiAgfVxuXG4gIC8qKlxuICAgKiBAbmFtZSBwYXJzZVVybFxuICAgKiBAbWV0aG9kXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZXR1cm5zIGEgcGFyc2VkIHVybCB0ZW1wbGF0ZSBzdHJpbmcgYW5kIHJlcGxhY2VzIGdpdmVuIHRhcmdldCBsYW5nXG4gICAqIGFuZCBwYXJ0IG5hbWUgaXQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfGZ1bmN0aW9ufSB1cmxUZW1wbGF0ZSAtIEVpdGhlciBhIHN0cmluZyBjb250YWluaW5nIGFuIHVybCBwYXR0ZXJuICh3aXRoXG4gICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd7cGFydH0nIGFuZCAne2xhbmd9Jykgb3IgYSBmdW5jdGlvbihwYXJ0LCBsYW5nKVxuICAgKiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm5pbmcgYSBzdHJpbmcuXG4gICAqIEBwYXJhbSB7c3RyaW5nfSB0YXJnZXRMYW5nIC0gTGFuZ3VhZ2Uga2V5IGZvciBsYW5ndWFnZSB0byBiZSB1c2VkLlxuICAgKiBAcmV0dXJuIHtzdHJpbmd9IFBhcnNlZCB1cmwgdGVtcGxhdGUgc3RyaW5nXG4gICAqL1xuICBQYXJ0LnByb3RvdHlwZS5wYXJzZVVybCA9IGZ1bmN0aW9uKHVybFRlbXBsYXRlLCB0YXJnZXRMYW5nKSB7XG4gICAgaWYgKGFuZ3VsYXIuaXNGdW5jdGlvbih1cmxUZW1wbGF0ZSkpIHtcbiAgICAgIHJldHVybiB1cmxUZW1wbGF0ZSh0aGlzLm5hbWUsIHRhcmdldExhbmcpO1xuICAgIH1cbiAgICByZXR1cm4gdXJsVGVtcGxhdGUucmVwbGFjZSgvXFx7cGFydFxcfS9nLCB0aGlzLm5hbWUpLnJlcGxhY2UoL1xce2xhbmdcXH0vZywgdGFyZ2V0TGFuZyk7XG4gIH07XG5cbiAgUGFydC5wcm90b3R5cGUuZ2V0VGFibGUgPSBmdW5jdGlvbihsYW5nLCAkcSwgJGh0dHAsICRodHRwT3B0aW9ucywgdXJsVGVtcGxhdGUsIGVycm9ySGFuZGxlcikge1xuICAgIHZhciBkZWZlcnJlZCA9ICRxLmRlZmVyKCk7XG5cbiAgICBpZiAoIXRoaXMudGFibGVzW2xhbmddKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgICRodHRwKGFuZ3VsYXIuZXh0ZW5kKHtcbiAgICAgICAgbWV0aG9kIDogJ0dFVCcsXG4gICAgICAgIHVybDogdGhpcy5wYXJzZVVybCh1cmxUZW1wbGF0ZSwgbGFuZylcbiAgICAgIH0sICRodHRwT3B0aW9ucykpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgIHNlbGYudGFibGVzW2xhbmddID0gZGF0YTtcbiAgICAgICAgZGVmZXJyZWQucmVzb2x2ZShkYXRhKTtcbiAgICAgIH0pLmVycm9yKGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoZXJyb3JIYW5kbGVyKSB7XG4gICAgICAgICAgZXJyb3JIYW5kbGVyKHNlbGYubmFtZSwgbGFuZykudGhlbihmdW5jdGlvbihkYXRhKSB7XG4gICAgICAgICAgICBzZWxmLnRhYmxlc1tsYW5nXSA9IGRhdGE7XG4gICAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKGRhdGEpO1xuICAgICAgICAgIH0sIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHNlbGYubmFtZSk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KHNlbGYubmFtZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSBlbHNlIHtcbiAgICAgIGRlZmVycmVkLnJlc29sdmUodGhpcy50YWJsZXNbbGFuZ10pO1xuICAgIH1cbiAgICByZXR1cm4gZGVmZXJyZWQucHJvbWlzZTtcbiAgfTtcblxuICB2YXIgcGFydHMgPSB7fTtcblxuICBmdW5jdGlvbiBoYXNQYXJ0KG5hbWUpIHtcbiAgICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKHBhcnRzLCBuYW1lKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGlzU3RyaW5nVmFsaWQoc3RyKSB7XG4gICAgcmV0dXJuIGFuZ3VsYXIuaXNTdHJpbmcoc3RyKSAmJiBzdHIgIT09ICcnO1xuICB9XG5cbiAgZnVuY3Rpb24gaXNQYXJ0QXZhaWxhYmxlKG5hbWUpIHtcbiAgICBpZiAoIWlzU3RyaW5nVmFsaWQobmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0ludmFsaWQgdHlwZSBvZiBhIGZpcnN0IGFyZ3VtZW50LCBhIG5vbi1lbXB0eSBzdHJpbmcgZXhwZWN0ZWQuJyk7XG4gICAgfVxuXG4gICAgcmV0dXJuIChoYXNQYXJ0KG5hbWUpICYmIHBhcnRzW25hbWVdLmlzQWN0aXZlKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGRlZXBFeHRlbmQoZHN0LCBzcmMpIHtcbiAgICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzcmMpIHtcbiAgICAgIGlmIChzcmNbcHJvcGVydHldICYmIHNyY1twcm9wZXJ0eV0uY29uc3RydWN0b3IgJiZcbiAgICAgICBzcmNbcHJvcGVydHldLmNvbnN0cnVjdG9yID09PSBPYmplY3QpIHtcbiAgICAgICAgZHN0W3Byb3BlcnR5XSA9IGRzdFtwcm9wZXJ0eV0gfHwge307XG4gICAgICAgIGRlZXBFeHRlbmQoZHN0W3Byb3BlcnR5XSwgc3JjW3Byb3BlcnR5XSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkc3RbcHJvcGVydHldID0gc3JjW3Byb3BlcnR5XTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRzdDtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFByaW9yaXRpemVkUGFydHMoKSB7XG4gICAgdmFyIHByaW9yaXRpemVkUGFydHMgPSBbXTtcbiAgICBmb3IodmFyIHBhcnQgaW4gcGFydHMpIHtcbiAgICAgIGlmIChwYXJ0c1twYXJ0XS5pc0FjdGl2ZSkge1xuICAgICAgICBwcmlvcml0aXplZFBhcnRzLnB1c2gocGFydHNbcGFydF0pO1xuICAgICAgfVxuICAgIH1cbiAgICBwcmlvcml0aXplZFBhcnRzLnNvcnQoZnVuY3Rpb24gKGEsIGIpIHtcbiAgICAgIHJldHVybiBhLnByaW9yaXR5IC0gYi5wcmlvcml0eTtcbiAgICB9KTtcbiAgICByZXR1cm4gcHJpb3JpdGl6ZWRQYXJ0cztcbiAgfVxuXG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyUHJvdmlkZXIjYWRkUGFydFxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUGFydGlhbExvYWRlclByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZWdpc3RlcnMgYSBuZXcgcGFydCBvZiB0aGUgdHJhbnNsYXRpb24gdGFibGUgdG8gYmUgbG9hZGVkIG9uY2UgdGhlXG4gICAqIGBhbmd1bGFyLXRyYW5zbGF0ZWAgZ2V0cyBpbnRvIHJ1bnRpbWUgcGhhc2UuIEl0IGRvZXMgbm90IGFjdHVhbGx5IGxvYWQgYW55XG4gICAqIHRyYW5zbGF0aW9uIGRhdGEsIGJ1dCBvbmx5IHJlZ2lzdGVycyBhIHBhcnQgdG8gYmUgbG9hZGVkIGluIHRoZSBmdXR1cmUuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIEEgbmFtZSBvZiB0aGUgcGFydCB0byBhZGRcbiAgICogQHBhcmFtIHtpbnR9IFtwcmlvcml0eT0wXSBTZXRzIHRoZSBsb2FkIHByaW9yaXR5IG9mIHRoaXMgcGFydC5cbiAgICpcbiAgICogQHJldHVybnMge29iamVjdH0gJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJQcm92aWRlciwgc28gdGhpcyBtZXRob2QgaXMgY2hhaW5hYmxlXG4gICAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gVGhlIG1ldGhvZCBjb3VsZCB0aHJvdyBhICoqVHlwZUVycm9yKiogaWYgeW91IHBhc3MgdGhlIHBhcmFtXG4gICAqIG9mIHRoZSB3cm9uZyB0eXBlLiBQbGVhc2UsIG5vdGUgdGhhdCB0aGUgYG5hbWVgIHBhcmFtIGhhcyB0byBiZSBhXG4gICAqIG5vbi1lbXB0eSAqKnN0cmluZyoqLlxuICAgKi9cbiAgdGhpcy5hZGRQYXJ0ID0gZnVuY3Rpb24obmFtZSwgcHJpb3JpdHkpIHtcbiAgICBpZiAoIWlzU3RyaW5nVmFsaWQobmFtZSkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0NvdWxkblxcJ3QgYWRkIHBhcnQsIHBhcnQgbmFtZSBoYXMgdG8gYmUgYSBzdHJpbmchJyk7XG4gICAgfVxuXG4gICAgaWYgKCFoYXNQYXJ0KG5hbWUpKSB7XG4gICAgICBwYXJ0c1tuYW1lXSA9IG5ldyBQYXJ0KG5hbWUsIHByaW9yaXR5KTtcbiAgICB9XG4gICAgcGFydHNbbmFtZV0uaXNBY3RpdmUgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvY3MgZnVuY3Rpb25cbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUGFydGlhbExvYWRlclByb3ZpZGVyI3NldFBhcnRcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogU2V0cyBhIHRyYW5zbGF0aW9uIHRhYmxlIHRvIHRoZSBzcGVjaWZpZWQgcGFydC4gVGhpcyBtZXRob2QgZG9lcyBub3QgbWFrZSB0aGVcbiAgICogc3BlY2lmaWVkIHBhcnQgYXZhaWxhYmxlLCBidXQgb25seSBhdm9pZHMgbG9hZGluZyB0aGlzIHBhcnQgZnJvbSB0aGUgc2VydmVyLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gbGFuZyBBIGxhbmd1YWdlIG9mIHRoZSBnaXZlbiB0cmFuc2xhdGlvbiB0YWJsZVxuICAgKiBAcGFyYW0ge3N0cmluZ30gcGFydCBBIG5hbWUgb2YgdGhlIHRhcmdldCBwYXJ0XG4gICAqIEBwYXJhbSB7b2JqZWN0fSB0YWJsZSBBIHRyYW5zbGF0aW9uIHRhYmxlIHRvIHNldCB0byB0aGUgc3BlY2lmaWVkIHBhcnRcbiAgICpcbiAgICogQHJldHVybiB7b2JqZWN0fSAkdHJhbnNsYXRlUGFydGlhbExvYWRlclByb3ZpZGVyLCBzbyB0aGlzIG1ldGhvZCBpcyBjaGFpbmFibGVcbiAgICogQHRocm93cyB7VHlwZUVycm9yfSBUaGUgbWV0aG9kIGNvdWxkIHRocm93IGEgKipUeXBlRXJyb3IqKiBpZiB5b3UgcGFzcyBwYXJhbXNcbiAgICogb2YgdGhlIHdyb25nIHR5cGUuIFBsZWFzZSwgbm90ZSB0aGF0IHRoZSBgbGFuZ2AgYW5kIGBwYXJ0YCBwYXJhbXMgaGF2ZSB0byBiZSBhXG4gICAqIG5vbi1lbXB0eSAqKnN0cmluZyoqcyBhbmQgdGhlIGB0YWJsZWAgcGFyYW0gaGFzIHRvIGJlIGFuIG9iamVjdC5cbiAgICovXG4gIHRoaXMuc2V0UGFydCA9IGZ1bmN0aW9uKGxhbmcsIHBhcnQsIHRhYmxlKSB7XG4gICAgaWYgKCFpc1N0cmluZ1ZhbGlkKGxhbmcpKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDb3VsZG5cXCd0IHNldCBwYXJ0LmBsYW5nYCBwYXJhbWV0ZXIgaGFzIHRvIGJlIGEgc3RyaW5nIScpO1xuICAgIH1cbiAgICBpZiAoIWlzU3RyaW5nVmFsaWQocGFydCkpIHtcbiAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ0NvdWxkblxcJ3Qgc2V0IHBhcnQuYHBhcnRgIHBhcmFtZXRlciBoYXMgdG8gYmUgYSBzdHJpbmchJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgdGFibGUgIT09ICdvYmplY3QnIHx8IHRhYmxlID09PSBudWxsKSB7XG4gICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDb3VsZG5cXCd0IHNldCBwYXJ0LiBgdGFibGVgIHBhcmFtZXRlciBoYXMgdG8gYmUgYW4gb2JqZWN0IScpO1xuICAgIH1cblxuICAgIGlmICghaGFzUGFydChwYXJ0KSkge1xuICAgICAgcGFydHNbcGFydF0gPSBuZXcgUGFydChwYXJ0KTtcbiAgICAgIHBhcnRzW3BhcnRdLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcGFydHNbcGFydF0udGFibGVzW2xhbmddID0gdGFibGU7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyUHJvdmlkZXIjZGVsZXRlUGFydFxuICAgKiBAbWV0aG9kT2YgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUGFydGlhbExvYWRlclByb3ZpZGVyXG4gICAqXG4gICAqIEBkZXNjcmlwdGlvblxuICAgKiBSZW1vdmVzIHRoZSBwcmV2aW91c2x5IGFkZGVkIHBhcnQgb2YgdGhlIHRyYW5zbGF0aW9uIGRhdGEuIFNvLCBgYW5ndWxhci10cmFuc2xhdGVgIHdpbGwgbm90XG4gICAqIGxvYWQgaXQgYXQgdGhlIHN0YXJ0dXAuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIEEgbmFtZSBvZiB0aGUgcGFydCB0byBkZWxldGVcbiAgICpcbiAgICogQHJldHVybnMge29iamVjdH0gJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJQcm92aWRlciwgc28gdGhpcyBtZXRob2QgaXMgY2hhaW5hYmxlXG4gICAqXG4gICAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gVGhlIG1ldGhvZCBjb3VsZCB0aHJvdyBhICoqVHlwZUVycm9yKiogaWYgeW91IHBhc3MgdGhlIHBhcmFtIG9mIHRoZSB3cm9uZ1xuICAgKiB0eXBlLiBQbGVhc2UsIG5vdGUgdGhhdCB0aGUgYG5hbWVgIHBhcmFtIGhhcyB0byBiZSBhIG5vbi1lbXB0eSAqKnN0cmluZyoqLlxuICAgKi9cbiAgdGhpcy5kZWxldGVQYXJ0ID0gZnVuY3Rpb24obmFtZSkge1xuICAgIGlmICghaXNTdHJpbmdWYWxpZChuYW1lKSkge1xuICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ291bGRuXFwndCBkZWxldGUgcGFydCwgZmlyc3QgYXJnIGhhcyB0byBiZSBzdHJpbmcuJyk7XG4gICAgfVxuXG4gICAgaWYgKGhhc1BhcnQobmFtZSkpIHtcbiAgICAgIHBhcnRzW25hbWVdLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cblxuICAvKipcbiAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJQcm92aWRlciNpc1BhcnRBdmFpbGFibGVcbiAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJQcm92aWRlclxuICAgKlxuICAgKiBAZGVzY3JpcHRpb25cbiAgICogQ2hlY2tzIGlmIHRoZSBzcGVjaWZpYyBwYXJ0IGlzIGF2YWlsYWJsZS4gQSBwYXJ0IGJlY29tZXMgYXZhaWxhYmxlIGFmdGVyIGl0IHdhcyBhZGRlZCBieSB0aGVcbiAgICogYGFkZFBhcnRgIG1ldGhvZC4gQXZhaWxhYmxlIHBhcnRzIHdvdWxkIGJlIGxvYWRlZCBmcm9tIHRoZSBzZXJ2ZXIgb25jZSB0aGUgYGFuZ3VsYXItdHJhbnNsYXRlYFxuICAgKiBhc2tzIHRoZSBsb2FkZXIgdG8gdGhhdC5cbiAgICpcbiAgICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgQSBuYW1lIG9mIHRoZSBwYXJ0IHRvIGNoZWNrXG4gICAqXG4gICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zICoqdHJ1ZSoqIGlmIHRoZSBwYXJ0IGlzIGF2YWlsYWJsZSBub3cgYW5kICoqZmFsc2UqKiBpZiBub3QuXG4gICAqXG4gICAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gVGhlIG1ldGhvZCBjb3VsZCB0aHJvdyBhICoqVHlwZUVycm9yKiogaWYgeW91IHBhc3MgdGhlIHBhcmFtIG9mIHRoZSB3cm9uZ1xuICAgKiB0eXBlLiBQbGVhc2UsIG5vdGUgdGhhdCB0aGUgYG5hbWVgIHBhcmFtIGhhcyB0byBiZSBhIG5vbi1lbXB0eSAqKnN0cmluZyoqLlxuICAgKi9cbiAgdGhpcy5pc1BhcnRBdmFpbGFibGUgPSBpc1BhcnRBdmFpbGFibGU7XG5cbiAgLyoqXG4gICAqIEBuZ2RvYyBvYmplY3RcbiAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUGFydGlhbExvYWRlclxuICAgKlxuICAgKiBAcmVxdWlyZXMgJHFcbiAgICogQHJlcXVpcmVzICRodHRwXG4gICAqIEByZXF1aXJlcyAkaW5qZWN0b3JcbiAgICogQHJlcXVpcmVzICRyb290U2NvcGVcbiAgICogQHJlcXVpcmVzICR0cmFuc2xhdGVcbiAgICpcbiAgICogQGRlc2NyaXB0aW9uXG4gICAqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIE9wdGlvbnMgb2JqZWN0XG4gICAqXG4gICAqIEB0aHJvd3Mge1R5cGVFcnJvcn1cbiAgICovXG4gIHRoaXMuJGdldCA9IFsnJHJvb3RTY29wZScsICckaW5qZWN0b3InLCAnJHEnLCAnJGh0dHAnLFxuICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkaW5qZWN0b3IsICRxLCAkaHR0cCkge1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGV2ZW50XG4gICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUGFydGlhbExvYWRlciMkdHJhbnNsYXRlUGFydGlhbExvYWRlclN0cnVjdHVyZUNoYW5nZWRcbiAgICAgKiBAZXZlbnRPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyXG4gICAgICogQGV2ZW50VHlwZSBicm9hZGNhc3Qgb24gcm9vdCBzY29wZVxuICAgICAqXG4gICAgICogQGRlc2NyaXB0aW9uXG4gICAgICogQSAkdHJhbnNsYXRlUGFydGlhbExvYWRlclN0cnVjdHVyZUNoYW5nZWQgZXZlbnQgaXMgY2FsbGVkIHdoZW4gYSBzdGF0ZSBvZiB0aGUgbG9hZGVyIHdhc1xuICAgICAqIGNoYW5nZWQgc29tZWhvdy4gSXQgY291bGQgbWVhbiBlaXRoZXIgc29tZSBwYXJ0IGlzIGFkZGVkIG9yIHNvbWUgcGFydCBpcyBkZWxldGVkLiBBbnl3YXkgd2hlblxuICAgICAqIHlvdSBnZXQgdGhpcyBldmVudCB0aGUgdHJhbnNsYXRpb24gdGFibGUgaXMgbm90IGxvbmdlciBjdXJyZW50IGFuZCBoYXMgdG8gYmUgdXBkYXRlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIEEgbmFtZSBvZiB0aGUgcGFydCB3aGljaCBpcyBhIHJlYXNvbiB3aHkgdGhlIGV2ZW50IHdhcyBmaXJlZFxuICAgICAqL1xuXG4gICAgdmFyIHNlcnZpY2UgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBpZiAoIWlzU3RyaW5nVmFsaWQob3B0aW9ucy5rZXkpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1VuYWJsZSB0byBsb2FkIGRhdGEsIGEga2V5IGlzIG5vdCBhIG5vbi1lbXB0eSBzdHJpbmcuJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaXNTdHJpbmdWYWxpZChvcHRpb25zLnVybFRlbXBsYXRlKSAmJiAhYW5ndWxhci5pc0Z1bmN0aW9uKG9wdGlvbnMudXJsVGVtcGxhdGUpKSB7XG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoJ1VuYWJsZSB0byBsb2FkIGRhdGEsIGEgdXJsVGVtcGxhdGUgaXMgbm90IGEgbm9uLWVtcHR5IHN0cmluZyBvciBub3QgYSBmdW5jdGlvbi4nKTtcbiAgICAgIH1cblxuICAgICAgdmFyIGVycm9ySGFuZGxlciA9IG9wdGlvbnMubG9hZEZhaWx1cmVIYW5kbGVyO1xuICAgICAgaWYgKGVycm9ySGFuZGxlciAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIGlmICghYW5ndWxhci5pc1N0cmluZyhlcnJvckhhbmRsZXIpKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gbG9hZCBkYXRhLCBhIGxvYWRGYWlsdXJlSGFuZGxlciBpcyBub3QgYSBzdHJpbmcuJyk7XG4gICAgICAgIH0gZWxzZSBlcnJvckhhbmRsZXIgPSAkaW5qZWN0b3IuZ2V0KGVycm9ySGFuZGxlcik7XG4gICAgICB9XG5cbiAgICAgIHZhciBsb2FkZXJzID0gW10sXG4gICAgICAgICAgZGVmZXJyZWQgPSAkcS5kZWZlcigpLFxuICAgICAgICAgIHByaW9yaXRpemVkUGFydHMgPSBnZXRQcmlvcml0aXplZFBhcnRzKCk7XG5cbiAgICAgIGFuZ3VsYXIuZm9yRWFjaChwcmlvcml0aXplZFBhcnRzLCBmdW5jdGlvbihwYXJ0LCBpbmRleCkge1xuICAgICAgICBsb2FkZXJzLnB1c2goXG4gICAgICAgICAgcGFydC5nZXRUYWJsZShvcHRpb25zLmtleSwgJHEsICRodHRwLCBvcHRpb25zLiRodHRwLCBvcHRpb25zLnVybFRlbXBsYXRlLCBlcnJvckhhbmRsZXIpXG4gICAgICAgICk7XG4gICAgICAgIHBhcnQudXJsVGVtcGxhdGUgPSBvcHRpb25zLnVybFRlbXBsYXRlO1xuICAgICAgfSk7XG5cbiAgICAgICRxLmFsbChsb2FkZXJzKS50aGVuKFxuICAgICAgICBmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgdGFibGUgPSB7fTtcbiAgICAgICAgICBhbmd1bGFyLmZvckVhY2gocHJpb3JpdGl6ZWRQYXJ0cywgZnVuY3Rpb24ocGFydCkge1xuICAgICAgICAgICAgZGVlcEV4dGVuZCh0YWJsZSwgcGFydC50YWJsZXNbb3B0aW9ucy5rZXldKTtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBkZWZlcnJlZC5yZXNvbHZlKHRhYmxlKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgZGVmZXJyZWQucmVqZWN0KG9wdGlvbnMua2V5KTtcbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIGRlZmVycmVkLnByb21pc2U7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIEBuZ2RvYyBmdW5jdGlvblxuICAgICAqIEBuYW1lIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXIjYWRkUGFydFxuICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBSZWdpc3RlcnMgYSBuZXcgcGFydCBvZiB0aGUgdHJhbnNsYXRpb24gdGFibGUuIFRoaXMgbWV0aG9kIGRvZXMgbm90IGFjdHVhbGx5IHBlcmZvcm0gYW55IHhoclxuICAgICAqIHJlcXVlc3RzIHRvIGdldCB0cmFuc2xhdGlvbiBkYXRhLiBUaGUgbmV3IHBhcnRzIHdpbGwgYmUgbG9hZGVkIGluIG9yZGVyIG9mIHByaW9yaXR5IGZyb20gdGhlIHNlcnZlciBuZXh0IHRpbWVcbiAgICAgKiBgYW5ndWxhci10cmFuc2xhdGVgIGFza3MgdGhlIGxvYWRlciB0byBsb2FkIHRyYW5zbGF0aW9ucy5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIEEgbmFtZSBvZiB0aGUgcGFydCB0byBhZGRcbiAgICAgKiBAcGFyYW0ge2ludH0gW3ByaW9yaXR5PTBdIFNldHMgdGhlIGxvYWQgcHJpb3JpdHkgb2YgdGhpcyBwYXJ0LlxuICAgICAqXG4gICAgICogQHJldHVybnMge29iamVjdH0gJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXIsIHNvIHRoaXMgbWV0aG9kIGlzIGNoYWluYWJsZVxuICAgICAqXG4gICAgICogQGZpcmVzIHskdHJhbnNsYXRlUGFydGlhbExvYWRlclN0cnVjdHVyZUNoYW5nZWR9IFRoZSAkdHJhbnNsYXRlUGFydGlhbExvYWRlclN0cnVjdHVyZUNoYW5nZWRcbiAgICAgKiBldmVudCB3b3VsZCBiZSBmaXJlZCBieSB0aGlzIG1ldGhvZCBpbiBjYXNlIHRoZSBuZXcgcGFydCBhZmZlY3RlZCBzb21laG93IG9uIHRoZSBsb2FkZXJzXG4gICAgICogc3RhdGUuIFRoaXMgd2F5IGl0IG1lYW5zIHRoYXQgdGhlcmUgYXJlIGEgbmV3IHRyYW5zbGF0aW9uIGRhdGEgYXZhaWxhYmxlIHRvIGJlIGxvYWRlZCBmcm9tXG4gICAgICogdGhlIHNlcnZlci5cbiAgICAgKlxuICAgICAqIEB0aHJvd3Mge1R5cGVFcnJvcn0gVGhlIG1ldGhvZCBjb3VsZCB0aHJvdyBhICoqVHlwZUVycm9yKiogaWYgeW91IHBhc3MgdGhlIHBhcmFtIG9mIHRoZSB3cm9uZ1xuICAgICAqIHR5cGUuIFBsZWFzZSwgbm90ZSB0aGF0IHRoZSBgbmFtZWAgcGFyYW0gaGFzIHRvIGJlIGEgbm9uLWVtcHR5ICoqc3RyaW5nKiouXG4gICAgICovXG4gICAgc2VydmljZS5hZGRQYXJ0ID0gZnVuY3Rpb24obmFtZSwgcHJpb3JpdHkpIHtcbiAgICAgIGlmICghaXNTdHJpbmdWYWxpZChuYW1lKSkge1xuICAgICAgICB0aHJvdyBuZXcgVHlwZUVycm9yKCdDb3VsZG5cXCd0IGFkZCBwYXJ0LCBmaXJzdCBhcmcgaGFzIHRvIGJlIGEgc3RyaW5nJyk7XG4gICAgICB9XG5cbiAgICAgIGlmICghaGFzUGFydChuYW1lKSkge1xuICAgICAgICBwYXJ0c1tuYW1lXSA9IG5ldyBQYXJ0KG5hbWUsIHByaW9yaXR5KTtcbiAgICAgICAgJHJvb3RTY29wZS4kZW1pdCgnJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJTdHJ1Y3R1cmVDaGFuZ2VkJywgbmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKCFwYXJ0c1tuYW1lXS5pc0FjdGl2ZSkge1xuICAgICAgICBwYXJ0c1tuYW1lXS5pc0FjdGl2ZSA9IHRydWU7XG4gICAgICAgICRyb290U2NvcGUuJGVtaXQoJyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyU3RydWN0dXJlQ2hhbmdlZCcsIG5hbWUpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gc2VydmljZTtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogQG5nZG9jIGZ1bmN0aW9uXG4gICAgICogQG5hbWUgcGFzY2FscHJlY2h0LnRyYW5zbGF0ZS4kdHJhbnNsYXRlUGFydGlhbExvYWRlciNkZWxldGVQYXJ0XG4gICAgICogQG1ldGhvZE9mIHBhc2NhbHByZWNodC50cmFuc2xhdGUuJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJcbiAgICAgKlxuICAgICAqIEBkZXNjcmlwdGlvblxuICAgICAqIERlbGV0ZXMgdGhlIHByZXZpb3VzbHkgYWRkZWQgcGFydCBvZiB0aGUgdHJhbnNsYXRpb24gZGF0YS4gVGhlIHRhcmdldCBwYXJ0IGNvdWxkIGJlIGRlbGV0ZWRcbiAgICAgKiBlaXRoZXIgbG9naWNhbGx5IG9yIHBoeXNpY2FsbHkuIFdoZW4gdGhlIGRhdGEgaXMgZGVsZXRlZCBsb2dpY2FsbHkgaXQgaXMgbm90IGFjdHVhbGx5IGRlbGV0ZWRcbiAgICAgKiBmcm9tIHRoZSBicm93c2VyLCBidXQgdGhlIGxvYWRlciBtYXJrcyBpdCBhcyBub3QgYWN0aXZlIGFuZCBwcmV2ZW50cyBpdCBmcm9tIGFmZmVjdGluZyBvbiB0aGVcbiAgICAgKiB0cmFuc2xhdGlvbnMuIElmIHRoZSBkZWxldGVkIGluIHN1Y2ggd2F5IHBhcnQgaXMgYWRkZWQgYWdhaW4sIHRoZSBsb2FkZXIgd2lsbCB1c2UgdGhlXG4gICAgICogcHJldmlvdXNseSBsb2FkZWQgZGF0YSByYXRoZXIgdGhhbiBsb2FkaW5nIGl0IGZyb20gdGhlIHNlcnZlciBvbmNlIG1vcmUgdGltZS4gQnV0IGlmIHRoZSBkYXRhXG4gICAgICogaXMgZGVsZXRlZCBwaHlzaWNhbGx5LCB0aGUgbG9hZGVyIHdpbGwgY29tcGxldGVseSByZW1vdmUgYWxsIGluZm9ybWF0aW9uIGFib3V0IGl0LiBTbyBpbiBjYXNlXG4gICAgICogb2YgcmVjeWNsaW5nIHRoaXMgcGFydCB3aWxsIGJlIGxvYWRlZCBmcm9tIHRoZSBzZXJ2ZXIgYWdhaW4uXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBBIG5hbWUgb2YgdGhlIHBhcnQgdG8gZGVsZXRlXG4gICAgICogQHBhcmFtIHtib29sZWFuPX0gW3JlbW92ZURhdGE9ZmFsc2VdIEFuIGluZGljYXRvciBpZiB0aGUgbG9hZGVyIGhhcyB0byByZW1vdmUgYSBsb2FkZWRcbiAgICAgKiB0cmFuc2xhdGlvbiBkYXRhIHBoeXNpY2FsbHkuIElmIHRoZSBgcmVtb3ZlRGF0YWAgaWYgc2V0IHRvICoqZmFsc2UqKiB0aGUgbG9hZGVkIGRhdGEgd2lsbCBub3QgYmVcbiAgICAgKiBkZWxldGVkIHBoeXNpY2FsbHkgYW5kIG1pZ2h0IGJlIHJldXNlZCBpbiB0aGUgZnV0dXJlIHRvIHByZXZlbnQgYW4gYWRkaXRpb25hbCB4aHIgcmVxdWVzdHMuXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSAkdHJhbnNsYXRlUGFydGlhbExvYWRlciwgc28gdGhpcyBtZXRob2QgaXMgY2hhaW5hYmxlXG4gICAgICpcbiAgICAgKiBAZmlyZXMgeyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyU3RydWN0dXJlQ2hhbmdlZH0gVGhlICR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyU3RydWN0dXJlQ2hhbmdlZFxuICAgICAqIGV2ZW50IHdvdWxkIGJlIGZpcmVkIGJ5IHRoaXMgbWV0aG9kIGluIGNhc2UgYSBwYXJ0IGRlbGV0aW9uIHByb2Nlc3MgYWZmZWN0cyBzb21laG93IG9uIHRoZVxuICAgICAqIGxvYWRlcnMgc3RhdGUuIFRoaXMgd2F5IGl0IG1lYW5zIHRoYXQgc29tZSBwYXJ0IG9mIHRoZSB0cmFuc2xhdGlvbiBkYXRhIGlzIG5vdyBkZXByZWNhdGVkIGFuZFxuICAgICAqIHRoZSB0cmFuc2xhdGlvbiB0YWJsZSBoYXMgdG8gYmUgcmVjb21waWxlZCB3aXRoIHRoZSByZW1haW5pbmcgdHJhbnNsYXRpb24gcGFydHMuXG4gICAgICpcbiAgICAgKiBAdGhyb3dzIHtUeXBlRXJyb3J9IFRoZSBtZXRob2QgY291bGQgdGhyb3cgYSAqKlR5cGVFcnJvcioqIGlmIHlvdSBwYXNzIHNvbWUgcGFyYW0gb2YgdGhlXG4gICAgICogd3JvbmcgdHlwZS4gUGxlYXNlLCBub3RlIHRoYXQgdGhlIGBuYW1lYCBwYXJhbSBoYXMgdG8gYmUgYSBub24tZW1wdHkgKipzdHJpbmcqKiBhbmRcbiAgICAgKiB0aGUgYHJlbW92ZURhdGFgIHBhcmFtIGhhcyB0byBiZSBlaXRoZXIgKip1bmRlZmluZWQqKiBvciAqKmJvb2xlYW4qKi5cbiAgICAgKi9cbiAgICBzZXJ2aWNlLmRlbGV0ZVBhcnQgPSBmdW5jdGlvbihuYW1lLCByZW1vdmVEYXRhKSB7XG4gICAgICBpZiAoIWlzU3RyaW5nVmFsaWQobmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignQ291bGRuXFwndCBkZWxldGUgcGFydCwgZmlyc3QgYXJnIGhhcyB0byBiZSBzdHJpbmcnKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlbW92ZURhdGEgPT09IHVuZGVmaW5lZCkge1xuICAgICAgICByZW1vdmVEYXRhID0gZmFsc2U7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiByZW1vdmVEYXRhICE9PSAnYm9vbGVhbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcignSW52YWxpZCB0eXBlIG9mIGEgc2Vjb25kIGFyZ3VtZW50LCBhIGJvb2xlYW4gZXhwZWN0ZWQuJyk7XG4gICAgICB9XG5cbiAgICAgIGlmIChoYXNQYXJ0KG5hbWUpKSB7XG4gICAgICAgIHZhciB3YXNBY3RpdmUgPSBwYXJ0c1tuYW1lXS5pc0FjdGl2ZTtcbiAgICAgICAgaWYgKHJlbW92ZURhdGEpIHtcbiAgICAgICAgICB2YXIgJHRyYW5zbGF0ZSA9ICRpbmplY3Rvci5nZXQoJyR0cmFuc2xhdGUnKTtcbiAgICAgICAgICB2YXIgY2FjaGUgPSAkdHJhbnNsYXRlLmxvYWRlckNhY2hlKCk7XG4gICAgICAgICAgaWYgKHR5cGVvZihjYWNoZSkgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICAvLyBnZXR0aW5nIG9uLWRlbWFuZCBpbnN0YW5jZSBvZiBsb2FkZXJcbiAgICAgICAgICAgIGNhY2hlID0gJGluamVjdG9yLmdldChjYWNoZSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIC8vIFB1cmdpbmcgaXRlbXMgZnJvbSBjYWNoZS4uLlxuICAgICAgICAgIGlmICh0eXBlb2YoY2FjaGUpID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHBhcnRzW25hbWVdLnRhYmxlcywgZnVuY3Rpb24odmFsdWUsIGtleSkge1xuICAgICAgICAgICAgICAgIGNhY2hlLnJlbW92ZShwYXJ0c1tuYW1lXS5wYXJzZVVybChwYXJ0c1tuYW1lXS51cmxUZW1wbGF0ZSwga2V5KSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVsZXRlIHBhcnRzW25hbWVdO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHBhcnRzW25hbWVdLmlzQWN0aXZlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdhc0FjdGl2ZSkge1xuICAgICAgICAgICRyb290U2NvcGUuJGVtaXQoJyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyU3RydWN0dXJlQ2hhbmdlZCcsIG5hbWUpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHJldHVybiBzZXJ2aWNlO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyI2lzUGFydExvYWRlZFxuICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBDaGVja3MgaWYgdGhlIHJlZ2lzdGVyZWQgdHJhbnNsYXRpb24gcGFydCBpcyBsb2FkZWQgaW50byB0aGUgdHJhbnNsYXRpb24gdGFibGUuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBBIG5hbWUgb2YgdGhlIHBhcnRcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbGFuZyBBIGtleSBvZiB0aGUgbGFuZ3VhZ2VcbiAgICAgKlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSBSZXR1cm5zICoqdHJ1ZSoqIGlmIHRoZSB0cmFuc2xhdGlvbiBvZiB0aGUgcGFydCBpcyBsb2FkZWQgdG8gdGhlIHRyYW5zbGF0aW9uIHRhYmxlIGFuZCAqKmZhbHNlKiogaWYgbm90LlxuICAgICAqXG4gICAgICogQHRocm93cyB7VHlwZUVycm9yfSBUaGUgbWV0aG9kIGNvdWxkIHRocm93IGEgKipUeXBlRXJyb3IqKiBpZiB5b3UgcGFzcyB0aGUgcGFyYW0gb2YgdGhlIHdyb25nXG4gICAgICogdHlwZS4gUGxlYXNlLCBub3RlIHRoYXQgdGhlIGBuYW1lYCBhbmQgYGxhbmdgIHBhcmFtcyBoYXZlIHRvIGJlIG5vbi1lbXB0eSAqKnN0cmluZyoqLlxuICAgICAqL1xuICAgIHNlcnZpY2UuaXNQYXJ0TG9hZGVkID0gZnVuY3Rpb24obmFtZSwgbGFuZykge1xuICAgICAgcmV0dXJuIGFuZ3VsYXIuaXNEZWZpbmVkKHBhcnRzW25hbWVdKSAmJiBhbmd1bGFyLmlzRGVmaW5lZChwYXJ0c1tuYW1lXS50YWJsZXNbbGFuZ10pO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyI2dldFJlZ2lzdGVyZWRQYXJ0c1xuICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBHZXRzIG5hbWVzIG9mIHRoZSBwYXJ0cyB0aGF0IHdlcmUgYWRkZWQgd2l0aCB0aGUgYGFkZFBhcnRgLlxuICAgICAqXG4gICAgICogQHJldHVybnMge2FycmF5fSBSZXR1cm5zIGFycmF5IG9mIHJlZ2lzdGVyZWQgcGFydHMsIGlmIG5vbmUgd2VyZSByZWdpc3RlcmVkIHRoZW4gYW4gZW1wdHkgYXJyYXkgaXMgcmV0dXJuZWQuXG4gICAgICovXG4gICAgc2VydmljZS5nZXRSZWdpc3RlcmVkUGFydHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciByZWdpc3RlcmVkUGFydHMgPSBbXTtcbiAgICAgIGFuZ3VsYXIuZm9yRWFjaChwYXJ0cywgZnVuY3Rpb24ocCl7XG4gICAgICAgIGlmKHAuaXNBY3RpdmUpIHtcbiAgICAgICAgICByZWdpc3RlcmVkUGFydHMucHVzaChwLm5hbWUpO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIHJldHVybiByZWdpc3RlcmVkUGFydHM7XG4gICAgfTtcblxuXG5cbiAgICAvKipcbiAgICAgKiBAbmdkb2MgZnVuY3Rpb25cbiAgICAgKiBAbmFtZSBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyI2lzUGFydEF2YWlsYWJsZVxuICAgICAqIEBtZXRob2RPZiBwYXNjYWxwcmVjaHQudHJhbnNsYXRlLiR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyXG4gICAgICpcbiAgICAgKiBAZGVzY3JpcHRpb25cbiAgICAgKiBDaGVja3MgaWYgYSB0YXJnZXQgdHJhbnNsYXRpb24gcGFydCBpcyBhdmFpbGFibGUuIFRoZSBwYXJ0IGJlY29tZXMgYXZhaWxhYmxlIGp1c3QgYWZ0ZXIgaXQgd2FzXG4gICAgICogYWRkZWQgYnkgdGhlIGBhZGRQYXJ0YCBtZXRob2QuIFBhcnQncyBhdmFpbGFiaWxpdHkgZG9lcyBub3QgbWVhbiB0aGF0IGl0IHdhcyBsb2FkZWQgZnJvbSB0aGVcbiAgICAgKiBzZXJ2ZXIsIGJ1dCBvbmx5IHRoYXQgaXQgd2FzIGFkZGVkIHRvIHRoZSBsb2FkZXIuIFRoZSBhdmFpbGFibGUgcGFydCBtaWdodCBiZSBsb2FkZWQgbmV4dFxuICAgICAqIHRpbWUgdGhlIGxvYWRlciBpcyBjYWxsZWQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBBIG5hbWUgb2YgdGhlIHBhcnQgdG8gZGVsZXRlXG4gICAgICpcbiAgICAgKiBAcmV0dXJucyB7Ym9vbGVhbn0gUmV0dXJucyAqKnRydWUqKiBpZiB0aGUgcGFydCBpcyBhdmFpbGFibGUgbm93IGFuZCAqKmZhbHNlKiogaWYgbm90LlxuICAgICAqXG4gICAgICogQHRocm93cyB7VHlwZUVycm9yfSBUaGUgbWV0aG9kIGNvdWxkIHRocm93IGEgKipUeXBlRXJyb3IqKiBpZiB5b3UgcGFzcyB0aGUgcGFyYW0gb2YgdGhlIHdyb25nXG4gICAgICogdHlwZS4gUGxlYXNlLCBub3RlIHRoYXQgdGhlIGBuYW1lYCBwYXJhbSBoYXMgdG8gYmUgYSBub24tZW1wdHkgKipzdHJpbmcqKi5cbiAgICAgKi9cbiAgICBzZXJ2aWNlLmlzUGFydEF2YWlsYWJsZSA9IGlzUGFydEF2YWlsYWJsZTtcblxuICAgIHJldHVybiBzZXJ2aWNlO1xuXG4gIH1dO1xuXG59KTtcbnJldHVybiAncGFzY2FscHJlY2h0LnRyYW5zbGF0ZSc7XG5cbn0pKTtcbiIsIi8qISBcbiAqIGFuZ3VsYXItbG9hZGluZy1iYXIgdjAuNy4xXG4gKiBodHRwczovL2NoaWVmZmFuY3lwYW50cy5naXRodWIuaW8vYW5ndWxhci1sb2FkaW5nLWJhclxuICogQ29weXJpZ2h0IChjKSAyMDE1IFdlcyBDcnV2ZXJcbiAqIExpY2Vuc2U6IE1JVFxuICovXG4vKlxuICogYW5ndWxhci1sb2FkaW5nLWJhclxuICpcbiAqIGludGVyY2VwdHMgWEhSIHJlcXVlc3RzIGFuZCBjcmVhdGVzIGEgbG9hZGluZyBiYXIuXG4gKiBCYXNlZCBvbiB0aGUgZXhjZWxsZW50IG5wcm9ncmVzcyB3b3JrIGJ5IHJzdGFjcnV6IChtb3JlIGluZm8gaW4gcmVhZG1lKVxuICpcbiAqIChjKSAyMDEzIFdlcyBDcnV2ZXJcbiAqIExpY2Vuc2U6IE1JVFxuICovXG5cblxuKGZ1bmN0aW9uKCkge1xuXG4ndXNlIHN0cmljdCc7XG5cbi8vIEFsaWFzIHRoZSBsb2FkaW5nIGJhciBmb3IgdmFyaW91cyBiYWNrd2FyZHMgY29tcGF0aWJpbGl0aWVzIHNpbmNlIHRoZSBwcm9qZWN0IGhhcyBtYXR1cmVkOlxuYW5ndWxhci5tb2R1bGUoJ2FuZ3VsYXItbG9hZGluZy1iYXInLCBbJ2NmcC5sb2FkaW5nQmFySW50ZXJjZXB0b3InXSk7XG5hbmd1bGFyLm1vZHVsZSgnY2hpZWZmYW5jeXBhbnRzLmxvYWRpbmdCYXInLCBbJ2NmcC5sb2FkaW5nQmFySW50ZXJjZXB0b3InXSk7XG5cblxuLyoqXG4gKiBsb2FkaW5nQmFySW50ZXJjZXB0b3Igc2VydmljZVxuICpcbiAqIFJlZ2lzdGVycyBpdHNlbGYgYXMgYW4gQW5ndWxhciBpbnRlcmNlcHRvciBhbmQgbGlzdGVucyBmb3IgWEhSIHJlcXVlc3RzLlxuICovXG5hbmd1bGFyLm1vZHVsZSgnY2ZwLmxvYWRpbmdCYXJJbnRlcmNlcHRvcicsIFsnY2ZwLmxvYWRpbmdCYXInXSlcbiAgLmNvbmZpZyhbJyRodHRwUHJvdmlkZXInLCBmdW5jdGlvbiAoJGh0dHBQcm92aWRlcikge1xuXG4gICAgdmFyIGludGVyY2VwdG9yID0gWyckcScsICckY2FjaGVGYWN0b3J5JywgJyR0aW1lb3V0JywgJyRyb290U2NvcGUnLCAnJGxvZycsICdjZnBMb2FkaW5nQmFyJywgZnVuY3Rpb24gKCRxLCAkY2FjaGVGYWN0b3J5LCAkdGltZW91dCwgJHJvb3RTY29wZSwgJGxvZywgY2ZwTG9hZGluZ0Jhcikge1xuXG4gICAgICAvKipcbiAgICAgICAqIFRoZSB0b3RhbCBudW1iZXIgb2YgcmVxdWVzdHMgbWFkZVxuICAgICAgICovXG4gICAgICB2YXIgcmVxc1RvdGFsID0gMDtcblxuICAgICAgLyoqXG4gICAgICAgKiBUaGUgbnVtYmVyIG9mIHJlcXVlc3RzIGNvbXBsZXRlZCAoZWl0aGVyIHN1Y2Nlc3NmdWxseSBvciBub3QpXG4gICAgICAgKi9cbiAgICAgIHZhciByZXFzQ29tcGxldGVkID0gMDtcblxuICAgICAgLyoqXG4gICAgICAgKiBUaGUgYW1vdW50IG9mIHRpbWUgc3BlbnQgZmV0Y2hpbmcgYmVmb3JlIHNob3dpbmcgdGhlIGxvYWRpbmcgYmFyXG4gICAgICAgKi9cbiAgICAgIHZhciBsYXRlbmN5VGhyZXNob2xkID0gY2ZwTG9hZGluZ0Jhci5sYXRlbmN5VGhyZXNob2xkO1xuXG4gICAgICAvKipcbiAgICAgICAqICR0aW1lb3V0IGhhbmRsZSBmb3IgbGF0ZW5jeVRocmVzaG9sZFxuICAgICAgICovXG4gICAgICB2YXIgc3RhcnRUaW1lb3V0O1xuXG5cbiAgICAgIC8qKlxuICAgICAgICogY2FsbHMgY2ZwTG9hZGluZ0Jhci5jb21wbGV0ZSgpIHdoaWNoIHJlbW92ZXMgdGhlXG4gICAgICAgKiBsb2FkaW5nIGJhciBmcm9tIHRoZSBET00uXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIHNldENvbXBsZXRlKCkge1xuICAgICAgICAkdGltZW91dC5jYW5jZWwoc3RhcnRUaW1lb3V0KTtcbiAgICAgICAgY2ZwTG9hZGluZ0Jhci5jb21wbGV0ZSgpO1xuICAgICAgICByZXFzQ29tcGxldGVkID0gMDtcbiAgICAgICAgcmVxc1RvdGFsID0gMDtcbiAgICAgIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBEZXRlcm1pbmUgaWYgdGhlIHJlc3BvbnNlIGhhcyBhbHJlYWR5IGJlZW4gY2FjaGVkXG4gICAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICBjb25maWcgdGhlIGNvbmZpZyBvcHRpb24gZnJvbSB0aGUgcmVxdWVzdFxuICAgICAgICogQHJldHVybiB7Qm9vbGVhbn0gcmV0cm5zIHRydWUgaWYgY2FjaGVkLCBvdGhlcndpc2UgZmFsc2VcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gaXNDYWNoZWQoY29uZmlnKSB7XG4gICAgICAgIHZhciBjYWNoZTtcbiAgICAgICAgdmFyIGRlZmF1bHRDYWNoZSA9ICRjYWNoZUZhY3RvcnkuZ2V0KCckaHR0cCcpO1xuICAgICAgICB2YXIgZGVmYXVsdHMgPSAkaHR0cFByb3ZpZGVyLmRlZmF1bHRzO1xuXG4gICAgICAgIC8vIENob29zZSB0aGUgcHJvcGVyIGNhY2hlIHNvdXJjZS4gQm9ycm93ZWQgZnJvbSBhbmd1bGFyOiAkaHR0cCBzZXJ2aWNlXG4gICAgICAgIGlmICgoY29uZmlnLmNhY2hlIHx8IGRlZmF1bHRzLmNhY2hlKSAmJiBjb25maWcuY2FjaGUgIT09IGZhbHNlICYmXG4gICAgICAgICAgKGNvbmZpZy5tZXRob2QgPT09ICdHRVQnIHx8IGNvbmZpZy5tZXRob2QgPT09ICdKU09OUCcpKSB7XG4gICAgICAgICAgICBjYWNoZSA9IGFuZ3VsYXIuaXNPYmplY3QoY29uZmlnLmNhY2hlKSA/IGNvbmZpZy5jYWNoZVxuICAgICAgICAgICAgICA6IGFuZ3VsYXIuaXNPYmplY3QoZGVmYXVsdHMuY2FjaGUpID8gZGVmYXVsdHMuY2FjaGVcbiAgICAgICAgICAgICAgOiBkZWZhdWx0Q2FjaGU7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgY2FjaGVkID0gY2FjaGUgIT09IHVuZGVmaW5lZCA/XG4gICAgICAgICAgY2FjaGUuZ2V0KGNvbmZpZy51cmwpICE9PSB1bmRlZmluZWQgOiBmYWxzZTtcblxuICAgICAgICBpZiAoY29uZmlnLmNhY2hlZCAhPT0gdW5kZWZpbmVkICYmIGNhY2hlZCAhPT0gY29uZmlnLmNhY2hlZCkge1xuICAgICAgICAgIHJldHVybiBjb25maWcuY2FjaGVkO1xuICAgICAgICB9XG4gICAgICAgIGNvbmZpZy5jYWNoZWQgPSBjYWNoZWQ7XG4gICAgICAgIHJldHVybiBjYWNoZWQ7XG4gICAgICB9XG5cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbihjb25maWcpIHtcbiAgICAgICAgICAvLyBDaGVjayB0byBtYWtlIHN1cmUgdGhpcyByZXF1ZXN0IGhhc24ndCBhbHJlYWR5IGJlZW4gY2FjaGVkIGFuZCB0aGF0XG4gICAgICAgICAgLy8gdGhlIHJlcXVlc3RlciBkaWRuJ3QgZXhwbGljaXRseSBhc2sgdXMgdG8gaWdub3JlIHRoaXMgcmVxdWVzdDpcbiAgICAgICAgICBpZiAoIWNvbmZpZy5pZ25vcmVMb2FkaW5nQmFyICYmICFpc0NhY2hlZChjb25maWcpKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NmcExvYWRpbmdCYXI6bG9hZGluZycsIHt1cmw6IGNvbmZpZy51cmx9KTtcbiAgICAgICAgICAgIGlmIChyZXFzVG90YWwgPT09IDApIHtcbiAgICAgICAgICAgICAgc3RhcnRUaW1lb3V0ID0gJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgY2ZwTG9hZGluZ0Jhci5zdGFydCgpO1xuICAgICAgICAgICAgICB9LCBsYXRlbmN5VGhyZXNob2xkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlcXNUb3RhbCsrO1xuICAgICAgICAgICAgY2ZwTG9hZGluZ0Jhci5zZXQocmVxc0NvbXBsZXRlZCAvIHJlcXNUb3RhbCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgIH0sXG5cbiAgICAgICAgJ3Jlc3BvbnNlJzogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICBpZiAoIXJlc3BvbnNlIHx8ICFyZXNwb25zZS5jb25maWcpIHtcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Jyb2tlbiBpbnRlcmNlcHRvciBkZXRlY3RlZDogQ29uZmlnIG9iamVjdCBub3Qgc3VwcGxpZWQgaW4gcmVzcG9uc2U6XFxuIGh0dHBzOi8vZ2l0aHViLmNvbS9jaGllZmZhbmN5cGFudHMvYW5ndWxhci1sb2FkaW5nLWJhci9wdWxsLzUwJyk7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2U7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKCFyZXNwb25zZS5jb25maWcuaWdub3JlTG9hZGluZ0JhciAmJiAhaXNDYWNoZWQocmVzcG9uc2UuY29uZmlnKSkge1xuICAgICAgICAgICAgcmVxc0NvbXBsZXRlZCsrO1xuICAgICAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdjZnBMb2FkaW5nQmFyOmxvYWRlZCcsIHt1cmw6IHJlc3BvbnNlLmNvbmZpZy51cmwsIHJlc3VsdDogcmVzcG9uc2V9KTtcbiAgICAgICAgICAgIGlmIChyZXFzQ29tcGxldGVkID49IHJlcXNUb3RhbCkge1xuICAgICAgICAgICAgICBzZXRDb21wbGV0ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY2ZwTG9hZGluZ0Jhci5zZXQocmVxc0NvbXBsZXRlZCAvIHJlcXNUb3RhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiByZXNwb25zZTtcbiAgICAgICAgfSxcblxuICAgICAgICAncmVzcG9uc2VFcnJvcic6IGZ1bmN0aW9uKHJlamVjdGlvbikge1xuICAgICAgICAgIGlmICghcmVqZWN0aW9uIHx8ICFyZWplY3Rpb24uY29uZmlnKSB7XG4gICAgICAgICAgICAkbG9nLmVycm9yKCdCcm9rZW4gaW50ZXJjZXB0b3IgZGV0ZWN0ZWQ6IENvbmZpZyBvYmplY3Qgbm90IHN1cHBsaWVkIGluIHJlamVjdGlvbjpcXG4gaHR0cHM6Ly9naXRodWIuY29tL2NoaWVmZmFuY3lwYW50cy9hbmd1bGFyLWxvYWRpbmctYmFyL3B1bGwvNTAnKTtcbiAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBpZiAoIXJlamVjdGlvbi5jb25maWcuaWdub3JlTG9hZGluZ0JhciAmJiAhaXNDYWNoZWQocmVqZWN0aW9uLmNvbmZpZykpIHtcbiAgICAgICAgICAgIHJlcXNDb21wbGV0ZWQrKztcbiAgICAgICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnY2ZwTG9hZGluZ0Jhcjpsb2FkZWQnLCB7dXJsOiByZWplY3Rpb24uY29uZmlnLnVybCwgcmVzdWx0OiByZWplY3Rpb259KTtcbiAgICAgICAgICAgIGlmIChyZXFzQ29tcGxldGVkID49IHJlcXNUb3RhbCkge1xuICAgICAgICAgICAgICBzZXRDb21wbGV0ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY2ZwTG9hZGluZ0Jhci5zZXQocmVxc0NvbXBsZXRlZCAvIHJlcXNUb3RhbCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVqZWN0aW9uKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XTtcblxuICAgICRodHRwUHJvdmlkZXIuaW50ZXJjZXB0b3JzLnB1c2goaW50ZXJjZXB0b3IpO1xuICB9XSk7XG5cblxuLyoqXG4gKiBMb2FkaW5nIEJhclxuICpcbiAqIFRoaXMgc2VydmljZSBoYW5kbGVzIGFkZGluZyBhbmQgcmVtb3ZpbmcgdGhlIGFjdHVhbCBlbGVtZW50IGluIHRoZSBET00uXG4gKiBHZW5lcmFsbHksIGJlc3QgcHJhY3RpY2VzIGZvciBET00gbWFuaXB1bGF0aW9uIGlzIHRvIHRha2UgcGxhY2UgaW4gYVxuICogZGlyZWN0aXZlLCBidXQgYmVjYXVzZSB0aGUgZWxlbWVudCBpdHNlbGYgaXMgaW5qZWN0ZWQgaW4gdGhlIERPTSBvbmx5IHVwb25cbiAqIFhIUiByZXF1ZXN0cywgYW5kIGl0J3MgbGlrZWx5IG5lZWRlZCBvbiBldmVyeSB2aWV3LCB0aGUgYmVzdCBvcHRpb24gaXMgdG9cbiAqIHVzZSBhIHNlcnZpY2UuXG4gKi9cbmFuZ3VsYXIubW9kdWxlKCdjZnAubG9hZGluZ0JhcicsIFtdKVxuICAucHJvdmlkZXIoJ2NmcExvYWRpbmdCYXInLCBmdW5jdGlvbigpIHtcblxuICAgIHRoaXMuaW5jbHVkZVNwaW5uZXIgPSB0cnVlO1xuICAgIHRoaXMuaW5jbHVkZUJhciA9IHRydWU7XG4gICAgdGhpcy5sYXRlbmN5VGhyZXNob2xkID0gMTAwO1xuICAgIHRoaXMuc3RhcnRTaXplID0gMC4wMjtcbiAgICB0aGlzLnBhcmVudFNlbGVjdG9yID0gJ2JvZHknO1xuICAgIHRoaXMuc3Bpbm5lclRlbXBsYXRlID0gJzxkaXYgaWQ9XCJsb2FkaW5nLWJhci1zcGlubmVyXCI+PGRpdiBjbGFzcz1cInNwaW5uZXItaWNvblwiPjwvZGl2PjwvZGl2Pic7XG4gICAgdGhpcy5sb2FkaW5nQmFyVGVtcGxhdGUgPSAnPGRpdiBpZD1cImxvYWRpbmctYmFyXCI+PGRpdiBjbGFzcz1cImJhclwiPjxkaXYgY2xhc3M9XCJwZWdcIj48L2Rpdj48L2Rpdj48L2Rpdj4nO1xuXG4gICAgdGhpcy4kZ2V0ID0gWyckaW5qZWN0b3InLCAnJGRvY3VtZW50JywgJyR0aW1lb3V0JywgJyRyb290U2NvcGUnLCBmdW5jdGlvbiAoJGluamVjdG9yLCAkZG9jdW1lbnQsICR0aW1lb3V0LCAkcm9vdFNjb3BlKSB7XG4gICAgICB2YXIgJGFuaW1hdGU7XG4gICAgICB2YXIgJHBhcmVudFNlbGVjdG9yID0gdGhpcy5wYXJlbnRTZWxlY3RvcixcbiAgICAgICAgbG9hZGluZ0JhckNvbnRhaW5lciA9IGFuZ3VsYXIuZWxlbWVudCh0aGlzLmxvYWRpbmdCYXJUZW1wbGF0ZSksXG4gICAgICAgIGxvYWRpbmdCYXIgPSBsb2FkaW5nQmFyQ29udGFpbmVyLmZpbmQoJ2RpdicpLmVxKDApLFxuICAgICAgICBzcGlubmVyID0gYW5ndWxhci5lbGVtZW50KHRoaXMuc3Bpbm5lclRlbXBsYXRlKTtcblxuICAgICAgdmFyIGluY1RpbWVvdXQsXG4gICAgICAgIGNvbXBsZXRlVGltZW91dCxcbiAgICAgICAgc3RhcnRlZCA9IGZhbHNlLFxuICAgICAgICBzdGF0dXMgPSAwO1xuXG4gICAgICB2YXIgaW5jbHVkZVNwaW5uZXIgPSB0aGlzLmluY2x1ZGVTcGlubmVyO1xuICAgICAgdmFyIGluY2x1ZGVCYXIgPSB0aGlzLmluY2x1ZGVCYXI7XG4gICAgICB2YXIgc3RhcnRTaXplID0gdGhpcy5zdGFydFNpemU7XG5cbiAgICAgIC8qKlxuICAgICAgICogSW5zZXJ0cyB0aGUgbG9hZGluZyBiYXIgZWxlbWVudCBpbnRvIHRoZSBkb20sIGFuZCBzZXRzIGl0IHRvIDIlXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIF9zdGFydCgpIHtcbiAgICAgICAgaWYgKCEkYW5pbWF0ZSkge1xuICAgICAgICAgICRhbmltYXRlID0gJGluamVjdG9yLmdldCgnJGFuaW1hdGUnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciAkcGFyZW50ID0gJGRvY3VtZW50LmZpbmQoJHBhcmVudFNlbGVjdG9yKS5lcSgwKTtcbiAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGNvbXBsZXRlVGltZW91dCk7XG5cbiAgICAgICAgLy8gZG8gbm90IGNvbnRpbnVhbGx5IGJyb2FkY2FzdCB0aGUgc3RhcnRlZCBldmVudDpcbiAgICAgICAgaWYgKHN0YXJ0ZWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cblxuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NmcExvYWRpbmdCYXI6c3RhcnRlZCcpO1xuICAgICAgICBzdGFydGVkID0gdHJ1ZTtcblxuICAgICAgICBpZiAoaW5jbHVkZUJhcikge1xuICAgICAgICAgICRhbmltYXRlLmVudGVyKGxvYWRpbmdCYXJDb250YWluZXIsICRwYXJlbnQsIGFuZ3VsYXIuZWxlbWVudCgkcGFyZW50WzBdLmxhc3RDaGlsZCkpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKGluY2x1ZGVTcGlubmVyKSB7XG4gICAgICAgICAgJGFuaW1hdGUuZW50ZXIoc3Bpbm5lciwgJHBhcmVudCwgYW5ndWxhci5lbGVtZW50KCRwYXJlbnRbMF0ubGFzdENoaWxkKSk7XG4gICAgICAgIH1cblxuICAgICAgICBfc2V0KHN0YXJ0U2l6ZSk7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogU2V0IHRoZSBsb2FkaW5nIGJhcidzIHdpZHRoIHRvIGEgY2VydGFpbiBwZXJjZW50LlxuICAgICAgICpcbiAgICAgICAqIEBwYXJhbSBuIGFueSB2YWx1ZSBiZXR3ZWVuIDAgYW5kIDFcbiAgICAgICAqL1xuICAgICAgZnVuY3Rpb24gX3NldChuKSB7XG4gICAgICAgIGlmICghc3RhcnRlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcGN0ID0gKG4gKiAxMDApICsgJyUnO1xuICAgICAgICBsb2FkaW5nQmFyLmNzcygnd2lkdGgnLCBwY3QpO1xuICAgICAgICBzdGF0dXMgPSBuO1xuXG4gICAgICAgIC8vIGluY3JlbWVudCBsb2FkaW5nYmFyIHRvIGdpdmUgdGhlIGlsbHVzaW9uIHRoYXQgdGhlcmUgaXMgYWx3YXlzXG4gICAgICAgIC8vIHByb2dyZXNzIGJ1dCBtYWtlIHN1cmUgdG8gY2FuY2VsIHRoZSBwcmV2aW91cyB0aW1lb3V0cyBzbyB3ZSBkb24ndFxuICAgICAgICAvLyBoYXZlIG11bHRpcGxlIGluY3MgcnVubmluZyBhdCB0aGUgc2FtZSB0aW1lLlxuICAgICAgICAkdGltZW91dC5jYW5jZWwoaW5jVGltZW91dCk7XG4gICAgICAgIGluY1RpbWVvdXQgPSAkdGltZW91dChmdW5jdGlvbigpIHtcbiAgICAgICAgICBfaW5jKCk7XG4gICAgICAgIH0sIDI1MCk7XG4gICAgICB9XG5cbiAgICAgIC8qKlxuICAgICAgICogSW5jcmVtZW50cyB0aGUgbG9hZGluZyBiYXIgYnkgYSByYW5kb20gYW1vdW50XG4gICAgICAgKiBidXQgc2xvd3MgZG93biBhcyBpdCBwcm9ncmVzc2VzXG4gICAgICAgKi9cbiAgICAgIGZ1bmN0aW9uIF9pbmMoKSB7XG4gICAgICAgIGlmIChfc3RhdHVzKCkgPj0gMSkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHZhciBybmQgPSAwO1xuXG4gICAgICAgIC8vIFRPRE86IGRvIHRoaXMgbWF0aG1hdGljYWxseSBpbnN0ZWFkIG9mIHRocm91Z2ggY29uZGl0aW9uc1xuXG4gICAgICAgIHZhciBzdGF0ID0gX3N0YXR1cygpO1xuICAgICAgICBpZiAoc3RhdCA+PSAwICYmIHN0YXQgPCAwLjI1KSB7XG4gICAgICAgICAgLy8gU3RhcnQgb3V0IGJldHdlZW4gMyAtIDYlIGluY3JlbWVudHNcbiAgICAgICAgICBybmQgPSAoTWF0aC5yYW5kb20oKSAqICg1IC0gMyArIDEpICsgMykgLyAxMDA7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdCA+PSAwLjI1ICYmIHN0YXQgPCAwLjY1KSB7XG4gICAgICAgICAgLy8gaW5jcmVtZW50IGJldHdlZW4gMCAtIDMlXG4gICAgICAgICAgcm5kID0gKE1hdGgucmFuZG9tKCkgKiAzKSAvIDEwMDtcbiAgICAgICAgfSBlbHNlIGlmIChzdGF0ID49IDAuNjUgJiYgc3RhdCA8IDAuOSkge1xuICAgICAgICAgIC8vIGluY3JlbWVudCBiZXR3ZWVuIDAgLSAyJVxuICAgICAgICAgIHJuZCA9IChNYXRoLnJhbmRvbSgpICogMikgLyAxMDA7XG4gICAgICAgIH0gZWxzZSBpZiAoc3RhdCA+PSAwLjkgJiYgc3RhdCA8IDAuOTkpIHtcbiAgICAgICAgICAvLyBmaW5hbGx5LCBpbmNyZW1lbnQgaXQgLjUgJVxuICAgICAgICAgIHJuZCA9IDAuMDA1O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGFmdGVyIDk5JSwgZG9uJ3QgaW5jcmVtZW50OlxuICAgICAgICAgIHJuZCA9IDA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgcGN0ID0gX3N0YXR1cygpICsgcm5kO1xuICAgICAgICBfc2V0KHBjdCk7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIF9zdGF0dXMoKSB7XG4gICAgICAgIHJldHVybiBzdGF0dXM7XG4gICAgICB9XG5cbiAgICAgIGZ1bmN0aW9uIF9jb21wbGV0ZUFuaW1hdGlvbigpIHtcbiAgICAgICAgc3RhdHVzID0gMDtcbiAgICAgICAgc3RhcnRlZCA9IGZhbHNlO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBfY29tcGxldGUoKSB7XG4gICAgICAgIGlmICghJGFuaW1hdGUpIHtcbiAgICAgICAgICAkYW5pbWF0ZSA9ICRpbmplY3Rvci5nZXQoJyRhbmltYXRlJyk7XG4gICAgICAgIH1cblxuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2NmcExvYWRpbmdCYXI6Y29tcGxldGVkJyk7XG4gICAgICAgIF9zZXQoMSk7XG5cbiAgICAgICAgJHRpbWVvdXQuY2FuY2VsKGNvbXBsZXRlVGltZW91dCk7XG5cbiAgICAgICAgLy8gQXR0ZW1wdCB0byBhZ2dyZWdhdGUgYW55IHN0YXJ0L2NvbXBsZXRlIGNhbGxzIHdpdGhpbiA1MDBtczpcbiAgICAgICAgY29tcGxldGVUaW1lb3V0ID0gJHRpbWVvdXQoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIHByb21pc2UgPSAkYW5pbWF0ZS5sZWF2ZShsb2FkaW5nQmFyQ29udGFpbmVyLCBfY29tcGxldGVBbmltYXRpb24pO1xuICAgICAgICAgIGlmIChwcm9taXNlICYmIHByb21pc2UudGhlbikge1xuICAgICAgICAgICAgcHJvbWlzZS50aGVuKF9jb21wbGV0ZUFuaW1hdGlvbik7XG4gICAgICAgICAgfVxuICAgICAgICAgICRhbmltYXRlLmxlYXZlKHNwaW5uZXIpO1xuICAgICAgICB9LCA1MDApO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGFydCAgICAgICAgICAgIDogX3N0YXJ0LFxuICAgICAgICBzZXQgICAgICAgICAgICAgIDogX3NldCxcbiAgICAgICAgc3RhdHVzICAgICAgICAgICA6IF9zdGF0dXMsXG4gICAgICAgIGluYyAgICAgICAgICAgICAgOiBfaW5jLFxuICAgICAgICBjb21wbGV0ZSAgICAgICAgIDogX2NvbXBsZXRlLFxuICAgICAgICBpbmNsdWRlU3Bpbm5lciAgIDogdGhpcy5pbmNsdWRlU3Bpbm5lcixcbiAgICAgICAgbGF0ZW5jeVRocmVzaG9sZCA6IHRoaXMubGF0ZW5jeVRocmVzaG9sZCxcbiAgICAgICAgcGFyZW50U2VsZWN0b3IgICA6IHRoaXMucGFyZW50U2VsZWN0b3IsXG4gICAgICAgIHN0YXJ0U2l6ZSAgICAgICAgOiB0aGlzLnN0YXJ0U2l6ZVxuICAgICAgfTtcblxuXG4gICAgfV07ICAgICAvL1xuICB9KTsgICAgICAgLy8gd3RmIGphdmFzY3JpcHQuIHNyc2x5XG59KSgpOyAgICAgICAvL1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXV0aCcsIFtdKS5cbiAgICBzZXJ2aWNlKCdUb2tlblNlcnZpY2UnLCBbJyRyb290U2NvcGUnLCBmdW5jdGlvbigkcm9vdFNjb3BlKSB7XG4gICAgICAgIGZ1bmN0aW9uIHVybEJhc2U2NERlY29kZShzdHIpIHtcbiAgICAgICAgICAgIHZhciBvdXRwdXQgPSBzdHIucmVwbGFjZSgnLScsICcrJykucmVwbGFjZSgnXycsICcvJyk7XG5cbiAgICAgICAgICAgIHN3aXRjaCAob3V0cHV0Lmxlbmd0aCAlIDQpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ICs9ICc9PSc7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgMzpcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0ICs9ICc9JztcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgJ0lsbGVnYWwgYmFzZTY0dXJsIHN0cmluZyEnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5hdG9iKG91dHB1dCk7XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBnZXRUb2tlbkNsYWltcyh0b2tlbikge1xuICAgICAgICAgICAgdmFyIGNsYWltcyA9IHt9O1xuXG4gICAgICAgICAgICBpZih0b2tlbiAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGVuY29kZWQgPSB0b2tlbi5zcGxpdCgnLicpWzFdO1xuICAgICAgICAgICAgICAgICAgICBjbGFpbXMgPSBKU09OLnBhcnNlKHVybEJhc2U2NERlY29kZShlbmNvZGVkKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gY2xhaW1zO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gaXNUb2tlblZhbGlkKCkge1xuICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS50b2tlbiAhPSBudWxsICYmICRyb290U2NvcGUudG9rZW5DbGFpbXMgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgIG5ldyBEYXRlKCkuZ2V0VGltZSgpIDw9ICgkcm9vdFNjb3BlLnRva2VuQ2xhaW1zLmV4cCkgKiAxMDAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH07XG5cbiAgICAgICAgdGhpcy5zZXRUb2tlbiA9IGZ1bmN0aW9uKHRva2VuKSB7XG4gICAgICAgICAgICBpZih0b2tlbikge1xuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS50b2tlbiA9IHRva2VuO1xuICAgICAgICAgICAgICAgICRyb290U2NvcGUudG9rZW5DbGFpbXMgPSBnZXRUb2tlbkNsYWltcyh0b2tlbik7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS50b2tlbiA9IHRva2VuO1xuICAgICAgICAgICAgICAgIGlmKGlzVG9rZW5WYWxpZCgpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkZWxldGUgbG9jYWxTdG9yYWdlLnRva2VuO1xuICAgICAgICAgICAgZGVsZXRlICRyb290U2NvcGUudG9rZW5DbGFpbXM7XG4gICAgICAgICAgICBkZWxldGUgJHJvb3RTY29wZS50b2tlbjtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLmdldFRva2VuID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoaXNUb2tlblZhbGlkKCkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLnRva2VuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5zZXRUb2tlbihudWxsKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuXG4gICAgICAgIHRoaXMuaGFzUGVybWlzc2lvbiA9IGZ1bmN0aW9uKHJlc291cmNlKSB7XG4gICAgICAgICAgICAvLyBUT0RPOiBpbXBsZW1lbnRcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLm5lZWRzUmVmcmVzaCA9IGZ1bmN0aW9uKGFnZSkge1xuICAgICAgICAgICAgaWYgKGxvY2FsU3RvcmFnZS50b2tlbiAhPSBudWxsICYmICRyb290U2NvcGUudG9rZW5DbGFpbXMgIT0gbnVsbCAmJlxuICAgICAgICAgICAgICAgIG5ldyBEYXRlKCkuZ2V0VGltZSgpID49ICRyb290U2NvcGUudG9rZW5DbGFpbXMuaWF0ICogMTAwMCArIGFnZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9O1xuICAgIH1dKS5cbiAgICBzZXJ2aWNlKCdBdXRoU2VydmljZScsIFsnJGh0dHAnLCAndXJscycsIGZ1bmN0aW9uICgkaHR0cCwgdXJscykge1xuICAgICAgICB0aGlzLnNpZ251cCA9IGZ1bmN0aW9uIChkYXRhLCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICAgICAgJGh0dHAucG9zdCh1cmxzLkJBU0VfQVBJICsgJy9zaWdudXAnLCBkYXRhKS5zdWNjZXNzKHN1Y2Nlc3MpLmVycm9yKGVycm9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5zaWduaW4gPSBmdW5jdGlvbiAoZGF0YSwgc3VjY2VzcywgZXJyb3IpIHtcbiAgICAgICAgICAgICRodHRwLnBvc3QodXJscy5CQVNFX0FQSSArICcvc2lnbmluJywgZGF0YSkuc3VjY2VzcyhzdWNjZXNzKS5lcnJvcihlcnJvcik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucmVmcmVzaCA9IGZ1bmN0aW9uKHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgICAgICAkaHR0cC5nZXQodXJscy5CQVNFX0FQSSArICcvdG9rZW4tcmVmcmVzaCcsIHtpZ25vcmVMb2FkaW5nQmFyOiB0cnVlfSkuc3VjY2VzcyhzdWNjZXNzKS5lcnJvcihlcnJvcik7XG4gICAgICAgIH07XG4gICAgICAgIHRoaXMubG9nb3V0ID0gZnVuY3Rpb24gKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIHN1Y2Nlc3MoKTsgLy8gVE9ETzogY2FsbCBhIHJlbW90ZSBzZXJ2aWNlIHRvIGNsZWFuIHVwIHRva2VucyBhbmQgd2hhdCBub3RcbiAgICAgICAgfTtcbiAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2VhcmNoJywgW10pLlxuICAgIHNlcnZpY2UoJ1NlYXJjaFNlcnZpY2UnLCBbJyRodHRwJywgJ3VybHMnLCBmdW5jdGlvbiAoJGh0dHAsIHVybHMpIHtcbiAgICAgICAgdGhpcy5zZWFyY2ggPSBmdW5jdGlvbihkYXRhLCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICAgICAgJGh0dHAucG9zdCh1cmxzLkJBU0VfQVBJICsgJy9zZWFyY2gnLCBkYXRhKS5zdWNjZXNzKHN1Y2Nlc3MpLmVycm9yKGVycm9yKTtcbiAgICAgICAgfTtcbiAgICAgICAgdGhpcy5hZHZhbmNlZFNlYXJjaCA9IGZ1bmN0aW9uKGRhdGEsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgICAgICAkaHR0cC5wb3N0KHVybHMuQkFTRV9BUEkgKyAnL3NlYXJjaC9hZHZhbmNlZCcsIGRhdGEpLnN1Y2Nlc3Moc3VjY2VzcykuZXJyb3IoZXJyb3IpO1xuICAgICAgICB9O1xuICAgIH1dKTtcbn0pKCk7XG4iLCIoZnVuY3Rpb24gKCkge1xuICAgICd1c2Ugc3RyaWN0JztcblxuICAgIGFuZ3VsYXIubW9kdWxlKCd2ZWhpY2xlcycsIFtdKS5cbiAgICBmYWN0b3J5KCdWZWhpY2xlJywgWyckcmVzb3VyY2UnLCAndXJscycsIGZ1bmN0aW9uKCRyZXNvdXJjZSwgdXJscykge1xuICAgICAgICByZXR1cm4gJHJlc291cmNlKHVybHMuQkFTRV9BUEkgKyAnL3ZlaGljbGUvOnZlaGljbGVJZC86YWN0aW9uJywge1xuICAgICAgICAgICAgdmVoaWNsZUlkOiBcIkB2ZWhpY2xlSWRcIixcbiAgICAgICAgICAgIGFjdGlvbjogXCJAYWN0aW9uXCJcbiAgICAgICAgfSwge1xuICAgICAgICAgICAgcHJldmlldzoge1xuICAgICAgICAgICAgICAgIG1ldGhvZDogXCJHRVRcIixcbiAgICAgICAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uOiBcInByZXZpZXdcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfV0pLlxuICAgIHNlcnZpY2UoJ1ZlaGljbGVzU2VydmljZScsIFsnJGh0dHAnLCAnVmVoaWNsZScsIGZ1bmN0aW9uICgkaHR0cCwgVmVoaWNsZSkge1xuICAgICAgICB0aGlzLmdldCA9IGZ1bmN0aW9uKHZlY2hpY2xlSWQsIHN1Y2Nlc3MsIGVycm9yKSB7XG4gICAgICAgICAgICB2YXIgdmVoaWNsZSA9IFZlaGljbGUuZ2V0KHt2ZWhpY2xlSWQ6IHZlY2hpY2xlSWR9LFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzKHZlaGljbGUpO1xuICAgICAgICAgICAgICAgIH0sIGVycm9yKTtcbiAgICAgICAgfTtcblxuICAgICAgICB0aGlzLnByZXZpZXcgPSBmdW5jdGlvbih2ZWNoaWNsZUlkLCBzdWNjZXNzLCBlcnJvcikge1xuICAgICAgICAgICAgdmFyIHZlaGljbGUgPSBWZWhpY2xlLnByZXZpZXcoe3ZlaGljbGVJZDogdmVjaGljbGVJZH0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3ModmVoaWNsZSk7XG4gICAgICAgICAgICAgICAgfSwgZXJyb3IpO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUT0RPOiBpbXBsZW1lbnQgdGhlIHJlc3RcbiAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnYXV0aCcpLlxuICAgIGNvbnRyb2xsZXIoJ0F1dGhDb250cm9sbGVyJyxcbiAgICAgICAgICAgIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyJywgJyRpbnRlcnZhbCcsICdUb2tlblNlcnZpY2UnLCAnQXV0aFNlcnZpY2UnLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCRyb290U2NvcGUsICRzY29wZSwgJGxvY2F0aW9uLCAkdHJhbnNsYXRlUGFydGlhbExvYWRlciwgJGludGVydmFsLCB0b2tlblNlcnZpY2UsIGF1dGhTZXJ2aWNlKSB7XG4gICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3NBdXRoKHJlcykge1xuICAgICAgICAgICAgaWYoJHJvb3RTY29wZS5yZXR1cm5Ubykge1xuICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCRyb290U2NvcGUucmV0dXJuVG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc3VjY2Vzc0xvZ291dCgpIHtcbi8vICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IFwiL1wiO1xuICAgICAgICAgICAgdG9rZW5TZXJ2aWNlLnNldFRva2VuKG51bGwpO1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvXCIpO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gcmVmcmVzaFRva2VuKCkge1xuICAgICAgICAgICAgaWYgKHRva2VuU2VydmljZS5uZWVkc1JlZnJlc2goNjAwMDApKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRva2VuID0gdG9rZW5TZXJ2aWNlLmdldFRva2VuKCk7XG4gICAgICAgICAgICAgICAgaWYgKHRva2VuKSB7XG4gICAgICAgICAgICAgICAgICAgIGF1dGhTZXJ2aWNlLnJlZnJlc2goZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy90b2tlblNlcnZpY2Uuc2V0VG9rZW4ocmVzLnRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9rZW5TZXJ2aWNlLnNldFRva2VuKG51bGwpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZighJHJvb3RTY29wZS50b2tlblJlZnJlc2hQcm9taXNlKSB7IC8vIEZJWE1FOiBMb29rcyBsaWtlIGl0J3Mgbm90IGZpcmluZyB3aGVuIHRoZSBicm93c2VyIGlzIG1pbmltaXplZCwgdHJ5IHNldEludGVydmFsXG4gICAgICAgICAgICAkcm9vdFNjb3BlLnRva2VuUmVmcmVzaFByb21pc2UgPSAkaW50ZXJ2YWwocmVmcmVzaFRva2VuLCAzMDAwMCk7IC8vIHZlcmlmeSB0aGUgdG9rZW4gZXZlcnkgMzAgc2Vjb25kc1xuICAgICAgICB9XG5cbiAgICAgICAgJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXIuYWRkUGFydCgnYXV0aCcpO1xuXG4vKlxuICAgICAgICAkc2NvcGUuJG9uKCckZGVzdHJveScsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgaWYoJHJvb3RTY29wZS50b2tlblJlZnJlc2hQcm9taXNlKSB7XG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbCgkcm9vdFNjb3BlLnRva2VuUmVmcmVzaFByb21pc2UpO1xuICAgICAgICAgICAgICAgIGRlbGV0ZSAkcm9vdFNjb3BlLnRva2VuUmVmcmVzaFByb21pc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuKi9cblxuICAgICAgICAkc2NvcGUuc2lnbmluID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcbiAgICAgICAgICAgIGlmKGlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICB2YXIgZm9ybURhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAkc2NvcGUucGFzc3dvcmRcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgYXV0aFNlcnZpY2Uuc2lnbmluKGZvcm1EYXRhLCBzdWNjZXNzQXV0aCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLmVycm9yID0gJ0ludmFsaWQgY3JlZGVudGlhbHMuJztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuc2lnbnVwID0gZnVuY3Rpb24gKGlzVmFsaWQpIHtcbiAgICAgICAgICAgIGlmKGlzVmFsaWQpIHtcbiAgICAgICAgICAgICAgICBkZWxldGUgJHNjb3BlLnNpZ251cEZvcm1JbnZhbGlkO1xuICAgICAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgbmFtZTogJHNjb3BlLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiAkc2NvcGUuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiAkc2NvcGUucGFzc3dvcmQsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkX2NvbmZpcm1hdGlvbjogJHNjb3BlLnBhc3N3b3JkX2NvbmZpcm1hdGlvblxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBhdXRoU2VydmljZS5zaWdudXAoZm9ybURhdGEsIHN1Y2Nlc3NBdXRoLCBmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICAgICAgICAgICRyb290U2NvcGUuZXJyb3IgPSByZXMuZXJyb3IgfHwgJ0ZhaWxlZCB0byBzaWduIHVwLic7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAkc2NvcGUuc2lnbnVwRm9ybUludmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgICRzY29wZS5sb2dvdXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBhdXRoU2VydmljZS5sb2dvdXQoc3VjY2Vzc0xvZ291dCk7XG4gICAgICAgIH07XG4gICAgfV0pO1xufSkoKTtcbiIsIihmdW5jdGlvbiAoKSB7XG4gICAgJ3VzZSBzdHJpY3QnO1xuXG4gICAgdmFyIHZlaGljbGVzID0gW107XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgnc2VhcmNoJykuXG4gICAgY29udHJvbGxlcignU2VhcmNoQ29udHJvbGxlcicsIFsnJHJvb3RTY29wZScsICckc2NvcGUnLCAnJGxvY2F0aW9uJywgJyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyJywgJ1NlYXJjaFNlcnZpY2UnLCAnVG9rZW5TZXJ2aWNlJyxcbiAgICAgICAgICAgIGZ1bmN0aW9uICgkcm9vdFNjb3BlLCAkc2NvcGUsICRsb2NhdGlvbiwgJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXIsIHNlYXJjaFNlcnZpY2UsIHRva2VuU2VydmljZSkge1xuICAgICAgICBmdW5jdGlvbiBzZWFyY2hTdWNjZXNzKHJlcykge1xuICAgICAgICAgICAgaWYocmVzICYmIHJlcy52ZWhpY2xlcykgeyAvLyBUT0RPOiB2ZXJpZnkgaWYgaXQncyBhbiBhcnJheVxuICAgICAgICAgICAgICAgIHNldFZlaGljbGVzKHJlcy52ZWhpY2xlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXRWZWhpY2xlcyhbXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBmdW5jdGlvbiBzZXRWZWhpY2xlcygkdmVoaWNsZXMpIHtcbiAgICAgICAgICAgIHZlaGljbGVzID0gJHZlaGljbGVzO1xuICAgICAgICAgICAgJHNjb3BlLnZlaGljbGVzID0gJHZlaGljbGVzO1xuICAgICAgICAgICAgaWYodmVoaWNsZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICRzY29wZS5pc1BhbmVsRXhwYW5kZWQgPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICRzY29wZS5pc1BhbmVsRXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gc2VhcmNoRmFpbGVkKCkge1xuICAgICAgICAgICAgJHJvb3RTY29wZS5lcnJvciA9ICdTZWFyY2ggZmFpbGVkJztcbiAgICAgICAgICAgIHNldFZlaGljbGVzKFtdKTtcbiAgICAgICAgfVxuXG4gICAgICAgICR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyLmFkZFBhcnQoJ3NlYXJjaCcpO1xuXG4gICAgICAgICRzY29wZS5zZWFyY2ggPSBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICRzY29wZS5pc0FkdmFuY2VkU2VhcmNoID0gZmFsc2U7XG5cbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAkc2NvcGUudHlwZSxcbiAgICAgICAgICAgICAgICBmZWF0dXJlMTogJHNjb3BlLmZlYXR1cmUxXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgc2VhcmNoU2VydmljZS5zZWFyY2goZm9ybURhdGEsIHNlYXJjaFN1Y2Nlc3MsIHNlYXJjaEZhaWxlZCk7XG4gICAgICAgIH07XG5cbiAgICAgICAgJHNjb3BlLmFkdmFuY2VkU2VhcmNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZih0b2tlblNlcnZpY2UuZ2V0VG9rZW4oKSA9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgJHJvb3RTY29wZS5lcnJvciA9ICdBY2Nlc3MgZGVuaWVkJztcbiAgICAgICAgICAgICAgICAkc2NvcGUuaXNBZHZhbmNlZFNlYXJjaCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5pc0FkdmFuY2VkU2VhcmNoID0gdHJ1ZTtcbiAgICAgICAgICAgIHZhciBmb3JtRGF0YSA9IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAkc2NvcGUudHlwZSxcbiAgICAgICAgICAgICAgICBmZWF0dXJlMTogJHNjb3BlLmZlYXR1cmUxLFxuICAgICAgICAgICAgICAgIGZlYXR1cmUyOiAkc2NvcGUuZmVhdHVyZTIsXG4gICAgICAgICAgICAgICAgZmVhdHVyZTM6ICRzY29wZS5mZWF0dXJlM1xuICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgc2VhcmNoU2VydmljZS5hZHZhbmNlZFNlYXJjaChmb3JtRGF0YSwgc2VhcmNoU3VjY2Vzcywgc2VhcmNoRmFpbGVkKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUudmlld0RldGFpbHMgPSBmdW5jdGlvbihpZCkge1xuICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvdmVoaWNsZS9cIiArIGlkKTtcbiAgICAgICAgfTtcblxuICAgICAgICAkc2NvcGUuc2VsZWN0ID0gZnVuY3Rpb24oJHRhYikge1xuICAgICAgICAgICAgaWYoJ2FkdmFuY2VkJyA9PT0gJHRhYiAmJiB0b2tlblNlcnZpY2UuZ2V0VG9rZW4oKSAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzQWR2YW5jZWRTZWFyY2ggPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmlzQWR2YW5jZWRTZWFyY2ggPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICRzY29wZS5pc1BhbmVsRXhwYW5kZWQgPSB0cnVlO1xuICAgICAgICB9O1xuXG4gICAgICAgIHNldFZlaGljbGVzKHZlaGljbGVzKTtcbiAgICAgICAgJHNjb3BlLmlzQWR2YW5jZWRTZWFyY2ggPSBmYWxzZTtcbiAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG5cbiAgICBhbmd1bGFyLm1vZHVsZSgndmVoaWNsZXMnKS5cbiAgICBjb250cm9sbGVyKCdWZWhpY2xlc0NvbnRyb2xsZXInLFxuICAgICAgICAgICAgWyckcm9vdFNjb3BlJywgJyRzY29wZScsICdUb2tlblNlcnZpY2UnLCAnVmVoaWNsZXNTZXJ2aWNlJywgJyRyb3V0ZVBhcmFtcycsXG4gICAgICAgICAgICBmdW5jdGlvbiAoJHJvb3RTY29wZSwgJHNjb3BlLCB0b2tlblNlcnZpY2UsIHZlaGljbGVzU2VydmljZSwgJHJvdXRlUGFyYW1zKSB7XG4gICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MocmVzKSB7XG4gICAgICAgICAgICAkc2NvcGUudmVoaWNsZSA9IHJlcy52ZWhpY2xlO1xuICAgICAgICB9XG5cbiAgICAgICAgZnVuY3Rpb24gZXJyb3IocmVzKSB7XG4gICAgICAgICAgICAkcm9vdFNjb3BlLmVycm9yID0gcmVzLmRhdGEuZXJyb3I7IC8vIFRPRE86IGltcHJvdmUgZXJyb3IgaGFuZGxpbmdcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKCRyb3V0ZVBhcmFtcyAmJiAkcm91dGVQYXJhbXMuaWQpIHtcbiAgICAgICAgICAgIGlmKHRva2VuU2VydmljZS5nZXRUb2tlbigpID09IG51bGwpIHtcbiAgICAgICAgICAgICAgICB2ZWhpY2xlc1NlcnZpY2UucHJldmlldygkcm91dGVQYXJhbXMuaWQsIHN1Y2Nlc3MsIGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHZlaGljbGVzU2VydmljZS5nZXQoJHJvdXRlUGFyYW1zLmlkLCBzdWNjZXNzLCBlcnJvcik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XSk7XG59KSgpO1xuIiwiKGZ1bmN0aW9uICgpIHtcbiAgICAndXNlIHN0cmljdCc7XG4gICAgYW5ndWxhci5tb2R1bGUoJ3RydXhBcHAnLCBbXG4gICAgICAgICduZ1JvdXRlJywgJ25nUmVzb3VyY2UnLFxuICAgICAgICAnYW5ndWxhci1sb2FkaW5nLWJhcicsXG4gICAgICAgICdwYXNjYWxwcmVjaHQudHJhbnNsYXRlJyxcbiAgICAgICAgJ2F1dGgnLFxuICAgICAgICAnc2VhcmNoJyxcbiAgICAgICAgJ3ZlaGljbGVzJ1xuICAgIF0pLlxuICAgIGNvbnN0YW50KCd1cmxzJywge1xuICAgICAgICBCQVNFOiAnJyxcbiAgICAgICAgQkFTRV9BUEk6ICcvYXBpL3YxJ1xuICAgIH0pLlxuICAgIGNvbmZpZyhbJyRyb3V0ZVByb3ZpZGVyJywgJyRodHRwUHJvdmlkZXInLCAnJGxvY2F0aW9uUHJvdmlkZXInLCAnJHRyYW5zbGF0ZVByb3ZpZGVyJywgJyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyUHJvdmlkZXInLFxuICAgICAgICAgICAgZnVuY3Rpb24gKCRyb3V0ZVByb3ZpZGVyLCAkaHR0cFByb3ZpZGVyLCAkbG9jYXRpb25Qcm92aWRlciwgJHRyYW5zbGF0ZVByb3ZpZGVyLCAkdHJhbnNsYXRlUGFydGlhbExvYWRlclByb3ZpZGVyKSB7XG4gICAgICAgICRyb3V0ZVByb3ZpZGVyLlxuICAgICAgICAgICAgd2hlbignLycsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvc2VhcmNoL3NlYXJjaC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnU2VhcmNoQ29udHJvbGxlcidcbiAgICAgICAgICAgIH0pLlxuICAgICAgICAgICAgd2hlbignL3NpZ25pbicsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvYXV0aC9zaWduaW4uaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0F1dGhDb250cm9sbGVyJ1xuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICB3aGVuKCcvc2lnbnVwJywge1xuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hdXRoL3NpZ251cC5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnQXV0aENvbnRyb2xsZXInXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIHdoZW4oJy92ZWhpY2xlLzppZCcsIHtcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ21vZHVsZXMvdmVoaWNsZXMvZGV0YWlscy5odG1sJyxcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnVmVoaWNsZXNDb250cm9sbGVyJ1xuICAgICAgICAgICAgfSkuXG4gICAgICAgICAgICB3aGVuKCcvYWNjb3VudCcsIHtcbiAgICAgICAgICAgICAgICByZXN0cmljdGVkOiB0cnVlLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnbW9kdWxlcy9hY2NvdW50L2FjY291bnQuaHRtbCcsXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0F1dGhDb250cm9sbGVyJyAgLy8gRklYTUU6IHVzZSB0aGUgYWNjb3VudCBjb250cm9sbGVyXG4gICAgICAgICAgICB9KS5cbiAgICAgICAgICAgIG90aGVyd2lzZSh7XG4gICAgICAgICAgICAgICAgcmVkaXJlY3RUbzogJy8nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgJGh0dHBQcm92aWRlci5pbnRlcmNlcHRvcnMucHVzaChbJyRxJywgJyRsb2NhdGlvbicsICckcm9vdFNjb3BlJywgJ1Rva2VuU2VydmljZScsIGZ1bmN0aW9uICgkcSwgJGxvY2F0aW9uLCAkcm9vdFNjb3BlLCB0b2tlblNlcnZpY2UpIHtcbiAgICAgICAgICAgIGZ1bmN0aW9uIGV4dHJhY3RUb2tlbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHJlc3BvbnNlLmhlYWRlcnMoJ1gtSldULVRva2VuJyk7XG4gICAgICAgICAgICAgICAgaWYodG9rZW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdG9rZW5TZXJ2aWNlLnNldFRva2VuKHRva2VuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiB7XG4gICAgICAgICAgICAgICAgJ3JlcXVlc3QnOiBmdW5jdGlvbiAoY29uZmlnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbmZpZy5oZWFkZXJzID0gY29uZmlnLmhlYWRlcnMgfHwge307XG4gICAgICAgICAgICAgICAgICAgIHZhciB0b2tlbiA9IHRva2VuU2VydmljZS5nZXRUb2tlbigpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodG9rZW4gIT0gbnVsbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIHRva2VuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25maWc7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAncmVzcG9uc2UnOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3RhdHVzID09PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGV4dHJhY3RUb2tlbihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlO1xuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ3Jlc3BvbnNlRXJyb3InOiBmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAxIHx8IHJlc3BvbnNlLnN0YXR1cyA9PT0gNDAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlblNlcnZpY2Uuc2V0VG9rZW4obnVsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnJldHVyblRvID0gJGxvY2F0aW9uLnBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRsb2NhdGlvbi5wYXRoKCcvc2lnbmluJyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHRyYWN0VG9rZW4ocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAkcS5yZWplY3QocmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfV0pO1xuXG4gICAgICAgICRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcblxuICAgICAgICAkdHJhbnNsYXRlUHJvdmlkZXJcbiAgICAgICAgICAgIC51c2VMb2FkZXIoJyR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyJywge1xuICAgICAgICAgICAgICAgIHVybFRlbXBsYXRlOiAnL21vZHVsZXMve3BhcnR9L2xvY2FsZS97bGFuZ30uanNvbidcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAvLy50cmFuc2xhdGlvbnMoJ2RlJywgeyAvKiAuLi4gKi8gfSlcbiAgICAgICAgICAgIC8vLnRyYW5zbGF0aW9ucygncnUnLCB7IC8qIC4uLiAqLyB9KVxuICAgICAgICAgICAgLy8udHJhbnNsYXRpb25zKCdsdCcsIHsgLyogLi4uICovIH0pXG4gICAgICAgICAgICAvLy50cmFuc2xhdGlvbnMoJ2VuJywgeyAvKiAuLi4gKi8gfSlcbiAgICAgICAgICAgIC5yZWdpc3RlckF2YWlsYWJsZUxhbmd1YWdlS2V5cyhbJ2VuJywgJ2RlJywgJ3J1JywgJ2x0J10sIHtcbiAgICAgICAgICAgICAgICAnZW5fVVMnOiAnZW4nLFxuICAgICAgICAgICAgICAgICdlbl9VSyc6ICdlbicsXG4gICAgICAgICAgICAgICAgJ2RlX0RFJzogJ2RlJyxcbiAgICAgICAgICAgICAgICAnZGVfQ0gnOiAnZGUnLFxuICAgICAgICAgICAgICAgICdydV9SVSc6ICdydScsXG4gICAgICAgICAgICAgICAgJ2x0X0xUJzogJ2x0J1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5mYWxsYmFja0xhbmd1YWdlKCdlbicpXG4gICAgICAgICAgICAuZGV0ZXJtaW5lUHJlZmVycmVkTGFuZ3VhZ2UoKVxuICAgICAgICAgICAgLnVzZVNhbml0aXplVmFsdWVTdHJhdGVneSgnZXNjYXBlZCcpXG4gICAgICAgICAgICAvKi51c2VMb2NhbFN0b3JhZ2UoKSovO1xuXG4gICAgICAgICAgICAkdHJhbnNsYXRlUGFydGlhbExvYWRlclByb3ZpZGVyLmFkZFBhcnQoJ2F1dGgnKTtcbiAgICAgICAgICAgICR0cmFuc2xhdGVQYXJ0aWFsTG9hZGVyUHJvdmlkZXIuYWRkUGFydCgnc2VhcmNoJyk7XG4gICAgfV0pLlxuICAgIGNvbnRyb2xsZXIoJ1RyYW5zbGF0ZUNvbnRyb2xsZXInLCBbJyR0cmFuc2xhdGUnLCAnJHNjb3BlJywgZnVuY3Rpb24oJHRyYW5zbGF0ZSwgJHNjb3BlKSB7XG4gICAgICAgIGlmKGxvY2FsU3RvcmFnZS5sYW5nS2V5KSB7XG4gICAgICAgICAgICAkdHJhbnNsYXRlLnVzZShsb2NhbFN0b3JhZ2UubGFuZ0tleSk7XG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudExhbmd1YWdlID0gbG9jYWxTdG9yYWdlLmxhbmdLZXk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkc2NvcGUuY3VycmVudExhbmd1YWdlID0gJHRyYW5zbGF0ZS51c2UoKTtcbiAgICAgICAgfVxuXG4gICAgICAgICRzY29wZS5sYW5ndWFnZXMgPSBbXG4gICAgICAgICAgICB7aWQ6ICdkZScsIGxhYmVsOiBcIkRldXRzY2hcIn0sXG4gICAgICAgICAgICB7aWQ6ICdydScsIGxhYmVsOiBcItCg0YPRgdGB0LrQuNC5XCJ9LFxuICAgICAgICAgICAge2lkOiAnbHQnLCBsYWJlbDogXCJMaWV0dXZpxbNcIn0sXG4gICAgICAgICAgICB7aWQ6ICdlbicsIGxhYmVsOiBcIkVuZ2xpc2hcIn1dO1xuXG4gICAgICAgICRzY29wZS5jaGFuZ2VMYW5ndWFnZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICR0cmFuc2xhdGUudXNlKCRzY29wZS5jdXJyZW50TGFuZ3VhZ2UpO1xuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLmxhbmdLZXkgPSAkc2NvcGUuY3VycmVudExhbmd1YWdlO1xuICAgICAgICB9O1xuICAgIH1dKS5cbiAgICBydW4oWyckcm9vdFNjb3BlJywgJyRsb2NhdGlvbicsICckdHJhbnNsYXRlJywgJ1Rva2VuU2VydmljZScsXG4gICAgICAgICAgICBmdW5jdGlvbigkcm9vdFNjb3BlLCAkbG9jYXRpb24sICR0cmFuc2xhdGUsIHRva2VuU2VydmljZSkge1xuICAgICAgICAkcm9vdFNjb3BlLiRvbiggXCIkcm91dGVDaGFuZ2VTdGFydFwiLCBmdW5jdGlvbihldmVudCwgbmV4dCkge1xuICAgICAgICAgICAgZGVsZXRlICRyb290U2NvcGUuZXJyb3I7XG4gICAgICAgICAgICBpZiAodG9rZW5TZXJ2aWNlLmdldFRva2VuKCkgPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGlmIChuZXh0ICYmIG5leHQucmVzdHJpY3RlZCA9PT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAkcm9vdFNjb3BlLnJldHVyblRvID0gJGxvY2F0aW9uLnBhdGgoKTtcbiAgICAgICAgICAgICAgICAgICAgJGxvY2F0aW9uLnBhdGgoXCIvc2lnbmluXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIGlmKCRyb290U2NvcGUucmV0dXJuVG8pIHtcbiAgICAgICAgICAgICAgICAgICAgZGVsZXRlICRyb290U2NvcGUucmV0dXJuVG87XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICAkcm9vdFNjb3BlLiRvbignJHRyYW5zbGF0ZVBhcnRpYWxMb2FkZXJTdHJ1Y3R1cmVDaGFuZ2VkJywgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJHRyYW5zbGF0ZS5yZWZyZXNoKCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRva2VuU2VydmljZS5zZXRUb2tlbihsb2NhbFN0b3JhZ2UudG9rZW4pO1xuICAgIH1dKTtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=